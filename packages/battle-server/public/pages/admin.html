<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PYXIS | 관리자 페이지</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/assets/css/admin.css" />
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #00080D;
      color: #E9E4D4;
      margin: 0;
      padding: 0;
      font-size: 14px;
    }
    header {
      padding: 10px 20px;
      border-bottom: 1px solid rgba(220,199,162,0.2);
    }
    h1 { font-family: 'Cinzel', serif; font-size: 18px; margin: 0; }
    h2 { font-size: 15px; margin: 0 0 6px 0; }
    p  { font-size: 13px; margin: 0 0 6px 0; }

    .page-container {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 16px;
      padding: 16px;
    }

    .section-card {
      background: rgba(0,30,53,0.55);
      border: 1px solid rgba(220,199,162,0.18);
      border-radius: 8px;
      padding: 12px 14px;
      margin-bottom: 16px;
    }
    .section-header { margin-bottom: 10px; }
    .section-title { font-size: 15px; margin: 0; }
    .section-subtitle { font-size: 12px; opacity: 0.8; }

    label { font-size: 12px; display: block; margin-bottom: 4px; }
    input, select, button {
      font-size: 13px;
      padding: 5px 8px;
      border-radius: 6px;
      border: 1px solid rgba(220,199,162,0.2);
      background: #0e1320;
      color: #fff;
    }
    button { cursor: pointer; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }

    .game-btn {
      background: #DCC7A2;
      color: #00080D;
      border: none;
      font-weight: 600;
      margin-right: 6px;
    }
    .game-btn.secondary { background: #444; color: #fff; }
    .game-btn.success { background: #22C55E; color: #fff; }

    .otp-list { display: grid; gap: 6px; }
    .otp-item {
      display: grid;
      grid-template-columns: auto auto 1fr auto;
      align-items: center;
      gap: 6px;
      background: rgba(0,30,53,0.55);
      border: 1px solid rgba(220,199,162,0.18);
      border-radius: 6px;
      padding: 6px 8px;
      font-size: 12px;
    }
    .otp-player { font-weight: 600; }
    .team-badge {
      background: #DCC7A2;
      color: #00080D;
      border-radius: 12px;
      padding: 2px 6px;
      font-size: 11px;
    }
    .code { font-family: monospace; opacity: 0.9; }
    .otp-copy {
      padding: 4px 6px;
      border: none;
      border-radius: 4px;
      background: #22C55E;
      color: #fff;
      font-size: 11px;
      cursor: pointer;
    }
    .roster-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    .player-card {
      background: #121a2a;
      border-radius: 6px;
      padding: 6px;
      font-size: 12px;
    }
    .log-viewer {
      max-height: 200px;
      overflow-y: auto;
      background: #0f1525;
      border-radius: 6px;
      padding: 6px;
      font-size: 12px;
    }
    .chat-box {
      display: flex;
      gap: 6px;
      margin-top: 8px;
    }
    .toast-container {
      position: fixed;
      top: 10px;
      right: 10px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      z-index: 2000;
    }
    .toast {
      background: #333;
      color: #fff;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 12px;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.3s;
    }
    .toast.show {
      opacity: 1;
      transform: translateX(0);
    }
  </style>
</head>
<body>
  <header>
    <h1>PYXIS 전투 시스템 | 관리자</h1>
  </header>

  <div class="page-container">
    <main>
      <!-- 전투 생성 -->
      <section class="section-card">
        <div class="section-header">
          <h2 class="section-title">전투 생성</h2>
          <p class="section-subtitle">모드를 선택 후 전투를 생성하세요</p>
        </div>
        <form id="battleCreateForm">
          <label for="battleMode">전투 모드</label>
          <select id="battleMode">
            <option value="1v1">1 vs 1</option>
            <option value="2v2">2 vs 2</option>
            <option value="3v3">3 vs 3</option>
            <option value="4v4">4 vs 4</option>
          </select>
          <button type="submit" class="game-btn btn-create">전투 생성</button>
        </form>
        <div id="battleInfo" style="display:none; margin-top:8px;">
          <p>전투 ID: <span id="battleIdDisplay"></span></p>
          <p>관리자 OTP: <span id="adminOtpDisplay"></span></p>
          <p>생성 시각: <span id="createTimeDisplay"></span></p>
        </div>
      </section>

      <!-- 플레이어 추가 -->
      <section class="section-card">
        <div class="section-header">
          <h2 class="section-title">플레이어 추가</h2>
        </div>
        <form id="playerForm">
          <label for="playerName">이름</label>
          <input id="playerName" type="text" placeholder="플레이어 이름" />
          <label for="playerTeam">팀</label>
          <select id="playerTeam">
            <option value="A">불사조 기사단</option>
            <option value="B">죽음을 먹는 자들</option>
          </select>
          <label>스탯 (1-5)</label>
          <div>
            <input id="statAttack" type="number" value="3" min="1" max="5" /> 공격
            <input id="statDefense" type="number" value="3" min="1" max="5" /> 방어
            <input id="statAgility" type="number" value="3" min="1" max="5" /> 민첩
            <input id="statLuck" type="number" value="3" min="1" max="5" /> 행운
          </div>
          <label for="playerHp">체력(HP)</label>
          <input id="playerHp" type="number" value="100" min="1" max="9999" />
          <label for="playerAvatar">아바타</label>
          <input id="playerAvatar" type="file" />
          <button type="button" id="btnAddPlayer" class="game-btn">플레이어 추가</button>
        </form>
      </section>

      <!-- OTP 발급 -->
      <section class="section-card" id="otpSection">
        <div class="section-header">
          <h2 class="section-title">OTP 발급</h2>
          <p class="section-subtitle">플레이어/관전자 접속용 코드</p>
        </div>
        <div class="section-content">
          <div class="control-actions" style="margin-bottom:6px;">
            <button class="game-btn" id="btnGeneratePlayerOTP" disabled>플레이어 OTP 생성</button>
            <button class="game-btn secondary" id="btnGenerateSpectatorOTP" disabled>관전자 OTP 생성</button>
          </div>
          <div id="otpDisplay" style="display:none; margin-top:6px;">
            <div class="form-group">
              <label class="form-label">플레이어 OTP 목록</label>
              <div id="playerOtpList" class="otp-list"></div>
            </div>
            <div class="form-group" style="margin-top:6px;">
              <label class="form-label">관전자 OTP</label>
              <div id="spectatorOtpDisplay" class="otp-list"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- 로스터 -->
      <section class="section-card" id="rosterCard" style="display:none;">
        <div class="section-header">
          <h2 class="section-title">참여자 관리</h2>
        </div>
        <div class="roster-grid">
          <div>
            <h3>불사조 기사단 (<span id="teamACount">0/4</span>)</h3>
            <div id="team1Roster"></div>
          </div>
          <div>
            <h3>죽음을 먹는 자들 (<span id="teamBCount">0/4</span>)</h3>
            <div id="team2Roster"></div>
          </div>
        </div>
      </section>

      <!-- 로그 -->
      <section class="section-card">
        <div class="section-header">
          <h2 class="section-title">시스템 로그</h2>
        </div>
        <div id="logViewer" class="log-viewer"></div>
      </section>

      <!-- 채팅 -->
      <section class="section-card">
        <div class="section-header">
          <h2 class="section-title">채팅</h2>
        </div>
        <div id="chatChannel"></div>
        <div class="chat-box">
          <input id="chatInput" type="text" placeholder="메시지 입력" />
          <button id="btnSendChat" class="game-btn">전송</button>
        </div>
      </section>
    </main>

    <!-- 사이드바 -->
    <aside>
      <section class="section-card">
        <div class="section-header">
          <h2 class="section-title">제어</h2>
        </div>
        <button id="btnConnect" class="game-btn">관리자로 연결</button>
        <button id="btnStartBattle" class="game-btn" disabled>전투 시작</button>
        <button id="btnPauseBattle" class="game-btn secondary" disabled>일시정지</button>
        <button id="btnEndBattle" class="game-btn secondary" disabled>전투 종료</button>
      </section>
      <section class="section-card">
        <div class="section-header">
          <h2 class="section-title">설정</h2>
        </div>
        <label for="baseHpInput">기본 체력</label>
        <input id="baseHpInput" type="number" value="100" min="1" max="9999" />
        <button id="applySettingsBtn" class="game-btn secondary">적용</button>
        <p style="margin-top:6px;">현재 기본 HP: <span id="baseHpView">100</span></p>
      </section>
    </aside>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/assets/js/pages/admin.js"></script>
</body>
</html>
