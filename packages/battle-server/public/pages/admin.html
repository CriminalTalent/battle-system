<div class="form-group">
          <label>ìŠ¤íƒ¯ ë°°ë¶„ (ê° 1-5)</label>
          <div class="stats-grid">
            <input id="statAttack" type="number" class="stat-input" min="1" max="5" value="3" placeholder="ê³µê²©">
            <input id="statDefense" type="number" class="stat-input" min="1" max="5" value="3" placeholder="ë°©ì–´">
            <input id="statAgility" type="number" class="stat-input" min="1" max="5" value="3" placeholder="ë¯¼ì²©">
            <input id="statLuck" type="number" class="stat-input" min="1" max="5" value="3" placeholder="í–‰ìš´">
          </div>
        </div>

        <div class="form-group">
          <label>ì‹œì‘ ì•„ì´í…œ</label>
          <div class="items-grid">
            <input id="itemDittany" type="number" class="item-input" min="0" max="5" value="1" placeholder="ë””í„°ë‹ˆ" title="ì²´ë ¥ 10 íšŒë³µ">
            <input id="itemAttack" type="number" class="item-input" min="0" max="5" value="1" placeholder="ê³µê²© ë³´ì •ê¸°" title="ê³µê²©ë ¥ 1.5ë°° (ì„±ê³µë¥  10%)">
            <input id="itemDefense" type="number" class="item-input" min="0" max="5" value="1" placeholder="ë°©ì–´ ë³´ì •ê¸°" title="ë°©ì–´ë ¥ 1.5ë°° (ì„±ê³µë¥  10%)">
          </div>
        </div>

        <div class="form-group">
          <label>ì´ë¯¸ì§€ ì—…ë¡œë“œ (ìµœëŒ€ 5MB)</label>
          <input id="playerAvatar" type="file" accept="image/*">
        </div>

        <button id="btnAddPlayer" class="btn">ì „íˆ¬ ì°¸ê°€ì ì¶”ê°€</button>

        <!-- íŒ€ ë¡œìŠ¤í„° -->
        <div class="roster-section">
          <div class="team-roster team-phoenix">
            <div class="team-title">ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨</div>
            <div id="phoenixTeam" class="player-list">
              <div class="empty-state">íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          </div>

          <div class="team-roster team-death">
            <div class="team-title">ì£½ìŒì„ ë¨¹ëŠ” ìë“¤</div>
            <div id="deathTeam" class="player-list">
              <div class="empty-state">íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          </div>
        </div>
      </section>

      <!-- ì˜¤ë¥¸ìª½: ë¡œê·¸ ë° ì±„íŒ… -->
      <section class="section">
        <h3>ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</h3>
        
        <div class="log-chat-container">
          <!-- ì „íˆ¬ ë¡œê·¸ -->
          <div class="log-section">
            <div class="log-title">ì „íˆ¬ ë¡œê·¸</div>
            <div id="battleLog" class="log-container">
              <div class="log-entry system">PYXIS ê´€ë¦¬ì ì½˜ì†”ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
              <div class="log-entry system">ì „íˆ¬ ë£°: ìŠ¤íƒ¯ ê° 1-5, ì²´ë ¥ ìµœëŒ€ 100, 5ë¶„ í„´ ì œí•œ</div>
            </div>
          </div>

          <!-- ì±„íŒ… -->
          <div class="chat-section">
            <div class="chat-title">ì‹¤ì‹œê°„ ì±„íŒ…</div>
            <div id="chatContainer" class="chat-container">
              <div class="chat-message">
                <span class="sender">ì‹œìŠ¤í…œ</span>
                <span class="timestamp">[ì‹œìŠ¤í…œ]</span>
                <div>ì±„íŒ…ì„ ì‹œì‘í•˜ì„¸ìš”!</div>
              </div>
            </div>
            <div class="chat-input-container">
              <input id="chatInput" class="chat-input" type="text" placeholder="ê´€ë¦¬ì ë©”ì‹œì§€ ì…ë ¥..." maxlength="200">
              <button id="btnSendChat" class="chat-send">ì „ì†¡</button>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
  <div id="toast" class="toast"></div>

  <!-- ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="https://pyxisbattlesystem.monster/socket.io/socket.io.js"></script>
  <script>
    // ì „ì—­ ì„¤ì •
    window.PYXIS_SERVER_URL = "https://pyxisbattlesystem.monster";
    
    // PYXIS ê´€ë¦¬ì í´ë˜ìŠ¤
    class PyxisAdminConsole {
      constructor() {
        this.socket = null;
        this.battleData = null;
        this.isConnected = false;
        this.currentBattleId = null;
        this.uptimeInterval = null;
        this.startTime = null;
        
        this.initElements();
        this.initEventListeners();
        this.connectSocket();
        this.showToast('ì‹œìŠ¤í…œì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
      }

      initElements() {
        // ì „íˆ¬ ì œì–´ ìš”ì†Œë“¤
        this.battleIdEl = document.getElementById('battleId');
        this.battleStatusEl = document.getElementById('battleStatus');
        this.battleModeEl = document.getElementById('battleMode');
        this.btnCreateBattle = document.getElementById('btnCreateBattle');
        this.btnStartBattle = document.getElementById('btnStartBattle');
        this.btnEndBattle = document.getElementById('btnEndBattle');
        this.btnGenerateLinks = document.getElementById('btnGenerateLinks');
        this.linkSection = document.getElementById('linkSection');
        this.playerLinks = document.getElementById('playerLinks');
        this.spectatorLink = document.getElementById('spectatorLink');

        // í”Œë ˆì´ì–´ ê´€ë¦¬ ìš”ì†Œë“¤
        this.playerNameEl = document.getElementById('playerName');
        this.playerTeamEl = document.getElementById('playerTeam');
        this.statAttackEl = document.getElementById('statAttack');
        this.statDefenseEl = document.getElementById('statDefense');
        this.statAgilityEl = document.getElementById('statAgility');
        this.statLuckEl = document.getElementById('statLuck');
        this.itemDittanyEl = document.getElementById('itemDittany');
        this.itemAttackEl = document.getElementById('itemAttack');
        this.itemDefenseEl = document.getElementById('itemDefense');
        this.playerAvatarEl = document.getElementById('playerAvatar');
        this.btnAddPlayer = document.getElementById('btnAddPlayer');
        this.phoenixTeamEl = document.getElementById('phoenixTeam');
        this.deathTeamEl = document.getElementById('deathTeam');

        // í†µê³„ ìš”ì†Œë“¤
        this.statPlayersEl = document.getElementById('statPlayers');
        this.statSpectatorsEl = document.getElementById('statSpectators');
        this.statTurnEl = document.getElementById('statTurn');
        this.statUptimeEl = document.getElementById('statUptime');

        // ë¡œê·¸ ë° ì±„íŒ… ìš”ì†Œë“¤
        this.battleLogEl = document.getElementById('battleLog');
        this.chatContainerEl = document.getElementById('chatContainer');
        this.chatInputEl = document.getElementById('chatInput');
        this.btnSendChatEl = document.getElementById('btnSendChat');

        // í† ìŠ¤íŠ¸
        this.toastEl = document.getElementById('toast');
      }

      initEventListeners() {
        // ì „íˆ¬ ì œì–´ ì´ë²¤íŠ¸
        this.btnCreateBattle.addEventListener('click', () => this.createBattle());
        this.btnStartBattle.addEventListener('click', () => this.startBattle());
        this.btnEndBattle.addEventListener('click', () => this.endBattle());
        this.btnGenerateLinks.addEventListener('click', () => this.generateLinks());

        // í”Œë ˆì´ì–´ ê´€ë¦¬ ì´ë²¤íŠ¸
        this.btnAddPlayer.addEventListener('click', () => this.addPlayer());
        
        // ìŠ¤íƒ¯ ë³€ê²½ ê°ì§€ (ê° 1-5)
        [this.statAttackEl, this.statDefenseEl, this.statAgilityEl, this.statLuckEl].forEach(el => {
          el.addEventListener('input', (e) => {
            const value = parseInt(e.target.value);
            if (value < 1) e.target.value = 1;
            if (value > 5) e.target.value = 5;
          });
        });

        // ì•„ì´í…œ ìˆ˜ëŸ‰ ì œí•œ
        [this.itemDittanyEl, this.itemAttackEl, this.itemDefenseEl].forEach(el => {
          el.addEventListener('input', (e) => {
            const value = parseInt(e.target.value);
            if (value < 0) e.target.value = 0;
            if (value > 5) e.target.value = 5;
          });
        });

        // ì±„íŒ… ì´ë²¤íŠ¸
        this.btnSendChatEl.addEventListener('click', () => this.sendChat());
        this.chatInputEl.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            this.sendChat();
          }
        });

        // íŒŒì¼ ì—…ë¡œë“œ ê²€ì¦
        this.playerAvatarEl.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (file) {
            if (file.size > 5 * 1024 * 1024) {
              this.showToast('íŒŒì¼ í¬ê¸°ëŠ” 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.', 'error');
              e.target.value = '';
            } else if (!file.type.startsWith('image/')) {
              this.showToast('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
              e.target.value = '';
            }
          }
        });
      }

      connectSocket() {
        this.addLog('system', 'ì„œë²„ ì—°ê²° ì¤‘...');
        
        this.socket = io(window.PYXIS_SERVER_URL, {
          transports: ['websocket', 'polling'],
          timeout: 20000
        });

        // ì—°ê²° ì„±ê³µ
        this.socket.on('connect', () => {
          console.log('ê´€ë¦¬ì ì†Œì¼“ ì—°ê²°ë¨:', this.socket.id);
          this.isConnected = true;
          this.addLog('system', 'ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.');
          this.showToast('ì„œë²„ ì—°ê²° ì„±ê³µ', 'success');
        });

        // ê´€ë¦¬ì ì¸ì¦ ì„±ê³µ
        this.socket.on('auth:success', (data) => {
          console.log('ê´€ë¦¬ì ì¸ì¦ ì„±ê³µ:', data);
          this.battleData = data.battle;
          this.currentBattleId = data.battle.id;
          this.updateUI();
          this.addLog('system', `ì „íˆ¬ ID ${data.battle.id}ë¡œ ì¸ì¦ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        });

        // ì¸ì¦ ì‹¤íŒ¨
        this.socket.on('auth:error', (error) => {
          console.error('ê´€ë¦¬ì ì¸ì¦ ì‹¤íŒ¨:', error);
          this.addLog('system', `ì¸ì¦ ì‹¤íŒ¨: ${error.message}`);
          this.showToast(`ì¸ì¦ ì‹¤íŒ¨: ${error.message}`, 'error');
        });

        // ì „íˆ¬ ìƒì„± ì™„ë£Œ
        this.socket.on('battle:created', (data) => {
          console.log('ì „íˆ¬ ìƒì„±ë¨:', data);
          this.currentBattleId = data.battleId;
          this.battleIdEl.textContent = data.battleId;
          this.updateButtons();
          this.addLog('system', `ì „íˆ¬ ID ${data.battleId}ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`);
          this.showToast('ì „íˆ¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        });

        // ê´€ë¦¬ì ì—…ë°ì´íŠ¸
        this.socket.on('admin:update', (data) => {
          console.log('ê´€ë¦¬ì ì—…ë°ì´íŠ¸ ìˆ˜ì‹ :', data);
          this.battleData = data.battle;
          this.updateUI();
          if (data.statistics) {
            this.updateStatistics(data.statistics);
          }
        });

        // í”Œë ˆì´ì–´ ì¶”ê°€ ì„±ê³µ
        this.socket.on('player:added', (data) => {
          console.log('í”Œë ˆì´ì–´ ì¶”ê°€ë¨:', data);
          this.addLog('system', `ì „íˆ¬ ì°¸ê°€ì ì¶”ê°€: ${data.player.name} (${data.player.team === 'phoenix' ? 'ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨' : 'ì£½ìŒì„ ë¨¹ëŠ” ìë“¤'})`);
          this.showToast(`${data.player.name}ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
          this.clearPlayerForm();
        });

        // í”Œë ˆì´ì–´ ì¶”ê°€ ì‹¤íŒ¨
        this.socket.on('player:error', (error) => {
          console.error('í”Œë ˆì´ì–´ ì—ëŸ¬:', error);
          this.showToast(`ì˜¤ë¥˜: ${error.message}`, 'error');
        });

        // ì „íˆ¬ ì‹œì‘
        this.socket.on('battle:started', (data) => {
          console.log('ì „íˆ¬ ì‹œì‘ë¨:', data);
          this.addLog('system', `ì „íˆ¬ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤! ${data.firstTeam === 'phoenix' ? 'ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨' : 'ì£½ìŒì„ ë¨¹ëŠ” ìë“¤'}ì´ ì„ ê³µì…ë‹ˆë‹¤.`);
          this.showToast('ì „íˆ¬ ì‹œì‘!', 'success');
          this.startUptime();
        });

        // ì „íˆ¬ ì¢…ë£Œ
        this.socket.on('battle:ended', (data) => {
          console.log('ì „íˆ¬ ì¢…ë£Œë¨:', data);
          const winnerText = data.winner ? `${data.winner === 'phoenix' ? 'ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨' : 'ì£½ìŒì„ ë¨¹ëŠ” ìë“¤'}ì˜ ìŠ¹ë¦¬!` : 'ë¬´ìŠ¹ë¶€';
          this.addLog('system', `ì „íˆ¬ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ${winnerText}`);
          this.showToast(`ì „íˆ¬ ì¢…ë£Œ: ${winnerText}`, 'info');
          this.stopUptime();
        });

        // ì „íˆ¬ ë¡œê·¸
        this.socket.on('battle:log', (entry) => {
          this.addLog(entry.type || 'battle', entry.message);
        });

        // ì±„íŒ… ë©”ì‹œì§€
        this.socket.on('chat:message', (data) => {
          this.addChatMessage(data);
        });

        // í”Œë ˆì´ì–´ ì—°ê²°/í•´ì œ
        this.socket.on('player:connected', (data) => {
          this.addLog('system', `${data.playerName}ì´ ì ‘ì†í–ˆìŠµë‹ˆë‹¤.`);
        });

        this.socket.on('player:disconnected', (data) => {
          this.addLog('system', `${data.playerName}ì´ ì—°ê²°ì„ ëŠì—ˆìŠµë‹ˆë‹¤.`);
        });

        // í”Œë ˆì´ì–´ ì¤€ë¹„ ìƒíƒœ
        this.socket.on('player:ready_update', (data) => {
          const statusText = data.isReady ? 'ì¤€ë¹„ ì™„ë£Œ' : 'ì¤€ë¹„ ì·¨ì†Œ';
          this.addLog('system', `${data.playerName}: ${statusText}`);
        });

        // ëª¨ë“  í”Œë ˆì´ì–´ ì¤€ë¹„ ì™„ë£Œ
        this.socket.on('battle:all_ready', (data) => {
          this.addLog('system', 'ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì¤€ë¹„ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
          this.showToast('ëª¨ë“  í”Œë ˆì´ì–´ ì¤€ë¹„ ì™„ë£Œ!', 'success');
        });

        // í„´ ì‹œì‘
        this.socket.on('turn:start', (data) => {
          this.addLog('system', `${data.playerName}ì˜ í„´ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. (í„´ ${data.turnNumber})`);
        });

        // í„´ ì¢…ë£Œ
        this.socket.on('turn:end', (data) => {
          this.addLog('system', 'í„´ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
        });

        // ê´€ì „ì ìˆ˜ ì—…ë°ì´íŠ¸
        this.socket.on('spectator:count_update', (data) => {
          this.statSpectatorsEl.textContent = data.count || 0;
        });

        // ì—°ê²° í•´ì œ
        this.socket.on('disconnect', (reason) => {
          console.log('ê´€ë¦¬ì ì†Œì¼“ ì—°ê²° ëŠì–´ì§:', reason);
          this.isConnected = false;
          this.addLog('system', 'ì„œë²„ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤. ì¬ì—°ê²° ì¤‘...');
          this.showToast('ì—°ê²° ëŠì–´ì§. ì¬ì—°ê²° ì¤‘...', 'error');
        });

        // ì¬ì—°ê²° ì„±ê³µ
        this.socket.on('reconnect', (attemptNumber) => {
          console.log('ê´€ë¦¬ì ì†Œì¼“ ì¬ì—°ê²°ë¨:', attemptNumber);
          this.addLog('system', 'ì„œë²„ì— ì¬ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.');
          this.showToast('ì¬ì—°ê²° ì„±ê³µ!', 'success');
        });

        // ì—°ê²° ì˜¤ë¥˜
        this.socket.on('connect_error', (error) => {
          console.error('ì†Œì¼“ ì—°ê²° ì˜¤ë¥˜:', error);
          this.addLog('system', `ì—°ê²° ì˜¤ë¥˜: ${error.message}`);
          this.showToast('ì—°ê²° ì‹¤íŒ¨', 'error');
        });
      }

      // ì „íˆ¬ ìƒì„±
      createBattle() {
        if (!this.socket || !this.isConnected) {
          this.showToast('ì„œë²„ì— ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
          return;
        }
        
        const mode = this.battleModeEl.value;
        this.addLog('system', `${mode} ì „íˆ¬ ìƒì„± ì¤‘...`);
        this.socket.emit('admin:create_battle', { mode });
      }

      // ì „íˆ¬ ì‹œì‘
      startBattle() {
        if (!this.socket || !this.isConnected || !this.currentBattleId) {
          this.showToast('ì „íˆ¬ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
          return;
        }
        
        if (confirm('ì „íˆ¬ë¥¼ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nëª¨ë“  í”Œë ˆì´ì–´ê°€ ì¤€ë¹„ ì™„ë£Œ ìƒíƒœì—¬ì•¼ í•©ë‹ˆë‹¤\nì‹œì‘ í›„ì—ëŠ” í”Œë ˆì´ì–´ ì¶”ê°€ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤')) {
          this.addLog('system', 'ì „íˆ¬ ì‹œì‘ ìš”ì²­ ì¤‘...');
          this.socket.emit('admin:start_battle', { battleId: this.currentBattleId });
        }
      }

      // ì „íˆ¬ ì¢…ë£Œ
      endBattle() {
        if (!this.socket || !this.isConnected || !this.currentBattleId) {
          this.showToast('ì „íˆ¬ë¥¼ ì¢…ë£Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
          return;
        }
        
        if (confirm('ì „íˆ¬ë¥¼ ê°•ì œë¡œ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì§„í–‰ ì¤‘ì¸ ëª¨ë“  ì•¡ì…˜ì´ ì¤‘ë‹¨ë©ë‹ˆë‹¤.')) {
          this.addLog('system', 'ì „íˆ¬ ì¢…ë£Œ ìš”ì²­ ì¤‘...');
          this.socket.emit('admin:end_battle', { battleId: this.currentBattleId });
        }
      }

      // í”Œë ˆì´ì–´ ì¶”ê°€
      addPlayer() {
        if (!this.socket || !this.isConnected || !this.currentBattleId) {
          this.showToast('í”Œë ˆì´ì–´ë¥¼ ì¶”ê°€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
          return;
        }

        const name = this.playerNameEl.value.trim();
        if (!name) {
          this.showToast('ì „íˆ¬ ì°¸ê°€ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
          this.playerNameEl.focus();
          return;
        }

        if (name.length > 20) {
          this.showToast('ì´ë¦„ì€ ìµœëŒ€ 20ê¸€ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
          return;
        }

        // ìŠ¤íƒ¯ ì ìš©: ê° ìŠ¤íƒ¯ 1-5
        const stats = {
          attack: Math.max(1, Math.min(5, parseInt(this.statAttackEl.value) || 3)),
          defense: Math.max(1, Math.min(5, parseInt(this.statDefenseEl.value) || 3)),
          agility: Math.max(1, Math.min(5, parseInt(this.statAgilityEl.value) || 3)),
          luck: Math.max(1, Math.min(5, parseInt(this.statLuckEl.value) || 3))
        };

        const items = {
          dittany: Math.max(0, Math.min(5, parseInt(this.itemDittanyEl.value) || 0)),
          attack_booster: Math.max(0, Math.min(5, parseInt(this.itemAttackEl.value) || 0)),
          defense_booster: Math.max(0, Math.min(5, parseInt(this.itemDefenseEl.value) || 0))
        };

        const playerData = {
          name,
          team: this.playerTeamEl.value,
          stats,
          items,
          hp: 100,
          maxHp: 100
        };

        // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
        const avatarFile = this.playerAvatarEl.files[0];
        if (avatarFile) {
          this.uploadAvatar(avatarFile, playerData);
        } else {
          this.socket.emit('admin:add_player', playerData);
        }
      }

      // ì´ë¯¸ì§€ ì—…ë¡œë“œ
      uploadAvatar(file, playerData) {
        const formData = new FormData();
        formData.append('avatar', file);

        this.addLog('system', 'ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘...');

        fetch('/api/upload-avatar', {
          method: 'POST',
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          if (data.ok) {
            playerData.avatar = data.url;
            this.socket.emit('admin:add_player', playerData);
            this.addLog('system', 'ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ');
          } else {
            this.showToast(`ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨: ${data.error}`, 'error');
          }
        })
        .catch(error => {
          console.error('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì—ëŸ¬:', error);
          this.showToast('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
        });
      }

      // ë§í¬ ìƒì„±
      generateLinks() {
        if (!this.battleData || this.battleData.players.length === 0) {
          this.showToast('ë¨¼ì € í”Œë ˆì´ì–´ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.', 'error');
          return;
        }

        const baseUrl = window.location.origin;
        const battleId = this.battleData.id;

        // í”Œë ˆì´ì–´ ë§í¬ë“¤
        this.playerLinks.innerHTML = '';
        this.battleData.players.forEach(player => {
          const playerUrl = `${baseUrl}/player?battle=${battleId}&name=${encodeURIComponent(player.name)}&token=${player.token}`;
          
          const linkItem = document.createElement('div');
          linkItem.className = 'link-item';
          linkItem.innerHTML = `
            <div class="link-label">${player.name} (${player.team === 'phoenix' ? 'ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨' : 'ì£½ìŒì„ ë¨¹ëŠ” ìë“¤'})</div>
            <div class="link-url" onclick="navigator.clipboard.writeText('${playerUrl}').then(() => window.pyxisAdmin.showToast('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success'))">${playerUrl}</div>
          `;
          this.playerLinks.appendChild(linkItem);
        });

        // ê´€ì „ì ë§í¬
        const spectatorUrl = `${baseUrl}/spectator?battle=${battleId}`;
        this.spectatorLink.innerHTML = `
          <div class="link-item">
            <div class="link-label">ê´€ì „ì ë§í¬ (ìµœëŒ€ 30ëª…)</div>
            <div class="link-url" onclick="navigator.clipboard.writeText('${spectatorUrl}').then(() => window.pyxisAdmin.showToast('ê´€ì „ì ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success'))">${spectatorUrl}</div>
          </div>
        `;

        this.linkSection.style.display = 'block';
        this.addLog('system', 'ì ‘ì† ë§í¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. í´ë¦­í•˜ì—¬ ë³µì‚¬í•˜ì„¸ìš”.');
        this.showToast('ë§í¬ ìƒì„± ì™„ë£Œ! í´ë¦­í•˜ì—¬ ë³µì‚¬í•˜ì„¸ìš”.', 'success');
      }

      // ì±„íŒ… ì „ì†¡
      sendChat() {
        const message = this.chatInputEl.value.trim();
        if (!message || !this.socket || !this.isConnected) return;

        if (message.length > 200) {
          this.showToast('ë©”ì‹œì§€ëŠ” ìµœëŒ€ 200ê¸€ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
          return;
        }

        this.socket.emit('admin:chat', { message });
        this.chatInputEl.value = '';
        this.chatInputEl.focus();
      }

      // UI ì—…ë°ì´íŠ¸
      updateUI() {
        if (!this.battleData) return;

        // ì „íˆ¬ ì •ë³´
        this.battleIdEl.textContent = this.battleData.id;
        this.battleStatusEl.textContent = this.getStatusText(this.battleData.status);
        this.battleStatusEl.className = `battle-status status-${this.battleData.status}`;

        // íŒ€ ë¡œìŠ¤í„°
        this.updateTeamRoster();
        this.updateButtons();
      }

      // íŒ€ ë¡œìŠ¤í„° ì—…ë°ì´íŠ¸
      updateTeamRoster() {
        if (!this.battleData) return;

        const phoenixPlayers = this.battleData.players.filter(p => p.team === 'phoenix');
        const deathPlayers = this.battleData.players.filter(p => p.team === 'death');

        // ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨
        this.phoenixTeamEl.innerHTML = '';
        if (phoenixPlayers.length === 0) {
          this.phoenixTeamEl.innerHTML = '<div class="empty-state">íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        } else {
          phoenixPlayers.forEach(player => {
            this.phoenixTeamEl.appendChild(this.createPlayerItem(player));
          });
        }

        // ì£½ìŒì„ ë¨¹ëŠ” ìë“¤
        this.deathTeamEl.innerHTML = '';
        if (deathPlayers.length === 0) {
          this.deathTeamEl.innerHTML = '<div class="empty-state">íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        } else {
          deathPlayers.forEach(player => {
            this.deathTeamEl.appendChild(this.createPlayerItem(player));
          });
        }
      }

      // í”Œë ˆì´ì–´ ì•„ì´í…œ ìƒì„±
      createPlayerItem(player) {
        const div = document.createElement('div');
        div.className = 'player-item';
        
        const status = player.isConnected ? (player.isReady ? 'ready' : 'waiting') : 'offline';
        const statusText = player.isConnected ? (player.isReady ? 'ì¤€ë¹„ì™„ë£Œ' : 'ëŒ€ê¸°ì¤‘') : 'ì˜¤í”„ë¼ì¸';
        
        const hpPercent = Math.max(0, (player.hp / player.maxHp) * 100).toFixed(0);
        
        div.innerHTML = `
          <img class="player-avatar" src="${player.avatar || '/assets/images/default-avatar.png'}" alt="${player.name}">
          <div class="player-info">
            <div class="player-name">${player.name}</div>
            <div class="player-stats">ê³µ:${player.stats.attack} ë°©:${player.stats.defense} ë¯¼:${player.stats.agility} í–‰:${player.stats.luck} | HP: ${player.hp}/${player.maxHp} (${hpPercent}%)</div>
            <div class="player-items">ë””í„°ë‹ˆ:${player.items.dittany} ê³µê²©ë³´ì •:${player.items.attack_booster} ë°©ì–´ë³´ì •:${player.items.defense_booster}</div>
          </div>
          <div class="player-status status-${status}">${statusText}</div>
        `;
        
        return div;
      }

      // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
      updateButtons() {
        if (!this.battleData) return;

        const hasPlayers = this.battleData.players.length >= 2;
        const allReady = this.battleData.players.length > 0 && this.battleData.players.every(p => p.isReady);
        
        this.btnStartBattle.disabled = this.battleData.status !== 'waiting' || !hasPlayers || !allReady;
        this.btnEndBattle.disabled = this.battleData.status === 'ended';
        this.btnGenerateLinks.disabled = !this.currentBattleId || this.battleData.players.length === 0;
        this.btnAddPlayer.disabled = this.battleData.status === 'active';
      }

      // í†µê³„ ì—…ë°ì´íŠ¸
      updateStatistics(stats) {
        if (!stats) return;

        this.statPlayersEl.textContent = `${stats.connectedPlayers}/${stats.totalPlayers}`;
        this.statSpectatorsEl.textContent = stats.spectators || 0;
        this.statTurnEl.textContent = stats.turnNumber || 0;
        
        if (stats.uptime) {
          const minutes = Math.floor(stats.uptime / 60000);
          const seconds = Math.floor((stats.uptime % 60000) / 1000);
          this.statUptimeEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
      }

      // ì§„í–‰ ì‹œê°„ ì‹œì‘
      startUptime() {
        this.startTime = Date.now();
        this.uptimeInterval = setInterval(() => {
          const elapsed = Date.now() - this.startTime;
          const minutes = Math.floor(elapsed / 60000);
          const seconds = Math.floor((elapsed % 60000) / 1000);
          this.statUptimeEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);
      }

      // ì§„í–‰ ì‹œê°„ ì¤‘ì§€
      stopUptime() {
        if (this.uptimeInterval) {
          clearInterval(this.uptimeInterval);
          this.uptimeInterval = null;
        }
      }

      // í”Œë ˆì´ì–´ í¼ ì´ˆê¸°í™”
      clearPlayerForm() {
        this.playerNameEl.value = '';
        this.statAttackEl.value = '3';
        this.statDefenseEl.value = '3';
        this.statAgilityEl.value = '3';
        this.statLuckEl.value = '3';
        this.itemDittanyEl.value = '1';
        this.itemAttackEl.value = '1';
        this.itemDefenseEl.value = '1';
        this.playerAvatarEl.value = '';
      }

      // ë¡œê·¸ ì¶”ê°€
      addLog(type, message) {
        const div = document.createElement('div');
        div.className = `log-entry ${type || 'system'}`;
        
        const timestamp = new Date().toLocaleTimeString();
        div.textContent = `[${timestamp}] ${message}`;
        
        this.battleLogEl.appendChild(div);
        this.battleLogEl.scrollTop = this.battleLogEl.scrollHeight;

        // ë¡œê·¸ê°€ ë„ˆë¬´ ë§ìœ¼ë©´ ì˜¤ë˜ëœ ê²ƒ ì œê±°
        if (this.battleLogEl.children.length > 100) {
          this.battleLogEl.removeChild(this.battleLogEl.firstChild);
        }
      }

      // ì±„íŒ… ë©”ì‹œì§€ ì¶”ê°€
      addChatMessage(data) {
        const div = document.createElement('div');
        div.className = 'chat-message';
        
        const timestamp = new Date().toLocaleTimeString();
        const senderName = data.senderName || 'ìµëª…';
        const message = data.message || '';
        
        div.innerHTML = `
          <span class="sender">${senderName}</span>
          <span class="timestamp">[${timestamp}]</span>
          <div>${message}</div>
        `;
        
        this.chatContainerEl.appendChild(div);
        this.chatContainerEl.scrollTop = this.chatContainerEl.scrollHeight;

        // ì±„íŒ…ì´ ë„ˆë¬´ ë§ìœ¼ë©´ ì˜¤ë˜ëœ ê²ƒ ì œê±°
        if (this.chatContainerEl.children.length > 50) {
          this.chatContainerEl.removeChild(this.chatContainerEl.firstChild);
        }
      }

      // ìƒíƒœ í…ìŠ¤íŠ¸ ë³€í™˜
      getStatusText(status) {
        const statusTexts = {
          waiting: 'ëŒ€ê¸°',
          active: 'ì§„í–‰ì¤‘',
          paused: 'ì¼ì‹œì •ì§€',
          ended: 'ì¢…ë£Œ'
        };
        return statusTexts[status] || status;
      }

      // í† ìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ
      showToast(message, type = 'info') {
        this.toastEl.textContent = message;
        this.toastEl.className = `toast ${type}`;
        this.toastEl.classList.add('show');

        // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
        setTimeout(() => {
          this.toastEl.classList.remove('show');
        }, 3000);
      }

      // ì†Œì¼“ ì—°ê²° í•´ì œ
      disconnect() {
        if (this.socket) {
          this.socket.disconnect();
          this.socket = null;
        }
        this.stopUptime();
        this.addLog('system', 'ê´€ë¦¬ì ì½˜ì†”ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ê´€ë¦¬ì ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
    document.addEventListener('DOMContentLoaded', () => {
      window.pyxisAdmin = new PyxisAdminConsole();
      
      // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
      window.addEventListener('beforeunload', () => {
        if (window.pyxisAdmin) {
          window.pyxisAdmin.disconnect();
        }
      });
    });

    // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
    document.addEventListener('keydown', (e) => {
      // Ctrl + Enter: ì±„íŒ… ì „ì†¡
      if (e.ctrlKey && e.key === 'Enter') {
        if (window.pyxisAdmin) {
          window.pyxisAdmin.sendChat();
        }
      }
      
      // F5: ìƒˆë¡œê³ ì¹¨ ë°©ì§€ (ì‹¤ìˆ˜ ë°©ì§€)
      if (e.key === 'F5') {
        e.preventDefault();
        if (window.pyxisAdmin) {
          window.pyxisAdmin.showToast('ìƒˆë¡œê³ ì¹¨ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.', 'info');
        }
      }
    });

    // ì „ì—­ ì—ëŸ¬ í•¸ë“¤ë§
    window.addEventListener('error', (e) => {
      console.error('ì „ì—­ ì—ëŸ¬:', e);
      if (window.pyxisAdmin) {
        window.pyxisAdmin.showToast('ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      }
    });

    // ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ìƒíƒœ ê°ì§€
    window.addEventListener('online', () => {
      if (window.pyxisAdmin) {
        window.pyxisAdmin.showToast('ì¸í„°ë„· ì—°ê²°ì´ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
      }
    });

    window.addEventListener('offline', () => {
      if (window.pyxisAdmin) {
        window.pyxisAdmin.showToast('ì¸í„°ë„· ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤.', 'error');
      }
    });
  </script>
</body>
</html>        <div class="form-group">
          <label>ìŠ¤íƒ¯ ë°°ë¶„ (ê° 1-5, ì´í•© ì œí•œ ì—†ìŒ)</label>
          <div class="stats-grid">
            <input id="statAttack" type="number" class="stat-input" min="1" max="5" value="3" placeholder="ê³µê²©">
            <input id="statDefense" type="number" class="stat-input" min="1" max="5" value="3" placeholder="ë°©ì–´">
            <input id="statAgility" type="number" class="stat-input" min="1" max="5" value="3" placeholder="ë¯¼ì²©">
            <input id="statLuck" type="number" class="stat-input" min="1" max="5" value="3" placeholder="í–‰ìš´">
          </div>
          <div id="statTotal" class="stat-total valid">
            ì´í•©: 12 (ì œí•œ ì—†ìŒ)
          </div>
        </div>

        <div class="form-group">
          <label>ì‹œì‘ ì•„ì´í…œ</label>
          <div class="items-grid">
            <input id="itemDittany" type="number" class="item-input" min="0" max="5" value="1" placeholder="ë””í„°ë‹ˆ" title="ì²´ë ¥ 10 íšŒë³µ">
            <input id="itemAttack" type="number" class="item-input" min="0" max="5" value="1" placeholder="ê³µê²© ë³´ì •ê¸°" title="ê³µê²©ë ¥ 1.5ë°° (ì„±ê³µë¥  10%)">
            <input id="itemDefense" type="number" class="item-input" min="0" max="5" value="1" placeholder="ë°©ì–´ ë³´ì •ê¸°" title="ë°©ì–´ë ¥ 1.5ë°° (ì„±ê³µë¥  10%)">
          </div>
        </div>

        <div class="form-group">
          <label>ì•„ë°”íƒ€ ì´ë¯¸ì§€ (ìµœëŒ€ 5MB)</label>
          <input id="playerAvatar" type="file" accept="image/*">
        </div>

        <button id="btnAddPlayer" class="btn">ì „íˆ¬ ì°¸ê°€ì ì¶”ê°€</button>

        <!-- íŒ€ ë¡œìŠ¤í„° -->
        <div class="roster-section">
          <div class="team-roster team-phoenix">
            <div class="team-title">ğŸ”¥ ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨</div>
            <div id="phoenixTeam" class="player-list">
              <div class="empty-state">íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          </div>

          <div class="team-roster team-death">
            <div class="team-title">ğŸ’€ ì£½ìŒì„ ë¨¹ëŠ” ìë“¤</div>
            <div id="deathTeam" class="player-list">
              <div class="empty-state">íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          </div>
        </div>
      </section>

      <!-- ì˜¤ë¥¸ìª½: ë¡œê·¸ ë° ì±„íŒ… -->
      <section class="section">
        <h3>ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</h3>
        
        <div class="log-chat-container">
          <!-- ì „íˆ¬ ë¡œê·¸ -->
          <div class="log-section">
            <div class="log-title">âš”ï¸ ì „íˆ¬ ë¡œê·¸</div>
            <div id="battleLog" class="log-container">
              <div class="log-entry system">PYXIS ê´€ë¦¬ì ì½˜ì†”ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
              <div class="log-entry system">ì „íˆ¬ ë£°: ìŠ¤íƒ¯ ê° 1-5, ì²´ë ¥ ìµœëŒ€ 100, 5ë¶„ í„´ ì œí•œ</div>
            </div>
          </div>

          <!-- ì±„íŒ… -->
          <div class="chat-section">
            <div class="chat-title">ğŸ’¬ ì‹¤ì‹œê°„ ì±„íŒ…</div>
            <div id="chatContainer" class="chat-container">
              <div class="chat-message">
                <span class="sender">ì‹œìŠ¤í…œ</span>
                <span class="timestamp">[ì‹œìŠ¤í…œ]</span>
                <div>ì±„íŒ…ì„ ì‹œì‘í•˜ì„¸ìš”!</div>
              </div>
            </div>
            <div class="chat-input-container">
              <input id="chatInput" class="chat-input" type="text" placeholder="ê´€ë¦¬ì ë©”ì‹œì§€ ì…ë ¥..." maxlength="200">
              <button id="btnSendChat" class="chat-send">ì „ì†¡</button>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
  <div id="toast" class="toast"></div>

  <!-- ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="https://pyxisbattlesystem.monster/socket.io/socket.io.js"></script>
  <script>
    // ì „ì—­ ì„¤ì •
    window.PYXIS_SERVER_URL = "https://pyxisbattlesystem.monster";
    
    // PYXIS ê´€ë¦¬ì í´ë˜ìŠ¤
    class PyxisAdminConsole {
      constructor() {
        this.socket = null;
        this.battleData = null;
        this.isConnected = false;
        this.currentBattleId = null;
        this.uptimeInterval = null;
        this.startTime = null;
        
        this.initElements();
        this.initEventListeners();
        this.connectSocket();
        this.showToast('ì‹œìŠ¤í…œì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
      }

      initElements() {
        // ì „íˆ¬ ì œì–´ ìš”ì†Œë“¤
        this.battleIdEl = document.getElementById('battleId');
        this.battleStatusEl = document.getElementById('battleStatus');
        this.battleModeEl = document.getElementById('battleMode');
        this.btnCreateBattle = document.getElementById('btnCreateBattle');
        this.btnStartBattle = document.getElementById('btnStartBattle');
        this.btnEndBattle = document.getElementById('btnEndBattle');
        this.btnGenerateLinks = document.getElementById('btnGenerateLinks');
        this.linkSection = document.getElementById('linkSection');
        this.playerLinks = document.getElementById('playerLinks');
        this.spectatorLink = document.getElementById('spectatorLink');

        // í”Œë ˆì´ì–´ ê´€ë¦¬ ìš”ì†Œë“¤
        this.playerNameEl = document.getElementById('playerName');
        this.playerTeamEl = document.getElementById('playerTeam');
        this.statAttackEl = document.getElementById('statAttack');
        this.statDefenseEl = document.getElementById('statDefense');
        this.statAgilityEl = document.getElementById('statAgility');
        this.statLuckEl = document.getElementById('statLuck');
        this.statTotalEl = document.getElementById('statTotal');
        this.itemDittanyEl = document.getElementById('itemDittany');
        this.itemAttackEl = document.getElementById('itemAttack');
        this.itemDefenseEl = document.getElementById('itemDefense');
        this.playerAvatarEl = document.getElementById('playerAvatar');
        this.btnAddPlayer = document.getElementById('btnAddPlayer');
        this.phoenixTeamEl = document.getElementById('phoenixTeam');
        this.deathTeamEl = document.getElementById('deathTeam');

        // í†µê³„ ìš”ì†Œë“¤
        this.statPlayersEl = document.getElementById('statPlayers');
        this.statSpectatorsEl = document.getElementById('statSpectators');
        this.statTurnEl = document.getElementById('statTurn');
        this.statUptimeEl = document.getElementById('statUptime');

        // ë¡œê·¸ ë° ì±„íŒ… ìš”ì†Œë“¤
        this.battleLogEl = document.getElementById('battleLog');
        this.chatContainerEl = document.getElementById('chatContainer');
        this.chatInputEl = document.getElementById('chatInput');
        this.btnSendChatEl = document.getElementById('btnSendChat');

        // í† ìŠ¤íŠ¸
        this.toastEl = document.getElementById('toast');
      }

      initEventListeners() {
        // ì „íˆ¬ ì œì–´ ì´ë²¤íŠ¸
        this.btnCreateBattle.addEventListener('click', () => this.createBattle());
        this.btnStartBattle.addEventListener('click', () => this.startBattle());
        this.btnEndBattle.addEventListener('click', () => this.endBattle());
        this.btnGenerateLinks.addEventListener('click', () => this.generateLinks());

        // í”Œë ˆì´ì–´ ê´€ë¦¬ ì´ë²¤íŠ¸
        this.btnAddPlayer.addEventListener('click', () => this.addPlayer());
        
        // ìŠ¤íƒ¯ ë³€ê²½ ê°ì§€ (PYXIS ë£°: ê° 1-5, ì´í•© ì œí•œ ì—†ìŒ)
        [this.statAttackEl, this.statDefenseEl, this.statAgilityEl, this.statLuckEl].forEach(el => {
          el.addEventListener('input', (e) => {
            const value = parseInt(e.target.value);
            if (value < 1) e.target.value = 1;
            if (value > 5) e.target.value = 5;
            this.updateStatTotal();
          });
        });

        // ì•„ì´í…œ ìˆ˜ëŸ‰ ì œí•œ
        [this.itemDittanyEl, this.itemAttackEl, this.itemDefenseEl].forEach(el => {
          el.addEventListener('input', (e) => {
            const value = parseInt(e.target.value);
            if (value < 0) e.target.value = 0;
            if (value > 5) e.target.value = 5;
          });
        });

        // ì±„íŒ… ì´ë²¤íŠ¸
        this.btnSendChatEl.addEventListener('click', () => this.sendChat());
        this.chatInputEl.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            this.sendChat();
          }
        });

        // íŒŒì¼ ì—…ë¡œë“œ ê²€ì¦
        this.playerAvatarEl.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (file) {
            if (file.size > 5 * 1024 * 1024) {
              this.showToast('íŒŒì¼ í¬ê¸°ëŠ” 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.', 'error');
              e.target.value = '';
            } else if (!file.type.startsWith('image/')) {
              this.showToast('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
              e.target.value = '';
            }
          }
        });
      }

      connectSocket() {
        this.addLog('system', 'ì„œë²„ ì—°ê²° ì¤‘...');
        
        this.socket = io(window.PYXIS_SERVER_URL, {
          transports: ['websocket', 'polling'],
          timeout: 20000
        });

        // ì—°ê²° ì„±ê³µ
        this.socket.on('connect', () => {
          console.log('ê´€ë¦¬ì ì†Œì¼“ ì—°ê²°ë¨:', this.socket.id);
          this.isConnected = true;
          this.addLog('system', 'ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.');
          this.showToast('ì„œë²„ ì—°ê²° ì„±ê³µ', 'success');
        });

        // ê´€ë¦¬ì ì¸ì¦ ì„±ê³µ
        this.socket.on('auth:success', (data) => {
          console.log('ê´€ë¦¬ì ì¸ì¦ ì„±ê³µ:', data);
          this.battleData = data.battle;
          this.currentBattleId = data.battle.id;
          this.updateUI();
          this.addLog('system', `ì „íˆ¬ ID ${data.battle.id}ë¡œ ì¸ì¦ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        });

        // ì¸ì¦ ì‹¤íŒ¨
        this.socket.on('auth:error', (error) => {
          console.error('ê´€ë¦¬ì ì¸ì¦ ì‹¤íŒ¨:', error);
          this.addLog('system', `ì¸ì¦ ì‹¤íŒ¨: ${error.message}`);
          this.showToast(`ì¸ì¦ ì‹¤íŒ¨: ${error.message}`, 'error');
        });

        // ì „íˆ¬ ìƒì„± ì™„ë£Œ
        this.socket.on('battle:created', (data) => {
          console.log('ì „íˆ¬ ìƒì„±ë¨:', data);
          this.currentBattleId = data.battleId;
          this.battleIdEl.textContent = data.battleId;
          this.updateButtons();
          this.addLog('system', `ì „íˆ¬ ID ${data.battleId}ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`);
          this.showToast('ì „íˆ¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        });

        // ê´€ë¦¬ì ì—…ë°ì´íŠ¸
        this.socket.on('admin:update', (data) => {
          console.log('ê´€ë¦¬ì ì—…ë°ì´íŠ¸ ìˆ˜ì‹ :', data);
          this.battleData = data.battle;
          this.updateUI();
          if (data.statistics) {
            this.updateStatistics(data.statistics);
          }
        });

        // í”Œë ˆì´ì–´ ì¶”ê°€ ì„±ê³µ
        this.socket.on('player:added', (data) => {
          console.log('í”Œë ˆì´ì–´ ì¶”ê°€ë¨:', data);
          this.addLog('system', `ì „íˆ¬ ì°¸ê°€ì ì¶”ê°€: ${data.player.name} (${data.player.team === 'phoenix' ? 'ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨' : 'ì£½ìŒì„ ë¨¹ëŠ” ìë“¤'})`);
          this.showToast(`${data.player.name}ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
          this.clearPlayerForm();
        });

        // í”Œë ˆì´ì–´ ì¶”ê°€ ì‹¤íŒ¨
        this.socket.on('player:error', (error) => {
          console.error('í”Œë ˆì´ì–´ ì—ëŸ¬:', error);
          this.showToast(`ì˜¤ë¥˜: ${error.message}`, 'error');
        });

        // ì „íˆ¬ ì‹œì‘
        this.socket.on('battle:started', (data) => {
          console.log('ì „íˆ¬ ì‹œì‘ë¨:', data);
          this.addLog('system', `âš”ï¸ ì „íˆ¬ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤! ${data.firstTeam === 'phoenix' ? 'ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨' : 'ì£½ìŒì„ ë¨¹ëŠ” ìë“¤'}ì´ ì„ ê³µì…ë‹ˆë‹¤.`);
          this.showToast('ì „íˆ¬ ì‹œì‘!', 'success');
          this.startUptime();
        });

        // ì „íˆ¬ ì¢…ë£Œ
        this.socket.on('battle:ended', (data) => {
          console.log('ì „íˆ¬ ì¢…ë£Œë¨:', data);
          const winnerText = data.winner ? `${data.winner === 'phoenix' ? 'ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨' : 'ì£½ìŒì„ ë¨¹ëŠ” ìë“¤'}ì˜ ìŠ¹ë¦¬!` : 'ë¬´ìŠ¹ë¶€';
          this.addLog('system', `ğŸ† ì „íˆ¬ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ${winnerText}`);
          this.showToast(`ì „íˆ¬ ì¢…ë£Œ: ${winnerText}`, 'info');
          this.stopUptime();
        });

        // ì „íˆ¬ ë¡œê·¸
        this.socket.on('battle:log', (entry) => {
          this.addLog(entry.type || 'battle', entry.message);
        });

        // ì±„íŒ… ë©”ì‹œì§€
        this.socket.on('chat:message', (data) => {
          this.addChatMessage(data);
        });

        // í”Œë ˆì´ì–´ ì—°ê²°/í•´ì œ
        this.socket.on('player:connected', (data) => {
          this.addLog('system', `ğŸŸ¢ ${data.playerName}ì´ ì ‘ì†í–ˆìŠµë‹ˆë‹¤.`);
        });

        this.socket.on('player:disconnected', (data) => {
          this.addLog('system', `ğŸ”´ ${data.playerName}ì´ ì—°ê²°ì„ ëŠì—ˆìŠµë‹ˆë‹¤.`);
        });

        // í”Œë ˆì´ì–´ ì¤€ë¹„ ìƒíƒœ
        this.socket.on('player:ready_update', (data) => {
          const statusText = data.isReady ? 'ì¤€ë¹„ ì™„ë£Œ' : 'ì¤€ë¹„ ì·¨ì†Œ';
          this.addLog('system', `${data.playerName}: ${statusText}`);
        });

        // ëª¨ë“  í”Œë ˆì´ì–´ ì¤€ë¹„ ì™„ë£Œ
        this.socket.on('battle:all_ready', (data) => {
          this.addLog('system', 'âœ… ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì¤€ë¹„ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
          this.showToast('ëª¨ë“  í”Œë ˆì´ì–´ ì¤€ë¹„ ì™„ë£Œ!', 'success');
        });

        // í„´ ì‹œì‘
        this.socket.on('turn:start', (data) => {
          this.addLog('system', `ğŸ¯ ${data.playerName}ì˜ í„´ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. (í„´ ${data.turnNumber})`);
        });

        // í„´ ì¢…ë£Œ
        this.socket.on('turn:end', (data) => {
          this.addLog('system', 'í„´ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
        });

        // ê´€ì „ì ìˆ˜ ì—…ë°ì´íŠ¸
        this.socket.on('spectator:count_update', (data) => {
          this.statSpectatorsEl.textContent = data.count || 0;
        });

        // ì—°ê²° í•´ì œ
        this.socket.on('disconnect', (reason) => {
          console.log('ê´€ë¦¬ì ì†Œì¼“ ì—°ê²° ëŠì–´ì§:', reason);
          this.isConnected = false;
          this.addLog('system', 'âš ï¸ ì„œë²„ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤. ì¬ì—°ê²° ì¤‘...');
          this.showToast('ì—°ê²° ëŠì–´ì§. ì¬ì—°ê²° ì¤‘...', 'error');
        });

        // ì¬ì—°ê²° ì„±ê³µ
        this.socket.on('reconnect', (attemptNumber) => {
          console.log('ê´€ë¦¬ì ì†Œì¼“ ì¬ì—°ê²°ë¨:', attemptNumber);
          this.addLog('system', 'âœ… ì„œë²„ì— ì¬ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.');
          this.showToast('ì¬ì—°ê²° ì„±ê³µ!', 'success');
        });

        // ì—°ê²° ì˜¤ë¥˜
        this.socket.on('connect_error', (error) => {
          console.error('ì†Œì¼“ ì—°ê²° ì˜¤ë¥˜:', error);
          this.addLog('system', `âŒ ì—°ê²° ì˜¤ë¥˜: ${error.message}`);
          this.showToast('ì—°ê²° ì‹¤íŒ¨', 'error');
        });
      }

      // ì „íˆ¬ ìƒì„±
      createBattle() {
        if (!this.socket || !this.isConnected) {
          this.showToast('ì„œë²„ì— ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
          return;
        }
        
        const mode = this.battleModeEl.value;
        this.addLog('system', `${mode} ì „íˆ¬ ìƒì„± ì¤‘...`);
        this.socket.emit('admin:create_battle', { mode });
      }

      // ì „íˆ¬ ì‹œì‘
      startBattle() {
        if (!this.socket || !this.isConnected || !this.currentBattleId) {
          this.showToast('ì „íˆ¬ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
          return;
        }
        
        if (confirm('ì „íˆ¬ë¥¼ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâ€¢ ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì¤€ë¹„ ì™„ë£Œ ìƒíƒœì—¬ì•¼ í•©ë‹ˆë‹¤\nâ€¢ ì‹œì‘ í›„ì—ëŠ” í”Œë ˆì´ì–´ ì¶”ê°€ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤')) {
          this.addLog('system', 'ì „íˆ¬ ì‹œì‘ ìš”ì²­ ì¤‘...');
          this.socket.emit('admin:start_battle', { battleId: this.currentBattleId });
        }
      }

      // ì „íˆ¬ ì¢…ë£Œ
      endBattle() {
        if (!this.socket || !this.isConnected || !this.currentBattleId) {
          this.showToast('ì „íˆ¬ë¥¼ ì¢…ë£Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
          return;
        }
        
        if (confirm('ì „íˆ¬ë¥¼ ê°•ì œë¡œ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì§„í–‰ ì¤‘ì¸ ëª¨ë“  ì•¡ì…˜ì´ ì¤‘ë‹¨ë©ë‹ˆë‹¤.')) {
          this.addLog('system', 'ì „íˆ¬ ì¢…ë£Œ ìš”ì²­ ì¤‘...');
          this.socket.emit('admin:end_battle', { battleId: this.currentBattleId });
        }
      }

      // í”Œë ˆì´ì–´ ì¶”ê°€
      addPlayer() {
        if (!this.socket || !this.isConnected || !this.currentBattleId) {
          this.showToast('í”Œë ˆì´ì–´ë¥¼ ì¶”ê°€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
          return;
        }

        const name = this.playerNameEl.value.trim();
        if (!name) {
          this.showToast('ì „íˆ¬ ì°¸ê°€ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
          this.playerNameEl.focus();
          return;
        }

        if (name.length > 20) {
          this.showToast('ì´ë¦„ì€ ìµœëŒ€ 20ê¸€ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
          return;
        }

        // PYXIS ë£° ì ìš©: ê° ìŠ¤íƒ¯ 1-5, ì´í•© ì œí•œ ì—†ìŒ
        const stats = {
          attack: Math.max(1, Math.min(5, parseInt(this.statAttackEl.value) || 3)),
          defense: Math.max(1, Math.min(5, parseInt(this.statDefenseEl.value) || 3)),
          agility: Math.max(1, Math.min(5, parseInt(this.statAgilityEl.value) || 3)),
          luck: Math.max(1, Math.min(5, parseInt(this.statLuckEl.value) || 3))
        };

        const items = {
          dittany: Math.max(0, Math.min(5, parseInt(this.itemDittanyEl.value) || 0)),
          attack_booster: Math.max(0, Math.min(5, parseInt(this.itemAttackEl.value) || 0)),
          defense_booster: Math.max(0, Math.min(5, parseInt(this.itemDefenseEl.value) || 0))
        };

        const playerData = {
          name,
          team: this.playerTeamEl.value,
          stats,
          items,
          hp: 100, // PYXIS ë£°: ì²´ë ¥ ìµœëŒ€ 100
          maxHp: 100
        };

        // ì•„ë°”íƒ€ ì—…ë¡œë“œ ì²˜ë¦¬
        const avatarFile = this.playerAvatarEl.files[0];
        if (avatarFile) {
          this.uploadAvatar(avatarFile, playerData);
        } else {
          this.socket.emit('admin:add_player', playerData);
        }
      }

      // ì•„ë°”íƒ€ ì—…ë¡œë“œ
      uploadAvatar(file, playerData) {
        const formData = new FormData();
        formData.append('avatar', file);

        this.addLog('system', 'ì•„ë°”íƒ€ ì—…ë¡œë“œ ì¤‘...');

        fetch('/api/upload-avatar', {
          method: 'POST',
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          if (data.ok) {
            playerData.avatar = data.url;
            this.socket.emit('admin:add_player', playerData);
            this.addLog('system', 'ì•„ë°”íƒ€ ì—…ë¡œë“œ ì™„ë£Œ');
          } else {
            this.showToast(`ì•„ë°”íƒ€ ì—…ë¡œë“œ ì‹¤íŒ¨: ${data.error}`, 'error');
          }
        })
        .catch(error => {
          console.error('ì•„ë°”íƒ€ ì—…ë¡œë“œ ì—ëŸ¬:', error);
          this.showToast('ì•„ë°”íƒ€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
        });
      }

      // ë§í¬ ìƒì„±
      generateLinks() {
        if (!this.battleData || this.battleData.players.length === 0) {
          this.showToast('ë¨¼ì € í”Œë ˆì´ì–´ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.', 'error');
          return;
        }

        const baseUrl = window.location.origin;
        const battleId = this.battleData.id;

        // í”Œë ˆì´ì–´ ë§í¬ë“¤
        this.playerLinks.innerHTML = '';
        this.battleData.players.forEach(player => {
          const playerUrl = `${baseUrl}/player?battle=${battleId}&name=${encodeURIComponent(player.name)}&token=${player.token}`;
          
          const linkItem = document.createElement('div');
          linkItem.className = 'link-item';
          linkItem.innerHTML = `
            <div class="link-label">${player.name} (${player.team === 'phoenix' ? 'ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨' : 'ì£½ìŒì„ ë¨¹ëŠ” ìë“¤'})</div>
            <div class="link-url" onclick="navigator.clipboard.writeText('${playerUrl}').then(() => window.pyxisAdmin.showToast('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success'))">${playerUrl}</div>
          `;
          this.playerLinks.appendChild(linkItem);
        });

        // ê´€ì „ì ë§í¬
        const spectatorUrl = `${baseUrl}/spectator?battle=${battleId}`;
        this.spectatorLink.innerHTML = `
          <div class="link-item">
            <div class="link-label">ğŸ‘€ ê´€ì „ì ë§í¬ (ìµœëŒ€ 30ëª…)</div>
            <div class="link-url" onclick="navigator.clipboard.writeText('${spectatorUrl}').then(() => window.pyxisAdmin.showToast('ê´€ì „ì ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success'))">${spectatorUrl}</div>
          </div>
        `;

        this.linkSection.style.display = 'block';
        this.addLog('system', 'ì ‘ì† ë§í¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. í´ë¦­í•˜ì—¬ ë³µì‚¬í•˜ì„¸ìš”.');
        this.showToast('ë§í¬ ìƒì„± ì™„ë£Œ! í´ë¦­í•˜ì—¬ ë³µì‚¬í•˜ì„¸ìš”.', 'success');
      }

      // ì±„íŒ… ì „ì†¡
      sendChat() {
        const message = this.chatInputEl.value.trim();
        if (!message || !this.socket || !this.isConnected) return;

        if (message.length > 200) {
          this.showToast('ë©”ì‹œì§€ëŠ” ìµœëŒ€ 200ê¸€ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
          return;
        }

        this.socket.emit('admin:chat', { message });
        this.chatInputEl.value = '';
        this.chatInputEl.focus();
      }

      // ìŠ¤íƒ¯ ì´í•© ì—…ë°ì´íŠ¸ (PYXIS ë£°: ì œí•œ ì—†ìŒ)
      updateStatTotal() {
        const total = parseInt(this.statAttackEl.value || 0) +
                     parseInt(this.statDefenseEl.value || 0) +
                     parseInt(this.statAgilityEl.value || 0) +
                     parseInt(this.statLuckEl.value || 0);
        
        this.statTotalEl.textContent = `ì´í•©: ${total} (ì œí•œ ì—†ìŒ)`;
        this.statTotalEl.className = 'stat-total valid'; // í•­ìƒ ìœ íš¨
      }

      // UI ì—…ë°ì´íŠ¸
      updateUI() {
        if (!this.battleData) return;

        // ì „íˆ¬ ì •ë³´
        this.battleIdEl.textContent = this.battleData.id;
        this.battleStatusEl.textContent = this.getStatusText(this.battleData.status);
        this.battleStatusEl.className = `battle-status status-${this.battleData.status}`;

        // íŒ€ ë¡œìŠ¤í„°
        this.updateTeamRoster();
        this.updateButtons();
      }

      // íŒ€ ë¡œìŠ¤í„° ì—…ë°ì´íŠ¸
      updateTeamRoster() {
        if (!this.battleData) return;

        const phoenixPlayers = this.battleData.players.filter(p => p.team === 'phoenix');
        const deathPlayers = this.battleData.players.filter(p => p.team === 'death');

        // ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨
        this.phoenixTeamEl.innerHTML = '';
        if (phoenixPlayers.length === 0) {
          this.phoenixTeamEl.innerHTML = '<div class="empty-state">íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        } else {
          phoenixPlayers.forEach(player => {
            this.phoenixTeamEl.appendChild(this.createPlayerItem(player));
          });
        }

        // ì£½ìŒì„ ë¨¹ëŠ” ìë“¤
        this.deathTeamEl.innerHTML = '';
        if (deathPlayers.length === 0) {
          this.deathTeamEl.innerHTML = '<div class="empty-state">íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        } else {
          deathPlayers.forEach(player => {
            this.deathTeamEl.appendChild(this.createPlayerItem(player));
          });
        }
      }

      // í”Œë ˆì´ì–´ ì•„ì´í…œ ìƒì„±
      createPlayerItem(player) {
        const div = document.createElement('div');
        div.className = 'player-item';
        
        const status = player.isConnected ? (player.isReady ? 'ready' : 'waiting') : 'offline';
        const statusText = player.isConnected ? (player.isReady ? 'ì¤€ë¹„ì™„ë£Œ' : 'ëŒ€ê¸°ì¤‘') : 'ì˜¤í”„ë¼ì¸';
        
        const hpPercent = Math.max(0, (player.hp / player.maxHp) * 100).toFixed(0);
        
        div.innerHTML = `
          <img class="player-avatar" src="${player.avatar || '/assets/images/default-avatar.png'}" alt="${player.name}">
          <div class="player-info">
            <div class="player-name">${player.name}</div>
            <div class="player-stats">ê³µ:${player.stats.attack} ë°©:${player.stats.defense} ë¯¼:${player.stats.agility} í–‰:${player.stats.luck} | HP: ${player.hp}/${player.maxHp} (${hpPercent}%)</div>
            <div class="player-items">ë””í„°ë‹ˆ:${player.items.dittany} ê³µê²©ë³´ì •:${player.items.attack_booster} ë°©ì–´ë³´ì •:${player.items.defense_booster}</div>
          </div>
          <div class="player-status status-${status}">${statusText}</div>
        `;
        
        return div;
      }

      // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
      updateButtons() {
        if (!this.battleData) return;

        const hasPlayers = this.battleData.players.length >= 2;
        const hasEvenTeams = this.getTeamBalance();
        const allReady = this.battleData.players.length > 0 && this.battleData.players.every(p => p.isReady);
        
        this.btnStartBattle.disabled = this.battleData.<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PYXIS Battle System - ê´€ë¦¬ì</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/pyxis-theme.css">
  <style>
    /* PYXIS ê´€ë¦¬ì í˜ì´ì§€ ì™„ì „ í†µí•© ìŠ¤íƒ€ì¼ */
    
    /* ê¸°ë³¸ ì„¤ì • */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      font-family: 'Cinzel', serif;
      background: var(--deep-navy);
      color: var(--text);
      line-height: 1.6;
      letter-spacing: 0.01em;
      overflow-x: hidden;
    }

    /* ì»¨í…Œì´ë„ˆ */
    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* í—¤ë” */
    .header {
      background: var(--glass-2);
      backdrop-filter: var(--blur-light);
      border-bottom: 1px solid var(--border-light);
      padding: 20px 0;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: var(--shadow-soft);
    }

    .title {
      text-align: center;
      font-family: var(--serif);
      color: var(--gold-bright);
    }

    .title-main {
      font-size: 36px;
      font-weight: 800;
      letter-spacing: 3px;
      text-shadow: 0 4px 8px rgba(0,0,0,0.5);
      background: linear-gradient(135deg, var(--gold), var(--gold-bright));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .title-sub {
      font-size: 16px;
      font-weight: 400;
      color: var(--text-muted);
      margin-left: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* ë©”ì¸ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
    .admin-grid {
      display: grid;
      grid-template-columns: 400px 1fr 400px;
      gap: 24px;
      padding: 24px 0;
      align-items: start;
      min-height: calc(100vh - 100px);
    }

    @media (max-width: 1400px) {
      .admin-grid {
        grid-template-columns: 350px 1fr 350px;
      }
    }

    @media (max-width: 1200px) {
      .admin-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }
    }

    /* ì¹´ë“œ ê³µí†µ ìŠ¤íƒ€ì¼ */
    .section {
      background: var(--glass-2);
      backdrop-filter: var(--blur-light);
      border: 1px solid var(--border-light);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow-soft);
      transition: all var(--transition-fast);
      height: fit-content;
    }

    .section:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }

    .section h3 {
      font-family: var(--serif);
      font-size: 22px;
      font-weight: 700;
      color: var(--gold-bright);
      margin-bottom: 24px;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      position: relative;
    }

    .section h3::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--gold), transparent);
    }

    /* ì „íˆ¬ ì •ë³´ ì¹´ë“œ */
    .battle-info {
      background: var(--glass-1);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-large);
      padding: 24px;
      margin-bottom: 24px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .battle-info::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--gold), var(--gold-bright), var(--gold));
    }

    .battle-id {
      font-size: 28px;
      font-weight: 800;
      color: var(--gold-bright);
      font-family: var(--serif);
      margin-bottom: 12px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      letter-spacing: 2px;
    }

    .battle-status {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      display: inline-block;
      box-shadow: var(--shadow-subtle);
    }

    .status-waiting {
      background: linear-gradient(135deg, var(--warning), #f39c12);
      color: white;
    }

    .status-active {
      background: linear-gradient(135deg, var(--success), #27ae60);
      color: white;
    }

    .status-ended {
      background: linear-gradient(135deg, var(--danger), #c0392b);
      color: white;
    }

    /* í¼ ìš”ì†Œë“¤ */
    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-accent);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      background: var(--glass-1);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-small);
      padding: 14px 16px;
      color: var(--text);
      font-size: 14px;
      font-family: var(--serif);
      transition: all var(--transition-fast);
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(212, 183, 126, 0.2);
      background: var(--glass-2);
      transform: translateY(-1px);
    }

    /* ìŠ¤íƒ¯ ê·¸ë¦¬ë“œ */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .stat-input {
      text-align: center;
      font-weight: 700;
      font-size: 16px;
    }

    .stat-total {
      text-align: center;
      font-size: 14px;
      font-weight: 600;
      margin-top: 8px;
      padding: 8px;
      border-radius: var(--radius-small);
      background: var(--glass-1);
    }

    .stat-total.valid {
      color: var(--success);
      border: 1px solid var(--success);
    }

    .stat-total.invalid {
      color: var(--danger);
      border: 1px solid var(--danger);
    }

    /* ì•„ì´í…œ ê·¸ë¦¬ë“œ */
    .items-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .item-input {
      text-align: center;
      font-weight: 600;
    }

    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .btn {
      background: linear-gradient(135deg, var(--gold), var(--gold-bright));
      color: var(--deep-navy);
      border: none;
      border-radius: var(--radius-small);
      padding: 14px 20px;
      font-family: var(--serif);
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all var(--transition-fast);
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: var(--shadow-soft);
      width: 100%;
      margin-bottom: 12px;
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.6s;
    }

    .btn:hover:not(:disabled) {
      background: linear-gradient(135deg, var(--gold-bright), var(--gold-shimmer));
      transform: translateY(-3px);
      box-shadow: var(--shadow-medium);
    }

    .btn:hover:not(:disabled)::before {
      left: 100%;
    }

    .btn:active:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: var(--shadow-soft);
    }

    .btn:disabled {
      background: var(--glass-1);
      color: var(--text-muted);
      cursor: not-allowed;
      transform: none;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }

    .btn.danger {
      background: linear-gradient(135deg, var(--danger), #c0392b);
      color: white;
    }

    .btn.danger:hover:not(:disabled) {
      background: linear-gradient(135deg, #c0392b, #a93226);
    }

    .btn.success {
      background: linear-gradient(135deg, var(--success), #229954);
      color: white;
    }

    .btn.success:hover:not(:disabled) {
      background: linear-gradient(135deg, #229954, #1e8449);
    }

    .btn.info {
      background: linear-gradient(135deg, var(--info), #2980b9);
      color: white;
    }

    .btn.info:hover:not(:disabled) {
      background: linear-gradient(135deg, #2980b9, #1f618d);
    }

    /* ì œì–´ ë²„íŠ¼ ê·¸ë¦¬ë“œ */
    .control-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 16px;
    }

    /* íŒ€ ë¡œìŠ¤í„° */
    .roster-section {
      margin-top: 24px;
    }

    .team-roster {
      background: var(--glass-1);
      border: 1px solid var(--border-light);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 20px;
      position: relative;
    }

    .team-roster::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--gold), var(--gold-bright));
      border-radius: var(--radius) var(--radius) 0 0;
    }

    .team-title {
      font-weight: 700;
      color: var(--gold-bright);
      margin-bottom: 16px;
      text-align: center;
      font-size: 18px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .team-phoenix .team-title {
      color: #ff6b35;
    }

    .team-death .team-title {
      color: #34495e;
    }

    .player-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .player-item {
      background: var(--glass-2);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-small);
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 16px;
      transition: all var(--transition-fast);
    }

    .player-item:hover {
      background: var(--glass-3);
      border-color: var(--border-light);
      transform: translateX(4px);
    }

    .player-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--gold);
      box-shadow: var(--shadow-subtle);
    }

    .player-info {
      flex: 1;
    }

    .player-name {
      font-weight: 700;
      color: var(--text);
      margin-bottom: 6px;
      font-size: 16px;
    }

    .player-stats {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .player-items {
      font-size: 11px;
      color: var(--text-accent);
    }

    .player-status {
      padding: 6px 12px;
      border-radius: 16px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-ready {
      background: var(--success-light);
      color: var(--success);
      border: 1px solid var(--success);
    }

    .status-waiting {
      background: var(--warning-light);
      color: var(--warning);
      border: 1px solid var(--warning);
    }

    .status-offline {
      background: var(--danger-light);
      color: var(--danger);
      border: 1px solid var(--danger);
    }

    /* í†µê³„ ê·¸ë¦¬ë“œ */
    .statistics-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: var(--glass-1);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-small);
      padding: 16px;
      text-align: center;
      transition: all var(--transition-fast);
    }

    .stat-card:hover {
      background: var(--glass-2);
      border-color: var(--border-light);
      transform: translateY(-2px);
    }

    .stat-value {
      font-size: 24px;
      font-weight: 800;
      color: var(--gold-bright);
      font-family: var(--serif);
      margin-bottom: 6px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }

    /* ë¡œê·¸ ë° ì±„íŒ… ì»¨í…Œì´ë„ˆ */
    .log-chat-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      height: 100%;
    }

    .log-section, .chat-section {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .log-title, .chat-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--gold-bright);
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      text-align: center;
    }

    .log-container, .chat-container {
      background: var(--glass-1);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-small);
      height: 320px;
      overflow-y: auto;
      padding: 16px;
      font-size: 13px;
      line-height: 1.6;
      flex: 1;
    }

    .log-container::-webkit-scrollbar,
    .chat-container::-webkit-scrollbar {
      width: 8px;
    }

    .log-container::-webkit-scrollbar-track,
    .chat-container::-webkit-scrollbar-track {
      background: var(--glass-2);
      border-radius: 4px;
    }

    .log-container::-webkit-scrollbar-thumb,
    .chat-container::-webkit-scrollbar-thumb {
      background: var(--gold);
      border-radius: 4px;
    }

    .log-container::-webkit-scrollbar-thumb:hover,
    .chat-container::-webkit-scrollbar-thumb:hover {
      background: var(--gold-bright);
    }

    .log-entry, .chat-message {
      margin-bottom: 8px;
      padding: 12px 16px;
      border-radius: var(--radius-small);
      background: var(--glass-2);
      border-left: 3px solid transparent;
      transition: all var(--transition-fast);
      word-wrap: break-word;
    }

    .log-entry:hover, .chat-message:hover {
      background: var(--glass-3);
      transform: translateX(3px);
    }

    .log-entry.system {
      border-left-color: var(--gold);
      background: rgba(212, 183, 126, 0.08);
      color: var(--text-accent);
    }

    .log-entry.battle {
      border-left-color: var(--info);
      background: rgba(52, 152, 219, 0.08);
      color: var(--text);
    }

    .log-entry.chat {
      border-left-color: var(--success);
      background: var(--success-light);
      color: #96ffc8;
    }

    .chat-message {
      border-left-color: var(--success);
      background: rgba(39, 174, 96, 0.08);
    }

    .chat-message .sender {
      font-weight: 700;
      color: var(--gold-bright);
    }

    .chat-message .timestamp {
      font-size: 11px;
      color: var(--text-muted);
      margin-left: 8px;
    }

    /* ì±„íŒ… ì…ë ¥ */
    .chat-input-container {
      display: flex;
      gap: 12px;
      margin-top: 12px;
    }

    .chat-input {
      flex: 1;
      background: var(--glass-1);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-small);
      padding: 12px 16px;
      color: var(--text);
      font-size: 14px;
      font-family: var(--serif);
      transition: all var(--transition-fast);
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 2px rgba(212, 183, 126, 0.2);
      background: var(--glass-2);
    }

    .chat-input::placeholder {
      color: var(--text-muted);
      font-style: italic;
    }

    .chat-send {
      background: linear-gradient(135deg, var(--success), #27ae60);
      color: white;
      border: none;
      border-radius: var(--radius-small);
      padding: 12px 20px;
      font-family: var(--serif);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-fast);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      min-width: 80px;
    }

    .chat-send:hover {
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      transform: translateY(-2px);
      box-shadow: var(--shadow-soft);
    }

    /* ë§í¬ ì„¹ì…˜ */
    .link-section {
      background: var(--glass-1);
      border: 1px solid var(--border-light);
      border-radius: var(--radius);
      padding: 20px;
      margin-top: 20px;
    }

    .link-section h4 {
      color: var(--gold-bright);
      margin-bottom: 16px;
      text-align: center;
      font-size: 16px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .link-item {
      margin-bottom: 16px;
      padding: 12px;
      background: var(--glass-2);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-small);
      transition: all var(--transition-fast);
    }

    .link-item:hover {
      background: var(--glass-3);
      border-color: var(--border-light);
    }

    .link-label {
      font-size: 12px;
      color: var(--text-accent);
      font-weight: 600;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .link-url {
      font-size: 11px;
      color: var(--text-muted);
      font-family: 'JetBrains Mono', monospace;
      word-break: break-all;
      background: var(--navy-surface);
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: all var(--transition-fast);
      border: 1px solid var(--border-subtle);
    }

    .link-url:hover {
      color: var(--gold-bright);
      border-color: var(--gold);
      background: var(--glass-1);
    }

    /* ë¹ˆ ìƒíƒœ */
    .empty-state {
      text-align: center;
      color: var(--text-muted);
      padding: 40px 20px;
      font-style: italic;
    }

    /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid var(--glass-2);
      border-top: 2px solid var(--gold);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ì•Œë¦¼ í† ìŠ¤íŠ¸ */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--glass-2);
      backdrop-filter: var(--blur-light);
      border: 1px solid var(--border-light);
      border-radius: var(--radius);
      padding: 16px 20px;
      color: var(--text);
      box-shadow: var(--shadow-medium);
      z-index: 1000;
      transform: translateX(400px);
      transition: transform var(--transition-fast);
    }

    .toast.show {
      transform: translateX(0);
    }

    .toast.success {
      border-left: 4px solid var(--success);
    }

    .toast.error {
      border-left: 4px solid var(--danger);
    }

    .toast.info {
      border-left: 4px solid var(--info);
    }

    /* ë°˜ì‘í˜• ë””ìì¸ */
    @media (max-width: 768px) {
      .container {
        padding: 0 16px;
      }
      
      .admin-grid {
        padding: 16px 0;
        gap: 16px;
      }
      
      .section {
        padding: 20px;
      }
      
      .title-main {
        font-size: 28px;
        letter-spacing: 2px;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .control-grid {
        grid-template-columns: 1fr;
      }
      
      .statistics-grid {
        grid-template-columns: 1fr;
      }
      
      .log-container, .chat-container {
        height: 250px;
      }
    }

    @media (max-width: 480px) {
      .items-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .title-main {
        font-size: 24px;
        letter-spacing: 1px;
      }
    }
  </style>
</head>
<body>
  <!-- í—¤ë” -->
  <header class="header">
    <div class="container">
      <h1 class="title">
        <span class="title-main">PYXIS</span>
        <span class="title-sub">ê´€ë¦¬ì ì½˜ì†”</span>
      </h1>
    </div>
  </header>

  <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
  <main class="container">
    <div class="admin-grid">
      <!-- ì™¼ìª½: ì „íˆ¬ ì œì–´ -->
      <section class="section">
        <h3>ì „íˆ¬ ì œì–´</h3>
        
        <!-- ì „íˆ¬ ì •ë³´ -->
        <div class="battle-info">
          <div id="battleId" class="battle-id">ëŒ€ê¸° ì¤‘</div>
          <div id="battleStatus" class="battle-status status-waiting">ëŒ€ê¸°</div>
        </div>

        <!-- ì „íˆ¬ ìƒì„± -->
        <div class="form-group">
          <label>ì „íˆ¬ ëª¨ë“œ</label>
          <select id="battleMode">
            <option value="1v1">1ëŒ€1</option>
            <option value="2v2">2ëŒ€2</option>
            <option value="3v3">3ëŒ€3</option>
            <option value="4v4">4ëŒ€4</option>
          </select>
        </div>
        
        <button id="btnCreateBattle" class="btn">ì „íˆ¬ ìƒì„±</button>

        <!-- ì „íˆ¬ ì œì–´ ë²„íŠ¼ -->
        <div class="control-grid">
          <button id="btnStartBattle" class="btn success" disabled>ì „íˆ¬ ì‹œì‘</button>
          <button id="btnEndBattle" class="btn danger" disabled>ì „íˆ¬ ì¢…ë£Œ</button>
        </div>

        <!-- ë§í¬ ìƒì„± -->
        <button id="btnGenerateLinks" class="btn info" disabled>ë§í¬ ìƒì„±</button>

        <!-- ìƒì„±ëœ ë§í¬ë“¤ -->
        <div id="linkSection" class="link-section" style="display: none;">
          <h4>ìƒì„±ëœ ë§í¬</h4>
          <div id="playerLinks"></div>
          <div id="spectatorLink"></div>
        </div>

        <!-- í†µê³„ -->
        <div class="statistics-grid">
          <div class="stat-card">
            <div id="statPlayers" class="stat-value">0</div>
            <div class="stat-label">ì ‘ì† í”Œë ˆì´ì–´</div>
          </div>
          <div class="stat-card">
            <div id="statSpectators" class="stat-value">0</div>
            <div class="stat-label">ê´€ì „ì</div>
          </div>
          <div class="stat-card">
            <div id="statTurn" class="stat-value">0</div>
            <div class="stat-label">í˜„ì¬ í„´</div>
          </div>
          <div class="stat-card">
            <div id="statUptime" class="stat-value">0:00</div>
            <div class="stat-label">ì§„í–‰ ì‹œê°„</div>
          </div>
        </div>
      </section>

      <!-- ì¤‘ì•™: ì°¸ê°€ì ê´€ë¦¬ -->
      <section class="section">
        <h3>ì°¸ê°€ì ê´€ë¦¬</h3>
        
        <!-- í”Œë ˆì´ì–´ ì¶”ê°€ í¼ -->
        <div class="form-group">
          <label>ì „íˆ¬ ì°¸ê°€ì ì´ë¦„</label>
          <input id="playerName" type="text" placeholder="ì „íˆ¬ ì°¸ê°€ì ì´ë¦„ (ìµœëŒ€ 20ê¸€ì)" maxlength="20">
        </div>

        <div class="form-group">
          <label>íŒ€ ì„ íƒ</label>
          <select id="playerTeam">
            <option value="phoenix">ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨</option>
            <option value="death">ì£½ìŒì„ ë¨¹ëŠ” ìë“¤</option>
          </select>
        </div>

        <div class="form-group">
          <label>ìŠ¤<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PYXIS Battle System - ê´€ë¦¬ì</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/pyxis-theme.css">
  <link rel="stylesheet" href="/assets/css/admin.css">
  <style>
    /* ê´€ë¦¬ì í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
    .admin-container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 24px;
    }

    .admin-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 24px;
      align-items: start;
    }

    @media (max-width: 1200px) {
      .admin-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }
    }

    .section {
      background: var(--glass-2);
      backdrop-filter: var(--blur-light);
      border: 1px solid var(--border-light);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow-soft);
    }

    .section h3 {
      font-family: var(--serif);
      font-size: 20px;
      font-weight: 600;
      color: var(--gold-bright);
      margin-bottom: 20px;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-accent);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      background: var(--glass-1);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-small);
      padding: 12px 16px;
      color: var(--text);
      font-size: 14px;
      font-family: var(--serif);
      transition: all var(--transition-fast);
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 2px rgba(212, 183, 126, 0.2);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-bottom: 16px;
    }

    .stat-input {
      text-align: center;
      font-weight: 600;
    }

    .items-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-bottom: 16px;
    }

    .btn {
      background: linear-gradient(135deg, var(--gold), var(--gold-bright));
      color: var(--deep-navy);
      border: none;
      border-radius: var(--radius-small);
      padding: 12px 16px;
      font-family: var(--serif);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-fast);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: var(--shadow-soft);
      width: 100%;
      margin-bottom: 8px;
    }

    .btn:hover:not(:disabled) {
      background: linear-gradient(135deg, var(--gold-bright), var(--gold-shimmer));
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }

    .btn:disabled {
      background: var(--glass-1);
      color: var(--text-muted);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn.danger {
      background: linear-gradient(135deg, var(--danger), #c0392b);
      color: white;
    }

    .btn.danger:hover:not(:disabled) {
      background: linear-gradient(135deg, #c0392b, #a93226);
    }

    .btn.success {
      background: linear-gradient(135deg, var(--success), #229954);
      color: white;
    }

    .btn.success:hover:not(:disabled) {
      background: linear-gradient(135deg, #229954, #1e8449);
    }

    .control-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 16px;
    }

    .roster-section {
      margin-top: 20px;
    }

    .team-roster {
      background: var(--glass-1);
      border-radius: var(--radius-small);
      padding: 16px;
      margin-bottom: 16px;
    }

    .team-title {
      font-weight: 600;
      color: var(--gold-bright);
      margin-bottom: 12px;
      text-align: center;
    }

    .player-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .player-item {
      background: var(--glass-2);
      border-radius: var(--radius-small);
      padding: 12px;
      border: 1px solid var(--border-subtle);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .player-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--gold);
    }

    .player-info {
      flex: 1;
    }

    .player-name {
      font-weight: 600;
      color: var(--text);
      margin-bottom: 4px;
    }

    .player-stats {
      font-size: 12px;
      color: var(--text-muted);
    }

    .player-status {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-ready {
      background: var(--success-light);
      color: var(--success);
    }

    .status-waiting {
      background: var(--warning-light);
      color: var(--warning);
    }

    .status-offline {
      background: var(--danger-light);
      color: var(--danger);
    }

    .battle-info {
      background: var(--glass-1);
      border-radius: var(--radius-small);
      padding: 16px;
      margin-bottom: 16px;
      text-align: center;
    }

    .battle-id {
      font-size: 24px;
      font-weight: 700;
      color: var(--gold-bright);
      font-family: var(--serif);
      margin-bottom: 8px;
    }

    .battle-status {
      padding: 6px 12px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      display: inline-block;
    }

    .status-waiting {
      background: var(--warning-light);
      color: var(--warning);
    }

    .status-active {
      background: var(--success-light);
      color: var(--success);
    }

    .status-ended {
      background: var(--danger-light);
      color: var(--danger);
    }

    .log-container {
      background: var(--glass-1);
      border-radius: var(--radius-small);
      height: 300px;
      overflow-y: auto;
      padding: 16px;
      font-size: 13px;
      line-height: 1.6;
    }

    .log-container::-webkit-scrollbar {
      width: 6px;
    }

    .log-container::-webkit-scrollbar-track {
      background: var(--glass-2);
      border-radius: 3px;
    }

    .log-container::-webkit-scrollbar-thumb {
      background: var(--gold);
      border-radius: 3px;
    }

    .log-entry {
      margin-bottom: 8px;
      padding: 8px 12px;
      border-radius: var(--radius-small);
      background: var(--glass-2);
      border-left: 3px solid var(--border-light);
    }

    .log-entry.system {
      border-left-color: var(--gold);
      background: rgba(212, 183, 126, 0.05);
    }

    .log-entry.battle {
      border-left-color: var(--info);
      background: rgba(52, 152, 219, 0.05);
    }

    .log-entry.chat {
      border-left-color: var(--success);
      background: var(--success-light);
      color: #96ffc8;
    }

    .chat-input-container {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    .chat-input {
      flex: 1;
      background: var(--glass-1);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-small);
      padding: 8px 12px;
      color: var(--text);
      font-size: 14px;
    }

    .chat-send {
      background: linear-gradient(135deg, var(--gold), var(--gold-bright));
      color: var(--deep-navy);
      border: none;
      border-radius: var(--radius-small);
      padding: 8px 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-fast);
      min-width: 60px;
    }

    .statistics-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .stat-card {
      background: var(--glass-1);
      border-radius: var(--radius-small);
      padding: 12px;
      text-align: center;
      border: 1px solid var(--border-subtle);
    }

    .stat-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--gold-bright);
      font-family: var(--serif);
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .link-section {
      background: var(--glass-1);
      border-radius: var(--radius-small);
      padding: 16px;
      margin-top: 16px;
    }

    .link-item {
      margin-bottom: 12px;
      padding: 8px;
      background: var(--glass-2);
      border-radius: var(--radius-small);
      border: 1px solid var(--border-subtle);
    }

    .link-label {
      font-size: 12px;
      color: var(--text-accent);
      font-weight: 600;
      margin-bottom: 4px;
    }

    .link-url {
      font-size: 11px;
      color: var(--text-muted);
      font-family: monospace;
      word-break: break-all;
      background: var(--navy-surface);
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
    }

    .link-url:hover {
      color: var(--gold-bright);
    }
  </style>
</head>
<body>
  <!-- í—¤ë” -->
  <header class="header">
    <div class="container">
      <h1 class="title">
        <span class="title-main">PYXIS</span>
        <span class="title-sub">ê´€ë¦¬ì ì½˜ì†”</span>
      </h1>
    </div>
  </header>

  <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
  <main class="admin-container">
    <div class="admin-grid">
      <!-- ì™¼ìª½: ì „íˆ¬ ì œì–´ -->
      <section class="section">
        <h3>ì „íˆ¬ ì œì–´</h3>
        
        <!-- ì „íˆ¬ ì •ë³´ -->
        <div class="battle-info">
          <div id="battleId" class="battle-id">ëŒ€ê¸° ì¤‘</div>
          <div id="battleStatus" class="battle-status status-waiting">ëŒ€ê¸°</div>
        </div>

        <!-- ì „íˆ¬ ìƒì„± -->
        <div class="form-group">
          <label>ì „íˆ¬ ëª¨ë“œ</label>
          <select id="battleMode">
            <option value="1v1">1ëŒ€1</option>
            <option value="2v2">2ëŒ€2</option>
            <option value="3v3">3ëŒ€3</option>
            <option value="4v4">4ëŒ€4</option>
          </select>
        </div>
        
        <button id="btnCreateBattle" class="btn">ì „íˆ¬ ìƒì„±</button>

        <!-- ì „íˆ¬ ì œì–´ ë²„íŠ¼ -->
        <div class="control-grid">
          <button id="btnStartBattle" class="btn success" disabled>ì „íˆ¬ ì‹œì‘</button>
          <button id="btnEndBattle" class="btn danger" disabled>ì „íˆ¬ ì¢…ë£Œ</button>
        </div>

        <!-- ë§í¬ ìƒì„± -->
        <button id="btnGenerateLinks" class="btn" disabled>ë§í¬ ìƒì„±</button>

        <!-- ìƒì„±ëœ ë§í¬ë“¤ -->
        <div id="linkSection" class="link-section" style="display: none;">
          <h4 style="color: var(--gold-bright); margin-bottom: 12px;">ìƒì„±ëœ ë§í¬</h4>
          <div id="playerLinks"></div>
          <div id="spectatorLink"></div>
        </div>

        <!-- í†µê³„ -->
        <div class="statistics-grid">
          <div class="stat-card">
            <div id="statPlayers" class="stat-value">0</div>
            <div class="stat-label">ì ‘ì† í”Œë ˆì´ì–´</div>
          </div>
          <div class="stat-card">
            <div id="statSpectators" class="stat-value">0</div>
            <div class="stat-label">ê´€ì „ì</div>
          </div>
          <div class="stat-card">
            <div id="statTurn" class="stat-value">0</div>
            <div class="stat-label">í˜„ì¬ í„´</div>
          </div>
          <div class="stat-card">
            <div id="statUptime" class="stat-value">0:00</div>
            <div class="stat-label">ì§„í–‰ ì‹œê°„</div>
          </div>
        </div>
      </section>

      <!-- ì¤‘ì•™: ì°¸ê°€ì ê´€ë¦¬ -->
      <section class="section">
        <h3>ì°¸ê°€ì ê´€ë¦¬</h3>
        
        <!-- í”Œë ˆì´ì–´ ì¶”ê°€ í¼ -->
        <div class="form-group">
          <label>í”Œë ˆì´ì–´ ì´ë¦„</label>
          <input id="playerName" type="text" placeholder="í”Œë ˆì´ì–´ ì´ë¦„" maxlength="20">
        </div>

        <div class="form-group">
          <label>íŒ€ ì„ íƒ</label>
          <select id="playerTeam">
            <option value="phoenix">ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨</option>
            <option value="death">ì£½ìŒì„ ë¨¹ëŠ” ìë“¤</option>
          </select>
        </div>

        <div class="form-group">
          <label>ìŠ¤íƒ¯ ë°°ë¶„ (ì´ 12í¬ì¸íŠ¸)</label>
          <div class="stats-grid">
            <input id="statAttack" type="number" class="stat-input" min="1" max="5" value="3" placeholder="ê³µê²©">
            <input id="statDefense" type="number" class="stat-input" min="1" max="5" value="3" placeholder="ë°©ì–´">
            <input id="statAgility" type="number" class="stat-input" min="1" max="5" value="3" placeholder="ë¯¼ì²¨">
            <input id="statLuck" type="number" class="stat-input" min="1" max="5" value="3" placeholder="í–‰ìš´">
          </div>
          <div id="statTotal" style="text-align: center; color: var(--text-muted); font-size: 12px;">
            ì´í•©: 12 / 12
          </div>
        </div>

        <div class="form-group">
          <label>ì‹œì‘ ì•„ì´í…œ</label>
          <div class="items-grid">
            <input id="itemDittany" type="number" min="0" max="5" value="1" placeholder="ë””í„°ë‹ˆ">
            <input id="itemAttack" type="number" min="0" max="5" value="1" placeholder="ê³µê²© ë³´ì •ê¸°">
            <input id="itemDefense" type="number" min="0" max="5" value="1" placeholder="ë°©ì–´ ë³´ì •ê¸°">
          </div>
        </div>

        <div class="form-group">
          <label>ì•„ë°”íƒ€ ì´ë¯¸ì§€</label>
          <input id="playerAvatar" type="file" accept="image/*">
        </div>

        <button id="btnAddPlayer" class="btn">í”Œë ˆì´ì–´ ì¶”ê°€</button>

        <!-- íŒ€ ë¡œìŠ¤í„° -->
        <div class="roster-section">
          <div class="team-roster">
            <div class="team-title">ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨</div>
            <div id="phoenixTeam" class="player-list">
              <div style="text-align: center; color: var(--text-muted); padding: 20px;">
                íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤
              </div>
            </div>
          </div>

          <div class="team-roster">
            <div class="team-title">ì£½ìŒì„ ë¨¹ëŠ” ìë“¤</div>
            <div id="deathTeam" class="player-list">
              <div style="text-align: center; color: var(--text-muted); padding: 20px;">
                íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ì˜¤ë¥¸ìª½: ë¡œê·¸ ë° ì±„íŒ… -->
      <section class="section">
        <h3>ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</h3>
        
        <!-- ì „íˆ¬ ë¡œê·¸ -->
        <div style="margin-bottom: 20px;">
          <h4 style="color: var(--gold-bright); margin-bottom: 8px;">ì „íˆ¬ ë¡œê·¸</h4>
          <div id="battleLog" class="log-container">
            <div class="log-entry system">ê´€ë¦¬ì ì½˜ì†”ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
          </div>
        </div>

        <!-- ì±„íŒ… -->
        <div>
          <h4 style="color: var(--gold-bright); margin-bottom: 8px;">ì±„íŒ…</h4>
          <div id="chatLog" class="log-container" style="height: 200px;">
            <div class="log-entry system">ì±„íŒ…ì„ ì‹œì‘í•˜ì„¸ìš”!</div>
          </div>
          <div class="chat-input-container">
            <input id="chatInput" class="chat-input" type="text" placeholder="ë©”ì‹œì§€ ì…ë ¥..." maxlength="200">
            <button id="btnSendChat" class="chat-send">ì „ì†¡</button>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="https://pyxisbattlesystem.monster/socket.io/socket.io.js"></script>
  <script>
    // ì „ì—­ ì„¤ì •
    window.PYXIS_SERVER_URL = "https://pyxisbattlesystem.monster";
    
    // ê´€ë¦¬ì í´ë˜ìŠ¤
    class PyxisAdmin {
      constructor() {
        this.socket = null;
        this.battleData = null;
        this.isConnected = false;
        this.currentBattleId = null;
        
        this.initElements();
        this.initEventListeners();
        this.connectSocket();
      }

      initElements() {
        // ì „íˆ¬ ì œì–´
        this.battleIdEl = document.getElementById('battleId');
        this.battleStatusEl = document.getElementById('battleStatus');
        this.battleModeEl = document.getElementById('battleMode');
        this.btnCreateBattle = document.getElementById('btnCreateBattle');
        this.btnStartBattle = document.getElementById('btnStartBattle');
        this.btnEndBattle = document.getElementById('btnEndBattle');
        this.btnGenerateLinks = document.getElementById('btnGenerateLinks');
        this.linkSection = document.getElementById('linkSection');
        this.playerLinks = document.getElementById('playerLinks');
        this.spectatorLink = document.getElementById('spectatorLink');

        // í”Œë ˆì´ì–´ ê´€ë¦¬
        this.playerNameEl = document.getElementById('playerName');
        this.playerTeamEl = document.getElementById('playerTeam');
        this.statAttackEl = document.getElementById('statAttack');
        this.statDefenseEl = document.getElementById('statDefense');
        this.statAgilityEl = document.getElementById('statAgility');
        this.statLuckEl = document.getElementById('statLuck');
        this.statTotalEl = document.getElementById('statTotal');
        this.itemDittanyEl = document.getElementById('itemDittany');
        this.itemAttackEl = document.getElementById('itemAttack');
        this.itemDefenseEl = document.getElementById('itemDefense');
        this.playerAvatarEl = document.getElementById('playerAvatar');
        this.btnAddPlayer = document.getElementById('btnAddPlayer');
        this.phoenixTeamEl = document.getElementById('phoenixTeam');
        this.deathTeamEl = document.getElementById('deathTeam');

        // í†µê³„
        this.statPlayersEl = document.getElementById('statPlayers');
        this.statSpectatorsEl = document.getElementById('statSpectators');
        this.statTurnEl = document.getElementById('statTurn');
        this.statUptimeEl = document.getElementById('statUptime');

        // ë¡œê·¸ ë° ì±„íŒ…
        this.battleLogEl = document.getElementById('battleLog');
        this.chatLogEl = document.getElementById('chatLog');
        this.chatInputEl = document.getElementById('chatInput');
        this.btnSendChatEl = document.getElementById('btnSendChat');
      }

      initEventListeners() {
        // ì „íˆ¬ ì œì–´
        this.btnCreateBattle.addEventListener('click', () => this.createBattle());
        this.btnStartBattle.addEventListener('click', () => this.startBattle());
        this.btnEndBattle.addEventListener('click', () => this.endBattle());
        this.btnGenerateLinks.addEventListener('click', () => this.generateLinks());

        // í”Œë ˆì´ì–´ ê´€ë¦¬
        this.btnAddPlayer.addEventListener('click', () => this.addPlayer());
        
        // ìŠ¤íƒ¯ ì´í•© ì²´í¬
        [this.statAttackEl, this.statDefenseEl, this.statAgilityEl, this.statLuckEl].forEach(el => {
          el.addEventListener('input', () => this.updateStatTotal());
        });

        // ì±„íŒ…
        this.btnSendChatEl.addEventListener('click', () => this.sendChat());
        this.chatInputEl.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') this.sendChat();
        });
      }

      connectSocket() {
        this.socket = io(window.PYXIS_SERVER_URL);

        this.socket.on('connect', () => {
          console.log('ê´€ë¦¬ì ì†Œì¼“ ì—°ê²°ë¨');
          this.isConnected = true;
          this.addLog('system', 'ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.');
        });

        this.socket.on('auth:success', (data) => {
          console.log('ê´€ë¦¬ì ì¸ì¦ ì„±ê³µ:', data);
          this.battleData = data.battle;
          this.currentBattleId = data.battle.id;
          this.updateUI();
        });

        this.socket.on('auth:error', (error) => {
          console.error('ê´€ë¦¬ì ì¸ì¦ ì‹¤íŒ¨:', error);
          this.addLog('system', `ì¸ì¦ ì‹¤íŒ¨: ${error.message}`);
        });

        this.socket.on('battle:created', (data) => {
          console.log('ì „íˆ¬ ìƒì„±ë¨:', data);
          this.currentBattleId = data.battleId;
          this.battleIdEl.textContent = data.battleId;
          this.updateButtons();
        });

        this.socket.on('admin:update', (data) => {
          console.log('ê´€ë¦¬ì ì—…ë°ì´íŠ¸:', data);
          this.battleData = data.battle;
          this.updateUI();
          this.updateStatistics(data.statistics);
        });

        this.socket.on('player:added', (data) => {
          console.log('í”Œë ˆì´ì–´ ì¶”ê°€ë¨:', data);
          this.addLog('system', `í”Œë ˆì´ì–´ ì¶”ê°€: ${data.player.name}`);
          this.clearPlayerForm();
        });

        this.socket.on('player:error', (error) => {
          console.error('í”Œë ˆì´ì–´ ì—ëŸ¬:', error);
          alert(`ì˜¤ë¥˜: ${error.message}`);
        });

        this.socket.on('battle:log', (entry) => {
          this.addLog(entry.type || 'system', entry.message);
        });

        this.socket.on('chat:message', (data) => {
          this.addChatMessage(data);
        });

        this.socket.on('player:connected', (data) => {
          this.addLog('system', `${data.playerName}ì´ ì ‘ì†í–ˆìŠµë‹ˆë‹¤.`);
        });

        this.socket.on('player:disconnected', (data) => {
          this.addLog('system', `${data.playerName}ì´ ì—°ê²°ì„ ëŠì—ˆìŠµë‹ˆë‹¤.`);
        });

        this.socket.on('disconnect', () => {
          console.log('ê´€ë¦¬ì ì†Œì¼“ ì—°ê²° ëŠì–´ì§');
          this.isConnected = false;
          this.addLog('system', 'ì„œë²„ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤. ì¬ì—°ê²° ì¤‘...');
        });
      }

      createBattle() {
        if (!this.socket || !this.isConnected) return;
        
        const mode = this.battleModeEl.value;
        this.socket.emit('admin:create_battle', { mode });
      }

      startBattle() {
        if (!this.socket || !this.isConnected || !this.currentBattleId) return;
        
        if (confirm('ì „íˆ¬ë¥¼ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          this.socket.emit('admin:start_battle', { battleId: this.currentBattleId });
        }
      }

      endBattle() {
        if (!this.socket || !this.isConnected || !this.currentBattleId) return;
        
        if (confirm('ì „íˆ¬ë¥¼ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          this.socket.emit('admin:end_battle', { battleId: this.currentBattleId });
        }
      }

      addPlayer() {
        if (!this.socket || !this.isConnected || !this.currentBattleId) return;

        const name = this.playerNameEl.value.trim();
        if (!name) {
          alert('í”Œë ˆì´ì–´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.');
          return;
        }

        const stats = {
          attack: parseInt(this.statAttackEl.value) || 3,
          defense: parseInt(this.statDefenseEl.value) || 3,
          agility: parseInt(this.statAgilityEl.value) || 3,
          luck: parseInt(this.statLuckEl.value) || 3
        };

        const total = Object.values(stats).reduce((sum, val) => sum + val, 0);
        if (total !== 12) {
          alert('ìŠ¤íƒ¯ ì´í•©ì´ 12ê°€ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.');
          return;
        }

        const items = {
          dittany: parseInt(this.itemDittanyEl.value) || 0,
          attack_booster: parseInt(this.itemAttackEl.value) || 0,
          defense_booster: parseInt(this.itemDefenseEl.value) || 0
        };

        const playerData = {
          name,
          team: this.playerTeamEl.value,
          stats,
          items,
          hp: 100,
          maxHp: 100
        };

        // ì•„ë°”íƒ€ ì—…ë¡œë“œ ì²˜ë¦¬
        const avatarFile = this.playerAvatarEl.files[0];
        if (avatarFile) {
          this.uploadAvatar(avatarFile, playerData);
        } else {
          this.socket.emit('admin:add_player', playerData);
        }
      }

      uploadAvatar(file, playerData) {
        const formData = new FormData();
        formData.append('avatar', file);

        fetch('/api/upload-avatar', {
          method: 'POST',
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          if (data.ok) {
            playerData.avatar = data.url;
            this.socket.emit('admin:add_player', playerData);
          } else {
            alert('ì•„ë°”íƒ€ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + data.error);
          }
        })
        .catch(error => {
          console.error('ì•„ë°”íƒ€ ì—…ë¡œë“œ ì—ëŸ¬:', error);
          alert('ì•„ë°”íƒ€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
      }

      generateLinks() {
        if (!this.battleData) return;

        const baseUrl = window.location.origin;
        const battleId = this.battleData.id;

        // í”Œë ˆì´ì–´ ë§í¬ë“¤
        this.playerLinks.innerHTML = '';
        this.battleData.players.forEach(player => {
          const playerUrl = `${baseUrl}/player?battle=${battleId}&name=${encodeURIComponent(player.name)}&token=${player.token}`;
          
          const linkItem = document.createElement('div');
          linkItem.className = 'link-item';
          linkItem.innerHTML = `
            <div class="link-label">${player.name} (${player.team === 'phoenix' ? 'ë¶ˆì‚¬ì¡°' : 'ì£½ìŒì„ ë¨¹ëŠ” ì'}íŒ€)</div>
            <div class="link-url" onclick="navigator.clipboard.writeText('${playerUrl}')">${playerUrl}</div>
          `;
          this.playerLinks.appendChild(linkItem);
        });

        // ê´€ì „ì ë§í¬
        const spectatorUrl = `${baseUrl}/spectator?battle=${battleId}`;
        this.spectatorLink.innerHTML = `
          <div class="link-item">
            <div class="link-label">ê´€ì „ì ë§í¬</div>
            <div class="link-url" onclick="navigator.clipboard.writeText('${spectatorUrl}')">${spectatorUrl}</div>
          </div>
        `;

        this.linkSection.style.display = 'block';
      }

      sendChat() {
        const message = this.chatInputEl.value.trim();
        if (!message || !this.socket || !this.isConnected) return;

        this.socket.emit('admin:chat', { message });
        this.chatInputEl.value = '';
      }

      updateStatTotal() {
        const total = parseInt(this.statAttackEl.value || 0) +
                     parseInt(this.statDefenseEl.value || 0) +
                     parseInt(this.statAgilityEl.value || 0) +
                     parseInt(this.statLuckEl.value || 0);
        
        this.statTotalEl.textContent = `ì´í•©: ${total} / 12`;
        this.statTotalEl.style.color = total === 12 ? 'var(--success)' : 'var(--danger)';
      }

      updateUI() {
        if (!this.battleData) return;

        // ì „íˆ¬ ì •ë³´
        this.battleIdEl.textContent = this.battleData.id;
        this.battleStatusEl.textContent = this.getStatusText(this.battleData.status);
        this.battleStatusEl.className = `battle-status status-${this.battleData.status}`;

        // íŒ€ ë¡œìŠ¤í„°
        this.updateTeamRoster();
        this.updateButtons();
      }

      updateTeamRoster() {
        if (!this.battleData) return;

        const phoenixPlayers = this.battleData.players.filter(p => p.team === 'phoenix');
        const deathPlayers = this.battleData.players.filter(p => p.team === 'death');

        // ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨
        this.phoenixTeamEl.innerHTML = '';
        if (phoenixPlayers.length === 0) {
          this.phoenixTeamEl.innerHTML = '<div style="text-align: center; color: var(--text-muted); padding: 20px;">íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        } else {
          phoenixPlayers.forEach(player => {
            this.phoenixTeamEl.appendChild(this.createPlayerItem(player));
          });
        }

        // ì£½ìŒì„ ë¨¹ëŠ” ìë“¤
        this.deathTeamEl.innerHTML = '';
        if (deathPlayers.length === 0) {
          this.deathTeamEl.innerHTML = '<div style="text-align: center; color: var(--text-muted); padding: 20px;">íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        } else {
          deathPlayers.forEach(player => {
            this.deathTeamEl.appendChild(this.createPlayerItem(player));
          });
        }
      }

      createPlayerItem(player) {
        const div = document.createElement('div');
        div.className = 'player-item';
        
        const status = player.isConnected ? (player.isReady ? 'ready' : 'waiting') : 'offline';
        const statusText = player.isConnected ? (player.isReady ? 'ì¤€ë¹„ì™„ë£Œ' : 'ëŒ€ê¸°ì¤‘') : 'ì˜¤í”„ë¼ì¸';
        
        div.innerHTML = `
          <img class="player-avatar" src="${player.avatar || '/assets/images/default-avatar.png'}" alt="${player.name}">
          <div class="player-info">
            <div class="player-name">${player.name}</div>
            <div class="player-stats">ê³µ:${player.stats.attack} ë°©:${player.stats.defense} ë¯¼:${player.stats.agility} í–‰:${player.stats.luck}</div>
          </div>
          <div class="player-status status-${status}">${statusText}</div>
        `;
        
        return div;
      }

      updateButtons() {
        if (!this.battleData) return;

        const hasPlayers = this.battleData.players.length >= 2;
        const allReady = this.battleData.players.every(p => p.isReady);
        
        this.btnStartBattle.disabled = this.battleData.status !== 'waiting' || !hasPlayers || !allReady;
        this.btnEndBattle.disabled = this.battleData.status === 'ended';
        this.btnGenerateLinks.disabled = !this.currentBattleId || this.battleData.players.length === 0;
        this.btnAddPlayer.disabled = this.battleData.status === 'active';
      }

      updateStatistics(stats) {
        if (!stats) return;

        this.statPlayersEl.textContent = `${stats.connectedPlayers}/${stats.totalPlayers}`;
        this.statSpectatorsEl.textContent = stats.spectators || 0;
        this.statTurnEl.textContent = stats.turnNumber || 0;
        
        if (stats.uptime) {
          const minutes = Math.floor(stats.uptime / 60000);
          const seconds = Math.floor((stats.uptime % 60000) / 1000);
          this.statUptimeEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
      }

      clearPlayerForm() {
        this.playerNameEl.value = '';
        this.statAttackEl.value = '3';
        this.statDefenseEl.value = '3';
        this.statAgilityEl.value = '3';
        this.statLuckEl.value = '3';
        this.itemDittanyEl.value = '1';
        this.itemAttackEl.value = '1';
        this.itemDefenseEl.value = '1';
        this.playerAvatarEl.value = '';
        this.updateStatTotal();
      }

      addLog(type, message) {
        const div = document.createElement('div');
        div.className = `log-entry ${type || 'system'}`;
        div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        
        this.battleLogEl.appendChild(div);
        this.battleLogEl.scrollTop = this.battleLogEl.scrollHeight;

        // ë¡œê·¸ê°€ ë„ˆë¬´ ë§ìœ¼ë©´ ì˜¤ë˜ëœ ê²ƒ ì œê±°
        if (this.battleLogEl.children.length > 100) {
          this.battleLogEl.removeChild(this.battleLogEl.firstChild);
        }
      }

      addChatMessage(data) {
        const div = document.createElement('div');
        div.className = 'log-entry chat';
        
        const timestamp = new Date().toLocaleTimeString();
        div.textContent = `[${timestamp}] ${data.senderName}: ${data.message}`;
        
        this.chatLogEl.appendChild(div);
        this.chatLogEl.scrollTop = this.chatLogEl.scrollHeight;

        // ì±„íŒ…ì´ ë„ˆë¬´ ë§ìœ¼ë©´ ì˜¤ë˜ëœ ê²ƒ ì œê±°
        if (this.chatLogEl.children.length > 50) {
          this.chatLogEl.removeChild(this.chatLogEl.firstChild);
        }
      }

      getStatusText(status) {
        const statusTexts = {
          waiting: 'ëŒ€ê¸°',
          active: 'ì§„í–‰ì¤‘',
          paused: 'ì¼ì‹œì •ì§€',
          ended: 'ì¢…ë£Œ'
        };
        return statusTexts[status] || status;
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ê´€ë¦¬ì ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
    document.addEventListener('DOMContentLoaded', () => {
      window.pyxisAdmin = new PyxisAdmin();
    });
  </script>
</body>
</html>
