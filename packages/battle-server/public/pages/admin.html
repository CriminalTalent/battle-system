<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>PYXIS | 전투 관리석</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&family=Playfair+Display:wght@500;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="/socket.io/socket.io.js"></script>
  <style>
    /* ─────────────────────────────────────────────────────────
       PYXIS Admin – Elegant Navy & Gold UI (Design-only)
       - No emojis
       - Rules & app logic unchanged
       - Responsive, glass, shimmer, twinkle, hover lift
       - Keep common IDs to avoid breaking existing scripts
       ───────────────────────────────────────────────────────── */

    :root{
      /* Core palette */
      --gold-1:#DCC7A2; /* primary gold */
      --gold-2:#D4BA8D; /* secondary gold */
      --navy-1:#00080D; /* primary navy (bg) */
      --navy-2:#001E35; /* secondary navy (surfaces) */

      /* Neutrals */
      --ink:#EAE5D6;
      --ink-dim:#BEB7A3;
      --border-subtle:rgba(220,199,162,.24);
      --border-strong:rgba(220,199,162,.5);

      /* Glass & shadow */
      --glass:rgba(0,8,13,.55);
      --glass-2:rgba(0,30,53,.38);
      --glass-soft:rgba(220,199,162,.06);
      --shadow:0 10px 30px rgba(0,0,0,.45);
      --ring:0 0 0 1px var(--border-strong);

      /* Radii & spacing */
      --r-lg:16px;
      --r-md:12px;
      --r-sm:10px;
      --space-xxl:40px;
      --space-xl:28px;
      --space-lg:20px;
      --space-md:14px;
      --space-sm:10px;
      --space-xs:6px;

      /* Motion */
      --ease: cubic-bezier(.2,.8,.2,1);
      --dur-1:.25s;
      --dur-2:.6s;

      /* State colors */
      --state-wait:#6b7280;
      --state-live:#3a8e5a;
      --state-end:#b14b4b;

      /* Gradients */
      --grad-gold:linear-gradient(135deg,var(--gold-1),var(--gold-2));
      --grad-navy:radial-gradient(1200px 1200px at 0% 0%, #001a2f 0%, #000b13 60%, #00080d 100%);
    }

    /* Base */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      color:var(--ink);
      background:var(--navy-1);
      overflow-y:auto;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Rotating gradient halo behind header */
    .rotor{
      position:fixed; inset:-30vmax;
      background:
        radial-gradient(60vmax 60vmax at 30% 20%, rgba(212,186,141,.08), transparent 60%),
        conic-gradient(from 0deg, rgba(212,186,141,.18), rgba(220,199,162,.06), rgba(0,0,0,0) 70%);
      filter: blur(40px) saturate(120%);
      animation: spin 28s linear infinite;
      z-index:0; pointer-events:none;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Header with twinkle stars and brand */
    header.site{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(0,8,13,.85), rgba(0,8,13,.55) 55%, rgba(0,8,13,0));
      border-bottom:1px solid var(--border-subtle);
    }
    .site-inner{
      max-width:1200px; margin:0 auto; padding: clamp(14px,2vw,18px) 16px;
      display:flex; align-items:center; gap:18px;
    }
    .brand{
      display:flex; align-items:baseline; gap:12px;
    }
    .brand-logo{
      font-family:"Cinzel", serif;
      letter-spacing:.06em;
      font-weight:700;
      font-size: clamp(20px, 3.2vw, 28px);
      line-height:1;
      background:var(--grad-gold);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow: 0 0 24px rgba(212,186,141,.25);
    }
    .brand-sub{
      font-family:"Playfair Display", serif;
      font-weight:600;
      font-size: clamp(12px, 1.6vw, 14px);
      color:var(--ink-dim);
      letter-spacing:.14em;
      text-transform:uppercase;
    }
    .twinkle{
      position:relative; flex:1; height:2px; overflow:visible;
    }
    .twinkle::before, .twinkle::after{
      content:"✦";
      position:absolute; top:-8px;
      font-family:"Playfair Display", serif;
      color:var(--gold-1);
      opacity:.7; filter:drop-shadow(0 0 8px rgba(220,199,162,.45));
      animation: twinkle 2.6s var(--ease) infinite alternate;
    }
    .twinkle::before{ left:20%; animation-delay:.2s; opacity:.5 }
    .twinkle::after{ right:18%; animation-delay:1.2s }
    @keyframes twinkle {
      0% { transform: translateY(0) scale(1); opacity:.4 }
      100%{ transform: translateY(-6px) scale(1.12); opacity:.9 }
    }

    /* Layout */
    .wrap{ position:relative; z-index:1; }
    .container{
      max-width:1200px; margin:0 auto; padding: 20px 16px 60px;
      display:grid; gap:20px;
      grid-template-columns: 1.1fr .9fr;
    }
    @media (max-width: 1100px){
      .container{ grid-template-columns:1fr }
    }

    /* Cards (glass + hover lift) */
    .card{
      background:
        linear-gradient(180deg, rgba(0,12,20,.55), rgba(0,20,36,.45)),
        linear-gradient(0deg, var(--glass), var(--glass));
      border:1px solid var(--border-subtle);
      border-top:1px solid rgba(220,199,162,.25);
      border-radius:var(--r-lg);
      box-shadow: var(--shadow);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      padding:16px;
      transition: transform var(--dur-1) var(--ease), box-shadow var(--dur-1) var(--ease), border-color var(--dur-1) var(--ease);
    }
    .card:hover{ transform: translateY(-3px); border-color:var(--border-strong) }

    .card-title{
      display:flex; align-items:center; justify-content:space-between;
      font-family:"Playfair Display", serif;
      font-size: clamp(16px, 1.9vw, 18px);
      letter-spacing:.02em;
      margin:4px 0 12px;
      padding-bottom:10px;
      border-bottom:1px dashed var(--border-subtle);
      color:var(--ink);
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      font-size:12px; letter-spacing:.08em; text-transform:uppercase;
      padding:6px 10px; border-radius:999px; border:1px solid var(--border-subtle);
      background:linear-gradient(180deg, rgba(220,199,162,.08), rgba(220,199,162,.02));
      color:var(--ink);
    }
    .pill.wait{ color:var(--state-wait) }
    .pill.live{ color:var(--state-live) }
    .pill.end { color:var(--state-end)  }

    /* Buttons (gold gradient + shimmer) */
    .btn{
      appearance:none; border:none; cursor:pointer; user-select:none;
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding:10px 14px; border-radius:12px; font-weight:600; font-size:14px;
      color:#0c1217; background:var(--grad-gold);
      box-shadow: 0 8px 18px rgba(212,186,141,.2), inset 0 1px 0 rgba(255,255,255,.15);
      position:relative; overflow:hidden; transition: transform var(--dur-1) var(--ease), box-shadow var(--dur-1) var(--ease);
    }
    .btn:hover{ transform: translateY(-2px) }
    .btn:active{ transform: translateY(0) scale(.98) }
    .btn.shimmer::after{
      content:""; position:absolute; inset:0;
      background: linear-gradient(100deg, transparent 20%, rgba(255,255,255,.25) 50%, transparent 80%);
      transform: translateX(-100%);
      animation: shimmer 2.2s linear infinite;
      pointer-events:none;
    }
    @keyframes shimmer{ to{ transform:translateX(100%) } }
    .btn.ghost{
      color:var(--ink);
      background:linear-gradient(180deg, rgba(220,199,162,.06), rgba(220,199,162,.02));
      border:1px solid var(--border-subtle);
      box-shadow:none;
    }
    .btn.block{ width:100% }
    .btn-row{ display:flex; flex-wrap:wrap; gap:10px }

    /* Inputs (glass + focus gold glow) */
    .field{ display:grid; gap:6px }
    .label{ font-size:12px; letter-spacing:.06em; color:var(--ink-dim) }
    .input, select, textarea{
      width:100%; color:var(--ink); background:
        linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.15));
      border:1px solid var(--border-subtle); border-radius:12px;
      padding:10px 12px; outline:none;
      backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
      transition: border-color var(--dur-1) var(--ease), box-shadow var(--dur-1) var(--ease);
    }
    .input::placeholder{ color:rgba(234,229,214,.5) }
    .input:focus, select:focus, textarea:focus{
      border-color: var(--gold-1);
      box-shadow: 0 0 0 3px rgba(220,199,162,.16);
    }

    /* Grids */
    .grid-2{ display:grid; gap:14px; grid-template-columns: 1fr 1fr }
    @media (max-width:720px){ .grid-2{ grid-template-columns:1fr } }

    /* Sections */
    .section{ display:grid; gap:14px }
    .muted{ color:var(--ink-dim); font-size:13px }

    /* Link rows */
    .link-row{ display:grid; gap:10px }
    .copy-row{ display:grid; gap:10px; grid-template-columns: 1fr auto }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }

    /* Roster */
    .teams{
      display:grid; gap:14px; grid-template-columns: 1fr 1fr;
    }
    @media (max-width: 980px){ .teams{ grid-template-columns:1fr } }
    .team{
      border:1px solid var(--border-subtle); border-radius:var(--r-md);
      padding:12px; background:linear-gradient(180deg, rgba(0,30,53,.28), rgba(0,20,36,.14));
    }
    .team h4{
      margin:0 0 10px; font-family:"Playfair Display", serif; letter-spacing:.04em;
      color:var(--gold-1); font-weight:600; font-size:16px;
    }
    .player-row{
      display:grid; grid-template-columns: 1fr auto; align-items:center;
      padding:10px 0; border-top:1px dashed rgba(220,199,162,.14);
    }
    .player-row:first-of-type{ border-top:none; padding-top:0 }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px; border:1px solid var(--border-subtle);
      background:linear-gradient(180deg, rgba(220,199,162,.08), rgba(220,199,162,.02));
      font-size:12px; color:var(--ink);
    }
    .stat{ color:var(--ink-dim); font-size:12px; letter-spacing:.04em }

    /* Log & chat */
    .log, .chat{
      height: 340px; overflow:auto; border:1px solid var(--border-subtle);
      border-radius:12px; background:linear-gradient(180deg, rgba(0,12,20,.35), rgba(0,20,36,.18));
      padding:12px;
    }
    .log-item, .chat-item{ padding:8px 6px; border-bottom:1px dashed rgba(220,199,162,.14) }
    .log-item:last-child, .chat-item:last-child{ border-bottom:none }
    .time{ color:var(--ink-dim); font-size:12px; margin-right:8px }
    .type{ color:var(--gold-2); font-size:12px; margin-right:8px }
    .msg{ color:var(--ink) }
    .chat-input{ display:grid; grid-template-columns:1fr auto; gap:10px; margin-top:10px }

    /* Toast */
    .toast{
      position: fixed; top:16px; right:16px; z-index:30;
      transform: translateX(120%); transition: transform .28s var(--ease);
      background: linear-gradient(180deg, rgba(220,199,162,.1), rgba(220,199,162,.04));
      border:1px solid var(--border-strong); color:var(--ink);
      padding:10px 12px; border-radius:12px; box-shadow: var(--shadow);
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      font-size:14px;
    }
    .toast.show{ transform: translateX(0) }

    /* Footer spacer */
    .foot{ height: 60px }
  </style>
</head>
<body>
  <div class="rotor" aria-hidden="true"></div>

  <header class="site">
    <div class="site-inner">
      <div class="brand">
        <div class="brand-logo">PYXIS</div>
        <div class="brand-sub">Battle Administration</div>
      </div>
      <div class="twinkle" aria-hidden="true"></div>
      <div class="pill wait" id="battleStatePill">대기</div>
    </div>
  </header>

  <main class="wrap">
    <div class="container">
      <!-- Left column: Battle Controls & Roster -->
      <section class="section">
        <!-- Battle create / control -->
        <div class="card" id="battleCreateCard">
          <div class="card-title">
            <span>전투 생성</span>
            <span class="muted">모드 선택 후 생성</span>
          </div>
          <div class="grid-2">
            <div class="field">
              <label class="label" for="battleMode">전투 모드</label>
              <select id="battleMode" class="input">
                <option value="1v1">1v1</option>
                <option value="2v2" selected>2v2</option>
                <option value="3v3">3v3</option>
                <option value="4v4">4v4</option>
              </select>
            </div>
            <div class="field">
              <label class="label">전투 ID</label>
              <input id="battleId" class="input mono" type="text" placeholder="생성 시 자동 표시" readonly>
            </div>
          </div>
          <div class="btn-row" style="margin-top:12px">
            <button id="createBattleBtn" class="btn shimmer">전투 생성</button>
            <button id="startBattleBtn" class="btn ghost">전투 시작</button>
            <button id="endBattleBtn" class="btn ghost">전투 종료</button>
            <button id="restartBattleBtn" class="btn ghost">전투 재시작</button>
          </div>
        </div>

        <!-- Link generator -->
        <div class="card" id="linkCard">
          <div class="card-title">
            <span>링크 생성 및 복사</span>
            <span class="muted">역할별 OTP 자동 포함</span>
          </div>
          <div class="section link-row">
            <div class="copy-row">
              <input id="adminLink" class="input mono" type="text" placeholder="관리자 링크" readonly>
              <button class="btn shimmer" data-copy-target="#adminLink">복사</button>
            </div>
            <div class="copy-row">
              <input id="playerLink" class="input mono" type="text" placeholder="플레이어 링크" readonly>
              <button class="btn shimmer" data-copy-target="#playerLink">복사</button>
            </div>
            <div class="copy-row">
              <input id="spectatorLink" class="input mono" type="text" placeholder="관전자 링크" readonly>
              <button class="btn shimmer" data-copy-target="#spectatorLink">복사</button>
            </div>
            <div class="btn-row">
              <button id="generateLinksBtn" class="btn ghost">링크 생성</button>
            </div>
          </div>
        </div>

        <!-- Roster & add player -->
        <div class="card" id="rosterCard">
          <div class="card-title">
            <span>참여자 관리</span>
            <span class="muted">이름/팀/스탯/아이템 입력 후 등록</span>
          </div>

          <div class="grid-2">
            <div class="section">
              <div class="field">
                <label class="label" for="playerName">플레이어 이름</label>
                <input id="playerName" class="input" type="text" placeholder="예: 플레이어">
              </div>
              <div class="field">
                <label class="label" for="playerTeam">팀 선택</label>
                <select id="playerTeam" class="input">
                  <option value="phoenix">불사조 기사단</option>
                  <option value="death">죽음을 먹는 자들</option>
                </select>
              </div>
              <div class="grid-2">
                <div class="field">
                  <label class="label" for="statAtk">공격</label>
                  <input id="statAtk" class="input" type="number" min="1" max="5" value="3">
                </div>
                <div class="field">
                  <label class="label" for="statDef">방어</label>
                  <input id="statDef" class="input" type="number" min="1" max="5" value="3">
                </div>
                <div class="field">
                  <label class="label" for="statAgi">민첩</label>
                  <input id="statAgi" class="input" type="number" min="1" max="5" value="3">
                </div>
                <div class="field">
                  <label class="label" for="statLuk">행운</label>
                  <input id="statLuk" class="input" type="number" min="1" max="5" value="3">
                </div>
              </div>
              <div class="field">
                <label class="label" for="itemSelect">아이템</label>
                <select id="itemSelect" class="input">
                  <option value="">선택 없음</option>
                  <option value="attack_boost">공격 보정기</option>
                  <option value="defense_boost">방어 보정기</option>
                  <option value="diterni">디터니</option>
                </select>
              </div>
              <div class="btn-row">
                <button id="addPlayerBtn" class="btn shimmer">플레이어 추가</button>
              </div>
            </div>

            <div class="section">
              <div class="teams">
                <div class="team">
                  <h4>불사조 기사단</h4>
                  <div id="teamPhoenix" class="team-list">
                    <!-- Filled by script -->
                  </div>
                </div>
                <div class="team">
                  <h4>죽음을 먹는 자들</h4>
                  <div id="teamDeathEaters" class="team-list">
                    <!-- Filled by script -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Right column: Logs & Chat -->
      <section class="section">
        <div class="card">
          <div class="card-title">
            <span>실시간 로그</span>
            <span class="muted">중요 이벤트 타임라인</span>
          </div>
          <div id="battleLog" class="log" aria-live="polite">
            <!-- log-item rows -->
          </div>
        </div>

        <div class="card">
          <div class="card-title">
            <span>채팅</span>
            <span class="muted">관리자 공지 가능</span>
          </div>
          <div id="chatMessages" class="chat" aria-live="polite">
            <!-- chat-item rows -->
          </div>
          <div class="chat-input">
            <input id="chatInput" class="input" type="text" placeholder="메시지를 입력하세요">
            <button id="chatSendBtn" class="btn shimmer">전송</button>
          </div>
        </div>
      </section>
    </div>

    <div class="foot"></div>
  </main>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite">복사되었습니다</div>

  <script>
    /* ─────────────────────────────────────────────────────────
       Minimal UX scripts (design-only)
       - Copy buttons
       - Battle state pill helper
       - Preserve IDs used by existing app scripts
       ───────────────────────────────────────────────────────── */

    const $ = (sel,ctx=document)=>ctx.querySelector(sel);
    const $$ = (sel,ctx=document)=>Array.from(ctx.querySelectorAll(sel));

    // Copy helper
    $$("#linkCard [data-copy-target]").forEach(btn=>{
      btn.addEventListener("click", async ()=>{
        const target = $(btn.getAttribute("data-copy-target"));
        if(!target) return;
        try{
          await navigator.clipboard.writeText(target.value||target.textContent||"");
          showToast("복사되었습니다");
        }catch(e){
          showToast("복사에 실패했습니다");
        }
      });
    });

    // Toast
    const toast = $("#toast");
    let toastTimer = null;
    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> toast.classList.remove("show"), 1600);
    }

    // Battle state pill helper that external scripts can call
    // e.g., updateBattleState('live'|'wait'|'end', label)
    const battleStatePill = $("#battleStatePill");
    window.updateBattleState = function(state, label){
      battleStatePill.classList.remove("wait","live","end");
      const map = { wait:"대기", live:"진행", end:"종료" };
      battleStatePill.classList.add(state in map ? state : "wait");
      battleStatePill.textContent = label || map[state] || map.wait;
    };

    // Keep placeholders for common controls; your existing admin scripts should bind real logic.
    const createBtn   = $("#createBattleBtn");
    const startBtn    = $("#startBattleBtn");
    const endBtn      = $("#endBattleBtn");
    const restartBtn  = $("#restartBattleBtn");
    const genLinksBtn = $("#generateLinksBtn");

    // Prevent accidental form submits on Enter in inputs
    document.addEventListener("keydown",(e)=>{
      if(e.key==="Enter" && ["INPUT","SELECT"].includes(document.activeElement?.tagName)){
        e.preventDefault();
      }
    });

    // Optional gentle visual feedback
    [createBtn,startBtn,endBtn,restartBtn,genLinksBtn].forEach(b=>{
      if(!b) return;
      b.addEventListener("click",()=>{
        b.style.transform = "translateY(-1px)";
        setTimeout(()=> b.style.transform = "", 120);
      });
    });

    // Example: expose roster append helpers to integrate with existing socket handlers
    window.appendPlayerToTeam = function(team, player){
      // team: 'phoenix' | 'death'
      // player: { name, atk, def, agi, luk }
      const host = team === 'phoenix' ? $("#teamPhoenix") : $("#teamDeathEaters");
      if(!host) return;
      const row = document.createElement("div");
      row.className = "player-row";
      row.innerHTML = `
        <div>
          <span class="badge">${player?.name ?? "플레이어"}</span>
          <span class="stat">공격 ${player?.atk ?? "-"} / 방어 ${player?.def ?? "-"} / 민첩 ${player?.agi ?? "-"} / 행운 ${player?.luk ?? "-"}</span>
        </div>
        <div class="btn-row">
          <button class="btn ghost" data-action="kick" data-name="${player?.name ?? ""}">제거</button>
        </div>
      `;
      host.appendChild(row);
    };

    // Example: append log
    window.appendLog = function(type, message){
      const box = $("#battleLog");
      if(!box) return;
      const item = document.createElement("div");
      item.className = "log-item";
      const t = new Date();
      const time = String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0");
      item.innerHTML = `<span class="time">${time}</span><span class="type">${type}</span><span class="msg">${message}</span>`;
      box.appendChild(item);
      box.scrollTop = box.scrollHeight;
    };

    // Example: append chat
    window.appendChat = function(sender, message){
      const box = $("#chatMessages");
      if(!box) return;
      const item = document.createElement("div");
      item.className = "chat-item";
      const t = new Date();
      const time = String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0");
      item.innerHTML = `<span class="time">${time}</span><span class="type">${sender}</span><span class="msg">${message}</span>`;
      box.appendChild(item);
      box.scrollTop = box.scrollHeight;
    };

    // Minimal local demo bindings (design-only; keep your real logic in your existing JS)
    $("#chatSendBtn")?.addEventListener("click", ()=>{
      const v = $("#chatInput").value.trim();
      if(!v) return;
      window.appendChat("관리자", v);
      $("#chatInput").value = "";
    });
  </script>
</body>
</html>
