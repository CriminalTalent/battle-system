<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>PYXIS 관리자</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- 공용/관리자 스타일 -->
  <link rel="stylesheet" href="/assets/css/core.css" />
  <link rel="stylesheet" href="/assets/css/pyxis-unified.css" />
  <link rel="stylesheet" href="/assets/css/components.css" />
  <link rel="stylesheet" href="/assets/css/effects.css" />
  <link rel="stylesheet" href="/assets/css/admin.css" />

  <!-- 드롭다운 가독성 강화 -->
  <style>
    .admin-page select.select{
      background-color: rgba(0,8,13,.95) !important;
      color: var(--ink, #f2ead7) !important;
      border-color: var(--border-gold, rgba(220,199,162,.2)) !important;
    }
    .admin-page select.select option{
      background-color: #001E35 !important;
      color: #f2ead7 !important;
    }
    @supports (color-scheme: dark){
      .admin-page select{ color-scheme: dark; }
    }
  </style>
</head>
<body class="admin-page">
  <header class="pyxis-header" role="banner" aria-label="PYXIS 관리자 헤더">
    <div class="header-inner">
      <h1 class="pyxis-logo"><span class="star">✦</span> PYXIS <span class="star">✦</span></h1>
      <span id="statusPill" class="status-pill waiting" aria-live="polite">전투 대기 중</span>
    </div>
    <div class="header-bg" aria-hidden="true"></div>
  </header>

  <main id="mainView" class="container admin-container" role="main">
    <div class="grid admin-grid">
      <!-- 전투 제어 섹션 -->
      <section class="card" aria-labelledby="sec-control">
        <h2 id="sec-control" class="title">전투 제어</h2>

        <!-- 전투 생성 -->
        <div class="section">
          <div class="section-title">전투 생성</div>
          <div class="grid grid-3 compact">
            <label class="form-field">
              <span class="label">전투 모드</span>
              <select id="battleMode" class="select" aria-label="전투 모드">
                <option value="1v1">1v1</option>
                <option value="2v2">2v2</option>
                <option value="3v3">3v3</option>
                <option value="4v4">4v4</option>
              </select>
            </label>
            <button id="btnCreateBattle" class="btn-primary compact" type="button">전투 생성</button>
            <span id="battleId" class="battle-id" aria-live="polite">-</span>
          </div>
        </div>

        <!-- 전투 제어 버튼 -->
        <div class="section">
          <div class="section-title">제어</div>
          <div class="grid grid-4 compact">
            <button id="btnStart" class="btn-success compact" type="button">시작</button>
            <button id="btnPause" class="btn-warning compact" type="button">일시정지</button>
            <button id="btnResume" class="btn-info compact" type="button">재개</button>
            <button id="btnEnd" class="btn-danger compact" type="button">종료</button>
          </div>
        </div>

        <!-- 링크 생성 -->
        <div class="section">
          <div class="section-title">링크 생성</div>
          <div class="grid grid-2 compact">
            <button id="btnGenPlayerOtp" class="btn-secondary compact" type="button">플레이어별 링크 생성</button>
            <button id="btnGenSpectatorOtp" class="btn-secondary compact" type="button">관전자 링크 생성</button>
          </div>
          <div class="link-display">
            <div class="link-item">
              <span class="link-label">관리자 URL:</span>
              <span id="adminUrl" class="link-value">-</span>
            </div>
            <div class="link-item">
              <span class="link-label">플레이어 OTP:</span>
              <span id="playerOtp" class="otp-value">-</span>
            </div>
            <div class="link-item">
              <span class="link-label">관전자 OTP:</span>
              <span id="spectatorOtp" class="otp-value">-</span>
            </div>
          </div>
        </div>
      </section>

      <!-- 참여자 관리 섹션 -->
      <section class="card" aria-labelledby="sec-participants">
        <h2 id="sec-participants" class="title">참여자 관리</h2>

        <!-- 플레이어 추가 -->
        <div class="section">
          <div class="section-title">플레이어 추가</div>
          <div class="grid grid-2 compact">
            <label class="form-field">
              <span class="label">이름</span>
              <input id="pName" type="text" class="input" placeholder="플레이어 이름" maxlength="20" />
            </label>
            <label class="form-field">
              <span class="label">팀</span>
              <select id="pTeam" class="select" aria-label="팀 선택">
                <option value="phoenix">불사조 기사단</option>
                <option value="eaters">죽음을 먹는 자들</option>
              </select>
            </label>
          </div>

          <!-- 아바타 업로드 -->
          <div class="section-subsection">
            <div class="section-subtitle">아바타 이미지</div>
            <label class="form-field">
              <input id="pAvatar" type="file" class="input-file" accept="image/*" />
              <div id="pAvatarPreview" class="avatar-preview" style="display:none;">
                <img id="pAvatarImg" alt="아바타 미리보기" />
              </div>
              <div id="pAvatarMeta" class="file-meta"></div>
            </label>
          </div>

          <!-- 스탯 설정 -->
          <div class="section-subsection">
            <div class="section-subtitle">스탯 배분 (총 12포인트)</div>
            <div class="grid grid-4 compact">
              <label class="form-field">
                <span class="label">공격</span>
                <input id="sATK" type="number" class="input" min="1" max="10" value="3" />
              </label>
              <label class="form-field">
                <span class="label">방어</span>
                <input id="sDEF" type="number" class="input" min="1" max="10" value="3" />
              </label>
              <label class="form-field">
                <span class="label">민첩</span>
                <input id="sDEX" type="number" class="input" min="1" max="10" value="3" />
              </label>
              <label class="form-field">
                <span class="label">행운</span>
                <input id="sLUK" type="number" class="input" min="1" max="10" value="3" />
              </label>
            </div>
            <label class="form-field">
              <span class="label">체력</span>
              <input id="pHP" type="number" class="input" min="10" max="200" value="100" />
            </label>
          </div>

          <!-- 시작 아이템 -->
          <div class="section-subsection">
            <div class="section-subtitle">시작 아이템</div>
            <div class="grid grid-3 compact">
              <label class="form-field checkbox">
                <input id="itemDeterni" type="checkbox" checked />
                <span class="checkmark"></span>
                <span class="label">디터니 (회복)</span>
              </label>
              <label class="form-field checkbox">
                <input id="itemAtkBoost" type="checkbox" />
                <span class="checkmark"></span>
                <span class="label">공격 보정기</span>
              </label>
              <label class="form-field checkbox">
                <input id="itemDefBoost" type="checkbox" />
                <span class="checkmark"></span>
                <span class="label">방어 보정기</span>
              </label>
            </div>
          </div>

          <button id="btnAddPlayer" class="btn-primary" type="button">플레이어 추가</button>
          <div id="addPlayerMsg" class="message" style="display:none;"></div>
        </div>

        <!-- 팀 로스터 -->
        <div class="section">
          <div class="section-title">팀 로스터</div>
          <div class="grid grid-2">
            <div class="team-roster">
              <h3 class="team-title phoenix">불사조 기사단</h3>
              <div id="rosterPhoenix" class="roster-list"></div>
            </div>
            <div class="team-roster">
              <h3 class="team-title eaters">죽음을 먹는 자들</h3>
              <div id="rosterDE" class="roster-list"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- 로그 & 채팅 섹션 -->
      <section class="card chat-section" aria-labelledby="sec-logs">
        <h2 id="sec-logs" class="title">로그 & 채팅</h2>

        <!-- 전투 로그 -->
        <div class="section">
          <div class="section-title">실시간 로그</div>
          <div id="battleLog" class="log-container" role="log" aria-live="polite"></div>
        </div>

        <!-- 채팅 -->
        <div class="section">
          <div class="section-title">관리자 채팅</div>
          <div id="chatView" class="chat-container" role="log" aria-live="polite"></div>
          <div class="chat-input">
            <input id="chatText" type="text" class="input" placeholder="메시지를 입력하세요..." maxlength="200" />
            <button id="btnChatSend" class="btn-primary compact" type="button">전송</button>
          </div>
        </div>

        <!-- 현재 관전자 수 -->
        <div class="section">
          <div class="section-title">실시간 현황</div>
          <div class="stats-grid">
            <div class="stat-item">
              <span class="stat-label">관전자</span>
              <span id="spectatorCount" class="stat-value">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">플레이어</span>
              <span id="playerCount" class="stat-value">0</span>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- 토스트 알림 -->
  <div id="toast" class="toast" style="display:none;" role="alert" aria-live="assertive">
    <div class="toast-content">
      <span id="toastMsg" class="toast-message"></span>
      <button class="toast-close" type="button" aria-label="닫기">&times;</button>
    </div>
  </div>

  <!-- 스크립트 로드 -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="/assets/js/fx.js"></script>
  <script src="/assets/js/notify.js"></script>
  <script src="/assets/js/socket-manager.js"></script>
  <script src="/assets/js/admin.js"></script>

  <!-- 초기화 -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // 효과 시스템 초기화
      if (window.PyxisFX) {
        window.PyxisFX.init();
        window.PyxisFX.enhanceClicks();
      }
      
      // 알림 시스템 초기화
      if (window.PyxisNotify) {
        window.PyxisNotify.init();
      }

      // 관리자 페이지 초기화
      if (window.PyxisAdmin) {
        window.PyxisAdmin.init();
      }

      console.log('PYXIS 관리자 페이지 로드 완료');
    });
  </script>
</body>
</html>
