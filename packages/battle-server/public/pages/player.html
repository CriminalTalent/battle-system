<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>PYXIS Battle System - 전투 참가자</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b1117; --panel:#121a23; --panel-2:#0f1620; --fg:#e9e4d7;
      --muted:#cdbfa5; --line:rgba(220,199,162,.22);
      --gold:#c9a86a; --gold2:#e8d3a0; --gold3:#ffefc1;
      --ok:#2d5a27; --accent:#d4b77e;
      --radius:14px; --rsm:10px;
    }
    *{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--fg);font-family:'Cinzel',ui-sans-serif,system-ui}
    .container{max-width:1400px;margin:0 auto;padding:18px}
    header.top{display:flex;justify-content:center;padding:12px 0;border-bottom:1px solid var(--line);background:#0c1118cc;backdrop-filter:blur(6px);position:sticky;top:0;z-index:10}
    .brand{font-weight:800;letter-spacing:2px;background:linear-gradient(135deg,var(--gold),var(--gold2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}

    .grid{display:grid;grid-template-columns:320px 1fr 360px;gap:16px}
    @media(max-width:1200px){.grid{grid-template-columns:1fr}}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);overflow:hidden}
    .card-h{padding:12px 14px;border-bottom:1px solid var(--line);font-weight:800;color:var(--gold2)}
    .card-b{padding:14px}

    /* 왼쪽: 내 정보 */
    .avatar{width:120px;height:120px;border-radius:50%;border:3px solid var(--gold2);object-fit:cover;background:#0d131a;display:block;margin:0 auto}
    .me-name{font-weight:800;text-align:center;margin:10px 0 2px}
    .badge{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:3px 10px;color:var(--muted);font-size:12px}
    .badge-wrap{text-align:center}
    .stats{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:12px 0}
    .stat{background:var(--panel-2);border:1px solid var(--line);border-radius:10px;padding:10px;text-align:center}
    .stat .k{font-size:12px;color:var(--muted)} .stat .v{font-weight:800;margin-top:4px}

    /* HP바: 금색 그라데이션 */
    .hpbox{margin:12px 0}
    .hpbg{height:20px;border-radius:10px;border:1px solid var(--line);background:#0e1520;position:relative;overflow:hidden}
    .hpbar{height:100%;background:linear-gradient(90deg,#b89453,#e7d08f,#ffefc1);box-shadow:inset 0 2px 4px rgba(255,255,255,.12)}
    .hptext{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-weight:800;color:#1a1206}

    /* 중앙: 현재 턴 / 로그 */
    .turn-wrap{text-align:center}
    .turn-img{width:66%;max-width:720px;aspect-ratio:4/3;border-radius:22px;border:3px solid var(--gold2);
              object-fit:cover;background:#0d131a;box-shadow:0 8px 30px rgba(0,0,0,.35);display:block;margin:10px auto}
    .turn-name{font-weight:800;color:var(--gold2);margin-top:8px}
    .turn-timer{color:var(--muted);margin-top:4px}
    .log{height:320px;overflow:auto;background:var(--panel-2);border:1px solid var(--line);border-radius:10px;padding:10px;margin-top:14px}
    .log .entry{padding:4px 6px;border-left:3px solid rgba(201,168,106,.4);margin:2px 0}
    .log .chat{border-left-color:#2d5a27;color:#cce8cc}
    .mono{font-family:ui-monospace,Consolas,Menlo,monospace;font-size:12px;color:var(--muted)}

    /* 오른쪽: 액션/채팅 */
    .act-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .btn{background:linear-gradient(135deg,#c9a86a,#e8d3a0);color:#1b1408;border:none;border-radius:10px;padding:11px 12px;font-weight:800;cursor:pointer}
    .btn:hover{filter:brightness(1.04)} .btn:disabled{background:#0e1520;color:#6b6559;border:1px solid var(--line);cursor:not-allowed}
    .btn.ready{background:linear-gradient(135deg,#2d5a27,#3e7a3a);color:#fff}
    .chat-panel{margin-top:14px}
    .chat-box{height:240px;overflow:auto;background:var(--panel-2);border:1px solid var(--line);border-radius:10px;padding:10px}
    .chat-row{display:flex;gap:8px;margin-top:8px} .chat-inp{flex:1;background:#0e1520;border:1px solid var(--line);border-radius:10px;padding:10px;color:var(--fg)}

    /* 인증 오버레이 */
    .overlay{position:fixed;inset:0;background:rgba(10,15,26,.9);display:none;align-items:center;justify-content:center;z-index:1000}
    .overlay.show{display:flex}
    .spinner{width:44px;height:44px;border:4px solid #1d2530;border-top:4px solid var(--gold2);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 12px}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <header class="top"><div class="brand">PYXIS 전투 시스템</div></header>

  <!-- 인증 -->
  <section id="authView" class="container">
    <div class="card" style="max-width:540px;margin:20px auto">
      <div class="card-h">전투 참가자 인증</div>
      <div class="card-b" style="display:grid;gap:10px">
        <label class="mono">전투 ID <input id="battleId" class="chat-inp" type="text" placeholder="전투 ID" /></label>
        <label class="mono">이름 <input id="playerName" class="chat-inp" type="text" placeholder="전투 참가자 이름" /></label>
        <label class="mono">비밀번호 <input id="authToken" class="chat-inp" type="password" placeholder="player-이름-BID" /></label>
        <button id="btnAuth" class="btn">접속</button>
        <div class="mono">URL 파라미터(battle, name, token)로 자동인증</div>
      </div>
    </div>
  </section>

  <!-- 메인 -->
  <main id="mainView" class="container" style="display:none">
    <div class="grid">
      <!-- 내 정보 -->
      <section class="card">
        <div class="card-h">내 정보</div>
        <div class="card-b">
          <img id="myAvatar" class="avatar" src="/assets/images/default-avatar.png" alt="내 아바타" />
          <div id="myName" class="me-name">전투 참가자</div>
          <div class="badge-wrap"><span id="myTeam" class="badge">A팀</span></div>

          <div class="stats">
            <div class="stat"><div class="k">공격</div><div id="statATK" class="v">3</div></div>
            <div class="stat"><div class="k">방어</div><div id="statDEF" class="v">3</div></div>
            <div class="stat"><div class="k">민첩</div><div id="statAGI" class="v">3</div></div>
            <div class="stat"><div class="k">행운</div><div id="statLUK" class="v">3</div></div>
          </div>

          <div class="hpbox">
            <div class="mono" style="text-align:center">체력</div>
            <div class="hpbg"><div id="myHpBar" class="hpbar" style="width:100%"></div><div id="myHpText" class="hptext">100 / 100</div></div>
          </div>

          <div class="stats">
            <div class="stat"><div class="k">디터니</div><div id="itemDittany" class="v">1</div></div>
            <div class="stat"><div class="k">공격 보정기</div><div id="itemAttack" class="v">1</div></div>
            <div class="stat"><div class="k">방어 보정기</div><div id="itemDefense" class="v">1</div></div>
          </div>
        </div>
      </section>

      <!-- 중앙 -->
      <section class="card">
        <div class="card-h">현재 턴</div>
        <div class="card-b turn-wrap">
          <img id="turnAvatar" class="turn-img" src="/assets/images/default-avatar.png" alt="현재 턴" />
          <div id="turnName" class="turn-name">대기 중</div>
          <div id="turnTimer" class="turn-timer">턴 시간: --</div>

          <div class="log" id="battleLog"><div class="entry mono">전투 시작을 기다리는 중…</div></div>
        </div>
      </section>

      <!-- 오른쪽 -->
      <section class="card">
        <div class="card-h">액션</div>
        <div class="card-b">
          <button id="btnReady" class="btn ready" style="width:100%;margin-bottom:8px">준비하기</button>
          <div class="act-grid">
            <button id="btnAttack" class="btn" disabled>공격</button>
            <button id="btnDefend" class="btn" disabled>방어</button>
            <button id="btnDodge" class="btn" disabled>회피</button>
            <button id="btnPass" class="btn" disabled>패스</button>
            <button id="btnItemDittany" class="btn" disabled>디터니</button>
            <button id="btnItemAttack" class="btn" disabled>공격 보정기</button>
            <button id="btnItemDefense" class="btn" disabled>방어 보정기</button>
          </div>

          <div class="chat-panel">
            <div id="chatMessages" class="chat-box"><div class="mono">채팅을 시작하세요.</div></div>
            <div class="chat-row">
              <input id="chatInput" class="chat-inp" type="text" placeholder="메시지 입력…" />
              <button id="btnChat" class="btn">전송</button>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- 로딩 오버레이 (자동 로그인 표시) -->
  <div id="loadingOverlay" class="overlay"><div>
    <div class="spinner"></div>
    <div class="mono" style="text-align:center">자동 로그인 중…</div>
  </div></div>

  <script>window.PYXIS_SERVER_URL="https://pyxisbattlesystem.monster";</script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="/assets/js/player.js"></script>
</body>
</html>
