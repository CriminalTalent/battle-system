<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PYXIS Battle System - 전투 참가자</title>

  <!-- 테마 -->
  <link rel="stylesheet" href="/assets/css/pyxis-theme.css">
  <style>
    :root{
      --r: 10px;
      --pad: 12px;
      --gap: 12px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{
      background:var(--deep-navy);
      color:var(--text);
      font-family:ui-sans-serif,system-ui,AppleSDGothicNeo,Segoe UI,Roboto,Helvetica,Arial;
      font-size:13px;
      line-height:1.5;
    }
    .container{max-width:1200px;margin:0 auto;padding:0 12px}

    /* 헤더 */
    .header{position:sticky;top:0;z-index:10;background:var(--glass-2);backdrop-filter:var(--blur-light);
      border-bottom:1px solid var(--border-light);padding:10px 0}
    .title{display:flex;justify-content:center;gap:8px;font-weight:800;letter-spacing:1px}
    .title-main{color:var(--gold-bright)}
    .title-sub{color:var(--text-muted);font-size:11px}

    /* 레이아웃: 콤팩트 그리드 (좌 정보 / 중 로그 / 우 액션) */
    .grid{display:grid;grid-template-columns:280px 1fr 320px;gap:var(--gap);padding:12px}
    @media (max-width:1024px){.grid{grid-template-columns:1fr;}}
    .panel{background:var(--glass-2);backdrop-filter:var(--blur-light);border:1px solid var(--border-light);
      border-radius:var(--r);padding:var(--pad)}

    .title-sm{font-weight:800;color:var(--gold-bright);margin-bottom:8px;font-size:13px}

    /* 내 정보 */
    .me{display:flex;flex-direction:column;align-items:center;gap:8px}
    .avatar{width:88px;height:88px;border-radius:50%;object-fit:cover;border:2px solid var(--gold);background:var(--navy-surface)}
    .name{font-weight:800;color:var(--gold-bright)}
    .badge{display:inline-block;border-radius:999px;border:1px solid var(--border-light);padding:2px 8px;font-size:11px;color:var(--text-muted)}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:8px;width:100%}
    .stat{border:1px solid var(--border-subtle);border-radius:8px;background:var(--glass-1);padding:8px;text-align:center}
    .stat .k{font-size:11px;color:var(--text-muted)}
    .stat .v{font-weight:800;color:var(--gold-bright)}
    .hp{width:100%}
    .hpbar{position:relative;height:16px;border-radius:8px;border:1px solid var(--border-light);background:var(--navy-surface);overflow:hidden}
    .hpbar>i{display:block;height:100%;background:linear-gradient(90deg,var(--success),#1fa86f)}
    .hpbar>span{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-size:11px;color:#fff}
    .items{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;width:100%}
    .item{border:1px solid var(--border-subtle);border-radius:8px;background:var(--glass-1);padding:6px;text-align:center}
    .item .n{font-size:10px;color:var(--text-muted)}
    .item .c{font-weight:800;color:var(--gold-bright)}

    /* 로그/턴 */
    .turn{display:flex;align-items:center;gap:10px;margin-bottom:8px}
    .turn .img{width:48px;height:48px;border-radius:50%;object-fit:cover;border:2px solid var(--gold)}
    .turn .who{font-weight:800;color:var(--gold-bright)}
    .turn .t{font-size:12px;color:var(--text-muted)}
    .log{height:280px;overflow:auto;border:1px solid var(--border-subtle);border-radius:8px;background:var(--glass-1);padding:8px}
    .line{padding:6px;border-left:3px solid var(--border-subtle);border-radius:6px;background:rgba(255,255,255,.02);margin-bottom:6px}
    .line.system{border-left-color:var(--gold)}
    .line.chat{border-left-color:var(--success);color:#a9ffd2}

    /* 액션/채팅 */
    .stack{display:flex;flex-direction:column;gap:8px}
    .grid-actions{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .btn{border:none;border-radius:8px;padding:10px 12px;font-weight:800;cursor:pointer}
    .btn.primary{background:linear-gradient(135deg,var(--gold),var(--gold-bright));color:var(--deep-navy)}
    .btn.ghost{background:var(--glass-1);color:var(--text);border:1px solid var(--border-light)}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .chat-box{display:flex;gap:6px}
    .chat-input{flex:1;border:1px solid var(--border-light);border-radius:8px;background:var(--glass-1);padding:8px;color:var(--text)}
    .chat{height:180px;overflow:auto;border:1px solid var(--border-subtle);border-radius:8px;background:var(--glass-1);padding:8px}
    .msg{padding:6px;border-radius:6px;background:rgba(255,255,255,.02);margin-bottom:6px}
    .hint{font-size:11px;color:var(--text-muted);text-align:center}
    .hidden{display:none!important}
  </style>
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="title">
        <div class="title-main">PYXIS</div>
        <div class="title-sub">전투 시스템</div>
      </div>
    </div>
  </header>

  <!-- 인증 -->
  <section id="viewAuth" class="container" style="padding:12px">
    <div class="panel" style="max-width:520px;margin:12px auto">
      <div class="title-sm" style="text-align:center">전투 참가자 인증</div>
      <div class="stack">
        <input id="battleId" class="chat-input" placeholder="전투 ID">
        <input id="playerName" class="chat-input" placeholder="전투 참가자 이름">
        <input id="authToken" class="chat-input" placeholder="전투 참가자 비밀번호">
        <button id="btnAuth" class="btn primary">접속</button>
        <div class="hint">URL 파라미터(battle, name, token)로 자동 접속을 시도합니다.</div>
      </div>
    </div>
  </section>

  <!-- 본화면 -->
  <main id="viewMain" class="container hidden">
    <div class="grid">
      <!-- 좌: 내 정보 -->
      <section class="panel">
        <div class="title-sm">내 정보</div>
        <div class="me">
          <img id="myAvatar" class="avatar" src="/assets/images/default-avatar.png" alt="아바타">
          <div id="myName" class="name">전투 참가자</div>
          <div><span id="myTeam" class="badge">A팀</span></div>

          <div class="grid-2">
            <div class="stat"><div class="k">공격</div><div id="statATK" class="v">3</div></div>
            <div class="stat"><div class="k">방어</div><div id="statDEF" class="v">3</div></div>
            <div class="stat"><div class="k">민첩</div><div id="statAGI" class="v">3</div></div>
            <div class="stat"><div class="k">행운</div><div id="statLUK" class="v">3</div></div>
          </div>

          <div class="hp">
            <div class="k" style="text-align:center;color:var(--text-muted);margin-bottom:6px">체력</div>
            <div class="hpbar"><i id="hpFill" style="width:100%"></i><span id="hpText">100 / 100</span></div>
          </div>

          <div class="items">
            <div class="item"><div class="n">디터니</div><div id="itemDittany" class="c">1</div></div>
            <div class="item"><div class="n">공격 보정기</div><div id="itemAttack" class="c">1</div></div>
            <div class="item"><div class="n">방어 보정기</div><div id="itemDefense" class="c">1</div></div>
          </div>
        </div>
      </section>

      <!-- 중: 턴 & 로그 -->
      <section class="panel">
        <div class="title-sm">전투 현황</div>
        <div class="turn">
          <img id="turnAvatar" class="img" src="/assets/images/default-avatar.png" alt="현재 턴">
          <div style="display:flex;flex-direction:column;gap:2px">
            <div id="turnName" class="who">대기 중</div>
            <div id="turnTimer" class="t">턴 시간: --</div>
          </div>
        </div>
        <div class="log" id="battleLog"><div class="line system">전투 시작을 기다리는 중...</div></div>
      </section>

      <!-- 우: 액션 & 채팅 -->
      <section class="panel">
        <div class="title-sm">액션</div>
        <div class="stack">
          <button id="btnReady" class="btn primary">준비하기</button>
          <div class="grid-actions">
            <button id="btnAttack" class="btn ghost" disabled>공격</button>
            <button id="btnDefend" class="btn ghost" disabled>방어</button>
            <button id="btnDodge"  class="btn ghost" disabled>회피</button>
            <button id="btnPass"   class="btn ghost" disabled>패스</button>
            <button id="btnItemDittany" class="btn ghost" disabled>디터니</button>
            <button id="btnItemAttack"  class="btn ghost" disabled>공격 보정기</button>
            <button id="btnItemDefense" class="btn ghost" disabled>방어 보정기</button>
          </div>

          <div class="title-sm" style="margin-top:8px">채팅</div>
          <div id="chatList" class="chat"></div>
          <div class="chat-box">
            <input id="chatInput" class="chat-input" placeholder="메시지 입력…">
            <button id="btnChat" class="btn primary">전송</button>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Socket.IO -->
  <script src="/socket.io/socket.io.js"></script>
  <script>
    // 필요 시 절대 호스트 지정 (동일 오리진이면 비워둠)
    window.PYXIS_SERVER_URL = "";
  </script>
  <script src="/assets/js/player.js"></script>
</body>
</html>
