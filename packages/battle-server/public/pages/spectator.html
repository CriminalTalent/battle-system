<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>PYXIS Spectator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;800;900&family=Playfair+Display:wght@400;600;700;800;900&display=swap" rel="stylesheet" />

  <style>
    :root{
      /* Palette */
      --navy-1:#00080D;  /* 주 네이비 */
      --navy-2:#001E35;  /* 보조 네이비 */
      --gold-1:#DCC7A2;  /* 주 골드 */
      --gold-2:#D4BA8D;  /* 보조 골드 */

      /* Derived */
      --deep:var(--navy-1);
      --mid:#071426;
      --text:#f8f6f0;
      --text-dim:#e0d5c4;
      --text-muted:#b8a898;

      --surface-1:rgba(0,30,53,.55);
      --surface-2:rgba(8,25,42,.72);

      --border-subtle:rgba(220,199,162,.10);
      --border-1:rgba(220,199,162,.18);
      --border-2:rgba(220,199,162,.30);

      --shadow-soft:0 6px 18px rgba(0,0,0,.28);
      --shadow-deep:0 18px 46px rgba(0,0,0,.38);
      --glow:0 0 20px rgba(220,199,162,.18);

      --success:#22c55e;
      --warning:#f59e0b;
      --danger:#ef4444;
      --info:#38bdf8;

      --gold-bright:var(--gold-1);
      --gold-warm:var(--gold-2);

      --radius:14px;
      --radius-lg:20px;

      --font-display:"Cinzel", serif;
      --font-body:"Playfair Display", system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", Arial, serif;
    }

    *{ box-sizing:border-box; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    html,body{ height:100%; margin:0; }
    body{
      color:var(--text);
      font-family:var(--font-body);
      line-height:1.6;
      background:
        radial-gradient(1200px 1200px at 12% -10%, rgba(220,199,162,.16) 0%, rgba(220,199,162,0) 50%),
        radial-gradient(900px 900px at 88% 110%, rgba(220,199,162,.10) 0%, rgba(220,199,162,0) 55%),
        linear-gradient(145deg, var(--deep) 0%, var(--mid) 45%, var(--navy-2) 100%);
      background-attachment:fixed;
    }

    .spectator-container{ max-width:1400px; margin:0 auto; padding:20px; }

    /* Hero */
    .hero{ position:relative; text-align:center; padding:54px 16px 20px; overflow:hidden; }
    .hero::before{
      content:""; position:absolute; inset:-40% -20% auto -20%; height:520px;
      background:conic-gradient(from 0deg at 50% 50%,
        rgba(220,199,162,.18) 0deg, rgba(220,199,162,.06) 60deg,
        rgba(220,199,162,.22) 120deg, rgba(220,199,162,.05) 180deg,
        rgba(220,199,162,.18) 240deg, rgba(220,199,162,.06) 300deg,
        rgba(220,199,162,.22) 360deg);
      filter:blur(90px); animation:rotateBg 60s linear infinite; opacity:.8; pointer-events:none; z-index:-2;
    }
    @keyframes rotateBg{ 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }

    .twinkle-layer{ position:absolute; inset:0; pointer-events:none; z-index:-1; }
    .tw{ position:absolute; width:3px; height:3px; border-radius:50%; background:var(--gold-1); box-shadow:0 0 10px var(--gold-1); opacity:.35; animation:twinkle 3.6s infinite; }
    @keyframes twinkle{ 0%,100%{transform:scale(1);opacity:.25} 50%{transform:scale(1.6);opacity:.8} }

    .brand{
      font-family:var(--font-display); font-weight:900; letter-spacing:.08em;
      font-size:clamp(28px,5vw,44px); display:inline-block;
      background:linear-gradient(135deg, var(--gold-1), var(--gold-2) 30%, #efe6cf 60%, var(--gold-1));
      background-size:300% 300%;
      -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
      animation:shimmer 5s ease-in-out infinite; text-shadow:0 4px 18px rgba(220,199,162,.28)
    }
    @keyframes shimmer{ 0%,100%{background-position:0% 50%} 50%{background-position:100% 50%} }

    .status-wrap{ display:flex; gap:10px; align-items:center; justify-content:center; margin-top:10px; }
    .status-indicator{
      display:flex; gap:10px; align-items:center; padding:8px 14px; border-radius:999px;
      background:linear-gradient(145deg, rgba(0,30,53,.65), rgba(0,30,53,.45));
      border:1px solid var(--border-subtle); backdrop-filter:blur(8px);
      box-shadow:var(--glow); font-weight:700; color:var(--text-dim);
    }
    #connectionDot{ width:10px; height:10px; border-radius:50%; background:var(--warning); box-shadow:0 0 10px currentColor; transition:.25s; }
    #connectionDot.active{ background:var(--success); }

    .pill{ border:1px solid var(--border-1); padding:6px 10px; border-radius:999px; background:rgba(220,199,162,.06); font-weight:800; font-size:12px; letter-spacing:.04em; color:var(--text-dim) }

    /* Cards */
    .card{
      background:linear-gradient(145deg, rgba(0,30,53,.78), rgba(8,25,42,.82));
      border:1px solid var(--border-1); border-radius:var(--radius);
      padding:18px; box-shadow:var(--shadow-soft), var(--glow); backdrop-filter:blur(14px) saturate(130%);
      transition:transform .25s, box-shadow .25s, border-color .25s;
    }
    .card:hover{ transform:translateY(-3px); box-shadow:var(--shadow-deep), var(--glow); border-color:var(--border-2); }

    .section-title{
      font-family:var(--font-display); font-weight:800; letter-spacing:.02em; color:var(--gold-1);
      font-size:18px; margin:0 0 12px; padding-left:16px; position:relative;
    }
    .section-title::before{
      content:""; position:absolute; left:0; top:50%; transform:translateY(-50%);
      width:6px; height:70%; border-radius:3px;
      background:linear-gradient(180deg, var(--gold-1), var(--gold-2)); box-shadow:0 0 10px rgba(220,199,162,.45);
    }

    /* Layout */
    .row{ display:grid; grid-template-columns:1.2fr 1fr; gap:16px; align-items:start; }
    @media (max-width:980px){ .row{ grid-template-columns:1fr; } }

    .battle-meta{ display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
    .meta-box{ border:1px solid var(--border-1); border-radius:12px; padding:12px; background:var(--surface-1); }
    .meta-label{ color:var(--text-dim); font-weight:800; font-size:12px; }
    .meta-value{ font-weight:900; color:var(--gold-1); margin-top:4px; }
    .battle-timer{ font-weight:900; color:var(--gold-1); }

    .teams{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    @media (max-width:720px){ .teams{ grid-template-columns:1fr; } }

    .team-wrap .team-header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
    .team-title{ font-weight:900; color:var(--gold-1); }
    .team-count{ color:var(--text-muted); font-weight:800; }

    .spectator-player-card{
      display:flex; gap:12px; align-items:center; border:1px solid var(--border-1); border-radius:12px;
      padding:10px 12px; background:linear-gradient(145deg, rgba(0,30,53,.55), rgba(0,30,53,.42));
      transition:transform .25s;
    }
    .spectator-player-card + .spectator-player-card{ margin-top:8px; }
    .spectator-player-card .player-avatar{
      width:52px;height:52px;border-radius:12px;border:2px solid var(--border-1);
      background:linear-gradient(145deg, var(--gold-2), var(--gold-1)); overflow:hidden; display:flex;align-items:center;justify-content:center;
    }
    .player-avatar img{ width:100%; height:100%; object-fit:cover; display:block; }
    .avatar-fallback{ color:#001018; font-weight:900; }

    .player-name{ font-weight:900; color:var(--gold-1); }
    .player-stats{ display:flex; gap:8px; flex-wrap:wrap; color:var(--text-muted); font-size:12px; }

    .player-hp .hp-bar{ height:8px; border:1px solid var(--border-1); border-radius:6px; overflow:hidden; background:rgba(0,30,53,.6); }
    .player-hp .hp-fill{ height:100%; background:linear-gradient(90deg,#2D5A27,var(--gold-2),var(--gold-1)); width:100%; }
    .player-hp .hp-text{ color:var(--text-dim); font-size:12px; margin-top:4px; }
    .player-hp.critical .hp-fill{ background:linear-gradient(90deg,#c73e1d,#b8860b); }

    /* Log & Chat */
    .log-section .log-tabs{ display:flex; gap:8px; margin-bottom:8px; }
    .log-tab{
      padding:8px 12px; border:1px solid var(--border-1); border-radius:10px;
      background:linear-gradient(145deg, rgba(0,30,53,.85), rgba(10,32,56,.78));
      color:var(--text-dim); font-weight:800; cursor:pointer;
      transition:transform .2s, border-color .2s, color .2s;
    }
    .log-tab.active{ color:var(--gold-1); border-color:var(--gold-1); box-shadow:0 0 0 1px rgba(220,199,162,.18); }
    #battleLog, .chat-container{ height:340px; overflow:auto; border:1px solid var(--border-1); border-radius:12px; padding:10px; background:linear-gradient(145deg, rgba(5,15,28,.92), rgba(8,22,39,.90)); box-shadow:inset 0 3px 12px rgba(0,0,0,.5); }
    .log-entry{ display:flex; gap:10px; align-items:baseline; padding:6px 8px; border-bottom:1px solid rgba(220,199,162,.10); }
    .log-time{ color:var(--text-muted); font-weight:800; font-size:12px; }
    .log-content{ color:var(--text); }
    .chat-messages{ height:280px; overflow:auto; }
    .chat-message{ border-bottom:1px solid rgba(220,199,162,.10); padding:6px 2px; }
    .chat-header{ display:flex; justify-content:space-between; color:var(--text-dim); font-weight:800; font-size:12px; }
    .chat-text{ color:var(--text); margin-top:2px; }
    .chat-input-area{ display:flex; gap:8px; margin-top:8px; }
    .chat-send-btn{
      padding:10px 14px; border-radius:12px; border:1.5px solid var(--border-1);
      background:linear-gradient(145deg, rgba(0,30,53,.85), rgba(10,32,56,.78));
      color:var(--text); font-weight:800; cursor:pointer;
    }
    .chat-input-area input{
      flex:1; padding:10px 12px; border-radius:10px; border:1px solid var(--border-1);
      background:linear-gradient(145deg, rgba(0,30,53,.62), rgba(0,30,53,.48));
      color:var(--text);
    }
    .chat-input-area input:focus{ outline:none; border-color:var(--gold-1); box-shadow:0 0 0 3px rgba(220,199,162,.18); }

    /* Cheer */
    .cheer-section{ display:flex; gap:8px; flex-wrap:wrap; }
    .cheer-btn{
      padding:10px 14px; border-radius:12px; border:1.5px solid var(--border-1);
      background:linear-gradient(145deg, rgba(0,30,53,.85), rgba(10,32,56,.78));
      color:var(--text); font-weight:900; cursor:pointer; transition:transform .2s, box-shadow .2s, border-color .2s, color .2s;
    }
    .cheer-btn:hover{ transform:translateY(-2px); border-color:var(--gold-1); box-shadow:0 10px 26px rgba(0,0,0,.35), 0 0 18px rgba(220,199,162,.25); color:var(--gold-1); }

    /* Login area */
    #loginForm{ max-width:560px; margin:24px auto; }
    .login-card{ background:linear-gradient(145deg, rgba(0,30,53,.80), rgba(12,32,55,.82)); border:1px solid var(--border-1); border-radius:var(--radius-lg); padding:20px; box-shadow:var(--shadow-soft); }
    .field{ display:flex; flex-direction:column; gap:6px; }
    .field label{ font-weight:800; color:var(--text-dim); font-size:12px; letter-spacing:.02em; margin-left:4px; }
    .input{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border-1);
      background:linear-gradient(145deg, rgba(0,30,53,.62), rgba(0,30,53,.48)); color:var(--text);
    }
    .input:focus{ outline:none; border-color:var(--gold-1); box-shadow:0 0 0 3px rgba(220,199,162,.18); }
    .btn{
      padding:10px 14px; border-radius:12px; border:1.5px solid var(--border-1);
      background:linear-gradient(145deg, rgba(0,30,53,.85), rgba(10,32,56,.78)); color:var(--text); font-weight:900; cursor:pointer;
    }
    .btn.gold{ background:linear-gradient(145deg, var(--gold-1), var(--gold-2)); color:#0a121b; border-color:#e7d9b8; box-shadow:0 6px 18px rgba(220,199,162,.35); }

    /* Hide/Show helpers */
    .hidden{ display:none !important; }

    /* Reduce motion on mobile if needed */
    @media (hover:none){
      .btn, .cheer-btn{ padding:12px 16px; }
      .input{ padding:12px 14px; }
    }
  </style>
</head>
<body>
  <div class="spectator-container">
    <header class="hero">
      <div class="twinkle-layer" id="twinkleLayer"></div>
      <h1 class="brand">PYXIS Spectator</h1>
      <div class="status-wrap">
        <div class="status-indicator">
          <span id="connectionDot"></span>
          <span id="connectionText">연결 대기</span>
        </div>
        <span class="pill" id="battleStatePill">대기</span>
      </div>
    </header>

    <!-- Login -->
    <section id="loginForm" class="card">
      <div class="login-card">
        <h2 class="section-title">관전자 입장</h2>
        <form id="spectatorLoginForm">
          <div class="field">
            <label for="spectatorName">이름</label>
            <input id="spectatorName" class="input" maxlength="20" placeholder="관전자 이름을 입력해주세요" />
          </div>
          <div style="display:flex; gap:10px; margin-top:8px">
            <button class="btn gold" type="submit" style="flex:1">입장</button>
          </div>
          <div class="field" style="margin-top:8px; color:var(--text-muted); font-size:13px">
            URL의 battle, otp 파라미터가 있으면 자동 인증됩니다.
          </div>
        </form>
      </div>
    </section>

    <!-- Spectator Area -->
    <main id="spectatorArea" class="hidden">
      <section class="card battle-meta">
        <div class="meta-box">
          <div class="meta-label">전투 상태</div>
          <div class="meta-value" id="battlePhase">전투 대기중</div>
        </div>
        <div class="meta-box">
          <div class="meta-label">라운드/턴</div>
          <div class="meta-value" id="battleInfo">라운드 - | 턴 -</div>
        </div>
        <div class="meta-box">
          <div class="meta-label">현재 턴</div>
          <div class="meta-value" id="currentTurn">현재 턴: 대기중</div>
        </div>
      </section>

      <section class="row">
        <!-- Teams -->
        <div class="card team-wrap">
          <h2 class="section-title">팀</h2>

          <div class="teams">
            <div class="team-wrap">
              <div class="team-header">
                <div class="team-title">불사조 기사단</div>
              </div>
              <div id="phoenixMembers"></div>
            </div>

            <div class="team-wrap">
              <div class="team-header">
                <div class="team-title">죽음을 먹는 자들</div>
              </div>
              <div id="deathMembers"></div>
            </div>
          </div>

          <hr style="border:none;border-top:1px solid var(--border-1);margin:14px 0" />

          <div class="cheer-section">
            <button class="cheer-btn" data-cheer="불사조 기사단 힘내세요">불사조 기사단 힘내세요</button>
            <button class="cheer-btn" data-cheer="집중해서 한 방 노립시다">집중해서 한 방 노립시다</button>
            <button class="cheer-btn" data-cheer="끝까지 포기하지 마세요">끝까지 포기하지 마세요</button>
          </div>
        </div>

        <!-- Log / Chat -->
        <div class="card log-section">
          <h2 class="section-title">실시간</h2>
          <div class="log-tabs">
            <button class="log-tab active" data-tab="log">전투 로그</button>
            <button class="log-tab" data-tab="chat">채팅</button>
          </div>
          <div id="battleLog"></div>
          <!-- chatContainer는 JS에서 동적 생성/삽입 -->
        </div>
      </section>
    </main>
  </div>

  <!-- Toast -->
  <div id="toast" role="status" aria-live="polite" style="
    position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(20px);
    background:linear-gradient(145deg, rgba(0,30,53,.95), rgba(12,32,55,.92));
    color:var(--text);padding:12px 16px;border-radius:12px;border:1px solid var(--border-1);
    box-shadow:var(--shadow-soft);opacity:0;pointer-events:none;transition:transform .25s, opacity .25s;z-index:9999
  "></div>

  <!-- Socket.IO Client Loader -->
  <script>
    (function ensureSocketIO(){
      if (window.io){ document.dispatchEvent(new Event('socket-io-ready')); return; }
      function add(src, ok, bad){ var s=document.createElement('script'); s.src=src; s.async=true; s.onload=ok; s.onerror=bad; document.head.appendChild(s); }
      add('/socket.io/socket.io.js',
        function(){ document.dispatchEvent(new Event('socket-io-ready')); },
        function(){ add('https://cdn.socket.io/4.7.5/socket.io.min.js',
          function(){ document.dispatchEvent(new Event('socket-io-ready')); },
          function(){ console.warn('[PYXIS] Socket.IO client load failed'); }
        );}
      );
    })();
  </script>

  <!-- Minimal UI helpers required by spectator.js -->
  <script>
    (function(){
      const $  = (sel, root=document)=> root.querySelector(sel);
      const $$ = (sel, root=document)=> Array.from(root.querySelectorAll(sel));
      function show(el){ if(el) el.classList.remove('hidden'); }
      function hide(el){ if(el) el.classList.add('hidden'); }
      function text(el, v){ if(el) el.textContent = String(v==null?'':v); }
      function escapeHtml(str){ const d=document.createElement('div'); d.textContent=String(str??''); return d.innerHTML; }

      // In-page toast
      function toast(msg, timeout=1600){
        const el = document.getElementById('toast'); if(!el) return;
        el.textContent = msg; el.style.opacity='1'; el.style.transform='translateX(-50%) translateY(0)';
        clearTimeout(el._t); el._t = setTimeout(()=>{ el.style.opacity='0'; el.style.transform='translateX(-50%) translateY(20px)'; }, timeout);
      }
      const success = (m,t)=>toast(m,t);
      const error   = (m,t)=>toast(m,t);
      const info    = (m,t)=>toast(m,t);

      window.UI = { $, $$, show, hide, text, escape:escapeHtml, success, error, info };
    })();

    // Twinkle stars (visual only)
    (function buildTwinkles(){
      const host=document.getElementById('twinkleLayer'); if(!host) return;
      const n=80;
      for(let i=0;i<n;i++){
        const s=document.createElement('div'); s.className='tw';
        const size=(Math.random()*2.5+1).toFixed(2);
        s.style.width=size+'px'; s.style.height=size+'px';
        s.style.left=(Math.random()*100)+'%';
        s.style.top=(Math.random()*100)+'%';
        s.style.animationDuration=(2.2+Math.random()*3.6).toFixed(2)+'s';
        s.style.opacity=(0.25+Math.random()*0.55).toFixed(2);
        host.appendChild(s);
      }
    })();
  </script>

  <!-- Project sockets / effects bootstrap (if your project exposes these paths, keep; otherwise your bundler should map them) -->
  <!-- <script src="/assets/js/core/pyxis-socket.js"></script>
  <script src="/assets/js/fx/pyxisfx.js"></script> -->

  <!-- Spectator page controller -->
  <script src="/assets/js/pages/spectator.js"></script>
</body>
</html>
