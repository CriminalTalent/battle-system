<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>PYXIS | ê´€ì „ì</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/svg+xml" href="/assets/images/favicon.svg">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/pyxis-theme.css">
  <link rel="stylesheet" href="/assets/css/core.css">
  <link rel="stylesheet" href="/assets/css/components.css">
  <script src="/socket.io/socket.io.js"></script>
  <style>
    /* ê´€ì „ì í˜ì´ì§€ ì „ìš© ê³ ê¸‰ ìŠ¤íƒ€ì¼ */
    body {
      background: linear-gradient(135deg, 
        var(--deep-navy) 0%, 
        var(--midnight) 20%, 
        var(--navy-mist) 40%, 
        var(--navy-light) 60%,
        var(--midnight) 80%, 
        var(--deep-navy) 100%);
      background-attachment: fixed;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* ìš°ì£¼ ê´€ì¸¡ì†Œ ë°°ê²½ íš¨ê³¼ */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: 
        radial-gradient(circle at 25% 25%, rgba(212,183,126,0.04) 0%, transparent 50%),
        radial-gradient(circle at 75% 25%, rgba(212,183,126,0.03) 0%, transparent 40%),
        radial-gradient(circle at 50% 75%, rgba(212,183,126,0.05) 0%, transparent 45%),
        radial-gradient(circle at 10% 60%, rgba(212,183,126,0.02) 0%, transparent 35%),
        radial-gradient(circle at 90% 40%, rgba(212,183,126,0.03) 0%, transparent 30%);
      animation: observatoryDrift 30s ease-in-out infinite;
      pointer-events: none;
      z-index: -1;
    }

    @keyframes observatoryDrift {
      0%, 100% { opacity: 0.4; transform: rotate(0deg) scale(1); }
      33% { opacity: 0.7; transform: rotate(1deg) scale(1.01); }
      66% { opacity: 0.5; transform: rotate(-0.5deg) scale(0.99); }
    }

    /* ì—°ê²° ìƒíƒœ */
    .connection-status {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      background: rgba(8,13,25,0.95);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(212,183,126,0.25);
      border-radius: var(--radius-large);
      padding: 12px 20px;
      font-weight: 600;
      z-index: 1000;
      box-shadow: var(--shadow-deep);
    }

    .connection-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--warning);
      animation: connectionPulse 2s ease-in-out infinite;
      box-shadow: 0 0 12px currentColor;
    }

    .connection-dot.connected {
      background: var(--success);
      color: var(--success);
    }

    @keyframes connectionPulse {
      0%, 100% { opacity: 0.6; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.2); }
    }

    /* ê´€ì „ì í—¤ë” */
    .spectator-header {
      text-align: center;
      padding: 100px 20px 80px;
      position: relative;
      overflow: hidden;
      background: linear-gradient(135deg, 
        rgba(212,183,126,0.12) 0%, 
        rgba(10,15,26,0.95) 20%, 
        rgba(10,15,26,0.95) 80%, 
        rgba(212,183,126,0.12) 100%);
      border-bottom: 2px solid rgba(212,183,126,0.25);
    }

    .spectator-header::before {
      content: '';
      position: absolute;
      top: -150%;
      left: -75%;
      right: -75%;
      height: 400%;
      background: conic-gradient(from 30deg, 
        rgba(212,183,126,0.1) 0deg, 
        transparent 60deg,
        rgba(212,183,126,0.06) 120deg, 
        transparent 180deg,
        rgba(212,183,126,0.08) 240deg,
        transparent 300deg,
        rgba(212,183,126,0.1) 360deg);
      animation: spectatorOrbit 50s linear infinite;
      pointer-events: none;
      z-index: -1;
    }

    @keyframes spectatorOrbit {
      0% { transform: rotate(0deg) scale(1); }
      100% { transform: rotate(-360deg) scale(1); }
    }

    .spectator-brand {
      font-family: var(--serif);
      font-weight: 900;
      font-size: clamp(2.2rem, 5.5vw, 4rem);
      background: linear-gradient(135deg, 
        var(--gold-bright) 0%, 
        var(--gold-shimmer) 20%, 
        var(--gold) 40%, 
        var(--gold-light) 60%,
        var(--gold-shimmer) 80%,
        var(--gold-bright) 100%);
      background-size: 300% 300%;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: spectatorShimmer 5s ease-in-out infinite;
      letter-spacing: 0.06em;
      position: relative;
      text-shadow: 0 0 40px rgba(212,183,126,0.3);
    }

    @keyframes spectatorShimmer {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .spectator-brand::after {
      content: 'ğŸ‘ï¸ ê´€ì¸¡ì†Œ ğŸ”­';
      position: absolute;
      bottom: -40px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1rem;
      font-weight: 700;
      color: var(--gold);
      background: linear-gradient(135deg, 
        rgba(212,183,126,0.18), 
        rgba(212,183,126,0.1));
      border: 1px solid rgba(212,183,126,0.4);
      border-radius: 30px;
      padding: 10px 24px;
      letter-spacing: 0.04em;
      white-space: nowrap;
      animation: observatoryGlow 4s ease-in-out infinite;
    }

    @keyframes observatoryGlow {
      0%, 100% { 
        opacity: 0.9; 
        transform: translateX(-50%) scale(1);
        box-shadow: 0 0 20px rgba(212,183,126,0.2);
      }
      50% { 
        opacity: 1; 
        transform: translateX(-50%) scale(1.05);
        box-shadow: 0 0 30px rgba(212,183,126,0.4);
      }
    }

    /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 50px 24px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      align-items: start;
    }

    /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .card {
      background: linear-gradient(145deg, 
        rgba(15,20,25,0.92) 0%, 
        rgba(25,31,42,0.85) 50%, 
        rgba(15,20,25,0.92) 100%);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(212,183,126,0.2);
      border-radius: var(--radius-xl);
      padding: 32px;
      margin-bottom: 32px;
      position: relative;
      overflow: hidden;
      transition: all var(--transition-normal);
      box-shadow: var(--shadow-medium), var(--shadow-inset);
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 20%;
      right: 20%;
      height: 2px;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(212,183,126,0.6), 
        transparent);
      border-radius: 1px;
    }

    .card:hover {
      transform: translateY(-6px);
      border-color: rgba(212,183,126,0.4);
      box-shadow: var(--shadow-deep), 
                  var(--shadow-inset), 
                  0 0 50px rgba(212,183,126,0.15);
    }

    /* ì¸ì¦ ì„¹ì…˜ */
    #authSection {
      grid-column: 1 / -1;
      max-width: 700px;
      justify-self: center;
    }

    /* ì„¹ì…˜ ì œëª© */
    .section-title {
      font-family: var(--serif);
      font-size: 1.4rem;
      font-weight: 800;
      color: var(--gold-bright);
      margin-bottom: 24px;
      position: relative;
      padding-left: 24px;
      letter-spacing: 0.03em;
    }

    .section-title::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 8px;
      height: 70%;
      background: linear-gradient(to bottom, 
        var(--gold-bright), 
        var(--gold-dark));
      border-radius: 4px;
      box-shadow: 0 0 15px rgba(212,183,126,0.5);
    }

    /* í¼ ìŠ¤íƒ€ì¼ */
    .field {
      margin-bottom: 28px;
    }

    .field label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: var(--text-dim);
      font-size: 15px;
      letter-spacing: 0.02em;
    }

    .input {
      width: 100%;
      padding: 18px 24px;
      background: rgba(8,13,25,0.85);
      border: 2px solid rgba(212,183,126,0.18);
      border-radius: var(--radius);
      color: var(--text);
      font-size: 16px;
      font-weight: 500;
      transition: all var(--transition-normal);
      backdrop-filter: blur(12px);
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.2);
    }

    .input::placeholder {
      color: var(--text-muted);
      opacity: 0.7;
    }

    .input:focus {
      outline: none;
      border-color: var(--gold);
      background: rgba(8,13,25,0.98);
      box-shadow: 0 0 0 4px rgba(212,183,126,0.18),
                  0 0 25px rgba(212,183,126,0.12),
                  inset 0 2px 8px rgba(0,0,0,0.2);
    }

    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .btn {
      padding: 20px 32px;
      background: linear-gradient(145deg, 
        var(--gold-bright), 
        var(--gold-dark));
      border: 2px solid var(--gold);
      border-radius: var(--radius);
      color: var(--deep-navy);
      font-family: var(--sans);
      font-size: 16px;
      font-weight: 700;
      text-align: center;
      cursor: pointer;
      transition: all var(--transition-normal);
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow-soft);
      letter-spacing: 0.02em;
    }

    .btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, 
        rgba(255,255,255,0.2), 
        transparent 50%, 
        rgba(255,255,255,0.1));
      opacity: 0;
      transition: opacity var(--transition-normal);
    }

    .btn:hover:not(:disabled) {
      transform: translateY(-4px) scale(1.02);
      box-shadow: var(--shadow-medium), 
                  0 0 30px rgba(212,183,126,0.4);
      background: linear-gradient(145deg, 
        var(--gold-shimmer), 
        var(--gold));
    }

    .btn:hover:not(:disabled)::before {
      opacity: 1;
    }

    .btn:active {
      transform: translateY(-2px) scale(1.01);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* ì „íˆ¬ì¥ ë·° */
    .battlefield {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
      margin-bottom: 32px;
    }

    .team-panel {
      background: linear-gradient(135deg, 
        rgba(15,20,25,0.85), 
        rgba(25,31,42,0.8));
      border: 1px solid rgba(212,183,126,0.15);
      border-radius: var(--radius-large);
      padding: 24px;
      backdrop-filter: blur(12px);
    }

    .team-header {
      text-align: center;
      font-family: var(--serif);
      font-weight: 800;
      font-size: 20px;
      color: var(--gold-bright);
      padding: 16px;
      background: linear-gradient(135deg, 
        rgba(212,183,126,0.15), 
        rgba(212,183,126,0.08));
      border: 1px solid rgba(212,183,126,0.25);
      border-radius: var(--radius);
      margin-bottom: 20px;
      position: relative;
      text-shadow: 0 2px 10px rgba(212,183,126,0.4);
      letter-spacing: 0.02em;
    }

    .team-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 25%;
      right: 25%;
      height: 2px;
      background: linear-gradient(90deg, 
        transparent, 
        var(--gold-bright), 
        transparent);
      border-radius: 1px;
    }

    .team-header.phoenix {
      background: linear-gradient(135deg, 
        rgba(231,76,60,0.15), 
        rgba(231,76,60,0.08));
      border-color: rgba(231,76,60,0.4);
      color: #FF6B6B;
    }

    .team-header.death-eater {
      background: linear-gradient(135deg, 
        rgba(46,125,50,0.15), 
        rgba(46,125,50,0.08));
      border-color: rgba(46,125,50,0.4);
      color: #66BB6A;
    }

    .unit-card {
      background: linear-gradient(135deg, 
        rgba(8,13,25,0.9), 
        rgba(15,20,25,0.8));
      border: 1px solid rgba(212,183,126,0.15);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 16px;
      transition: all var(--transition-normal);
      position: relative;
    }

    .unit-card:hover {
      transform: translateY(-3px);
      border-color: rgba(212,183,126,0.35);
      box-shadow: var(--shadow-soft), 
                  0 0 20px rgba(212,183,126,0.1);
    }

    .unit-card.current-turn {
      border-color: var(--gold-bright);
      background: linear-gradient(135deg, 
        rgba(212,183,126,0.12), 
        rgba(8,13,25,0.95));
      box-shadow: 0 0 25px rgba(212,183,126,0.2);
      animation: currentTurnGlow 2s ease-in-out infinite;
    }

    @keyframes currentTurnGlow {
      0%, 100% { box-shadow: 0 0 25px rgba(212,183,126,0.2); }
      50% { box-shadow: 0 0 35px rgba(212,183,126,0.4); }
    }

    .unit-card.defeated {
      opacity: 0.4;
      filter: grayscale(0.8);
      transform: none;
    }

    .unit-name {
      font-size: 18px;
      font-weight: 700;
      color: var(--gold-bright);
      margin-bottom: 12px;
      text-align: center;
    }

    .unit-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      font-size: 13px;
      color: var(--text-dim);
      margin-bottom: 12px;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      padding: 4px 8px;
      background: rgba(0,0,0,0.2);
      border-radius: 4px;
    }

    .stat-label {
      font-weight: 600;
    }

    .stat-value {
      color: var(--gold);
      font-weight: 700;
    }

    /* HP ë°” ê°œì„  */
    .hp-bar {
      width: 100%;
      height: 12px;
      background: linear-gradient(135deg, 
        rgba(0,0,0,0.4), 
        rgba(0,0,0,0.2));
      border-radius: 6px;
      overflow: hidden;
      border: 1px solid rgba(212,183,126,0.2);
      position: relative;
      margin-top: 8px;
    }

    .hp-fill {
      height: 100%;
      background: linear-gradient(90deg, 
        var(--success) 0%, 
        var(--warning) 50%, 
        var(--danger) 100%);
      transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      border-radius: 5px;
    }

    .hp-fill::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(255,255,255,0.4) 50%, 
        transparent 100%);
      animation: hpShimmer 3s ease-in-out infinite;
    }

    @keyframes hpShimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .hp-text {
      text-align: center;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* ì‘ì› ë²„íŠ¼ë“¤ */
    .cheer-section {
      margin-top: 24px;
    }

    .cheer-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 12px;
    }

    .cheer-btn {
      padding: 12px 16px;
      background: linear-gradient(135deg, 
        rgba(52,152,219,0.8), 
        rgba(41,128,185,0.8));
      border: 1px solid var(--info);
      border-radius: var(--radius-small);
      color: white;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-fast);
      text-align: center;
    }

    .cheer-btn:hover {
      transform: translateY(-2px);
      background: linear-gradient(135deg, 
        var(--info), 
        rgba(41,128,185,0.9));
      box-shadow: 0 4px 12px rgba(52,152,219,0.3);
    }

    .cheer-btn:active {
      transform: translateY(0);
    }

    /* ë¡œê·¸ ë° ì±„íŒ… */
    .battle-log, .chat-messages {
      height: 400px;
      background: linear-gradient(145deg, 
        rgba(5,15,28,0.98), 
        rgba(8,20,35,0.95));
      border: 1px solid rgba(212,183,126,0.25);
      border-radius: var(--radius-large);
      padding: 24px;
      overflow-y: auto;
      backdrop-filter: blur(16px);
      box-shadow: inset 0 4px 20px rgba(0,0,0,0.5),
                  inset 0 1px 0 rgba(255,255,255,0.05);
      font-size: 14px;
      line-height: 1.6;
    }

    .log-entry, .chat-message {
      display: flex;
      gap: 12px;
      align-items: baseline;
      margin-bottom: 12px;
      padding: 10px 14px;
      border-radius: var(--radius-small);
      transition: background var(--transition-fast);
      border-left: 3px solid transparent;
    }

    .log-entry:hover, .chat-message:hover {
      background: rgba(212,183,126,0.05);
    }

    .log-entry.system {
      border-left-color: var(--gold);
    }

    .log-entry.action {
      border-left-color: var(--info);
    }

    .log-entry.damage {
      border-left-color: var(--danger);
    }

    .log-time, .chat-time {
      font-size: 11px;
      color: var(--text-muted);
      min-width: 65px;
      font-weight: 600;
      opacity: 0.8;
    }

    .log-content, .chat-content {
      flex: 1;
      color: var(--text-dim);
      word-wrap: break-word;
    }

    .log-entry.system .log-content {
      color: var(--gold-bright);
      font-weight: 600;
    }

    .log-entry.action .log-content {
      color: var(--text);
      font-weight: 600;
    }

    .chat-message.cheer .chat-content {
      color: var(--success);
      font-weight: 600;
      font-style: italic;
    }

    /* ì±„íŒ… ì…ë ¥ */
    .chat-input-container {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 20px;
      padding: 16px;
      background: rgba(8,13,25,0.8);
      border: 1px solid rgba(212,183,126,0.15);
      border-radius: var(--radius);
      backdrop-filter: blur(12px);
    }

    .chat-input-container .input {
      flex: 1;
      margin-bottom: 0;
      padding: 12px 16px;
    }

    /* ë°˜ì‘í˜• ë””ìì¸ */
    @media (max-width: 1200px) {
      .container {
        grid-template-columns: 1fr;
        gap: 32px;
        padding: 40px 20px;
      }

      .battlefield {
        grid-template-columns: 1fr;
        gap: 24px;
      }
    }

    @media (max-width: 768px) {
      .spectator-header {
        padding: 80px 16px 60px;
      }

      .spectator-brand {
        font-size: 2.5rem;
      }

      .spectator-brand::after {
        bottom: -35px;
        font-size: 0.9rem;
        padding: 8px 20px;
      }

      .container {
        padding: 32px 16px;
        gap: 24px;
      }

      .card {
        padding: 24px;
        margin-bottom: 24px;
      }

      .cheer-buttons {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }

      .unit-stats {
        grid-template-columns: 1fr;
        gap: 6px;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 24px 12px;
      }

      .card {
        padding: 20px;
        margin-bottom: 20px;
      }

      .cheer-buttons {
        grid-template-columns: 1fr;
      }

      .connection-status {
        position: static;
        margin: 16px;
        justify-self: center;
      }

      .chat-input-container {
        flex-direction: column;
        gap: 12px;
      }

      .chat-input-container .input {
        width: 100%;
      }
    }

    /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í„°ë§ˆì´ì§• */
    .battle-log::-webkit-scrollbar,
    .chat-messages::-webkit-scrollbar {
      width: 10px;
    }

    .battle-log::-webkit-scrollbar-track,
    .chat-messages::-webkit-scrollbar-track {
      background: rgba(5,15,28,0.9);
      border-radius: 5px;
    }

    .battle-log::-webkit-scrollbar-thumb,
    .chat-messages::-webkit-scrollbar-thumb {
      background: linear-gradient(to bottom, 
        var(--gold-bright), 
        var(--gold-dark));
      border-radius: 5px;
      border: 1px solid rgba(0,0,0,0.3);
    }

    .battle-log::-webkit-scrollbar-thumb:hover,
    .chat-messages::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(to bottom, 
        var(--gold-shimmer), 
        var(--gold));
    }
  </style>
</head>
<body>
  <!-- ì—°ê²° ìƒíƒœ -->
  <div class="connection-status" id="connectionStatus">
    <div class="connection-dot" id="connectionDot"></div>
    <span id="connectionText">ì—°ê²° ì¤‘...</span>
  </div>

  <!-- í—¤ë” -->
  <header class="spectator-header">
    <div class="spectator-brand">PYXIS</div>
  </header>

  <main class="container">
    <!-- ì¸ì¦ ì„¹ì…˜ -->
    <section id="authSection" class="card">
      <div class="section-header">
        <h2 class="section-title">ê´€ì „ì ì…ì¥</h2>
      </div>
      <form id="authForm">
        <div class="field">
          <label for="authBattleId">ì „íˆ¬ ID</label>
          <input type="text" id="authBattleId" name="authBattleId" class="input" placeholder="ì „íˆ¬ ID ì…ë ¥" required />
        </div>
        <div class="field">
          <label for="authToken">ê´€ì „ì OTP</label>
          <input type="text" id="authToken" name="authToken" class="input" placeholder="ë°œê¸‰ëœ OTP ì…ë ¥" required />
        </div>
        <div class="field">
          <label for="spectatorName">ê´€ì „ì ì´ë¦„</label>
          <input type="text" id="spectatorName" name="spectatorName" class="input" placeholder="ì›í•˜ëŠ” ì´ë¦„ ì…ë ¥" required maxlength="15" />
        </div>
        <button type="submit" class="btn">ê´€ì „ ì‹œì‘</button>
      </form>
    </section>

    <!-- ì „íˆ¬ì¥ ë·° -->
    <section id="battlefieldSection" style="display:none;">
      <div class="card">
        <div class="section-title">ì‹¤ì‹œê°„ ì „íˆ¬ì¥</div>
        <div class="battlefield">
          <!-- íŒ€ A -->
          <div class="team-panel">
            <div class="team-header phoenix" id="teamAHeader">ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨</div>
            <div id="teamAUnits"></div>
          </div>

          <!-- íŒ€ B -->
          <div class="team-panel">
            <div class="team-header death-eater" id="teamBHeader">ì£½ìŒì„ ë¨¹ëŠ” ìë“¤</div>
            <div id="teamBUnits"></div>
          </div>
        </div>

        <!-- ì‘ì› ì„¹ì…˜ -->
        <div class="cheer-section">
          <div class="section-title" style="font-size: 1.1rem; margin-bottom: 16px;">ì‘ì›í•˜ê¸°</div>
          <div class="cheer-buttons">
            <button class="cheer-btn" data-cheer="íŒŒì´íŒ…!">íŒŒì´íŒ…!</button>
            <button class="cheer-btn" data-cheer="ë©‹ì ¸ìš”!">ë©‹ì ¸ìš”!</button>
            <button class="cheer-btn" data-cheer="ëŒ€ë‹¨í•´!">ëŒ€ë‹¨í•´!</button>
            <button class="cheer-btn" data-cheer="í™”ì´íŒ…!">í™”ì´íŒ…!</button>
            <button class="cheer-btn" data-cheer="êµ¿êµ¿!">êµ¿êµ¿!</button>
            <button class="cheer-btn" data-cheer="ìµœê³ ë‹¤!">ìµœê³ ë‹¤!</button>
            <button class="cheer-btn" data-cheer="ì˜í•œë‹¤!">ì˜í•œë‹¤!</button>
            <button class="cheer-btn" data-cheer="ëë‚´ì¤€ë‹¤!">ëë‚´ì¤€ë‹¤!</button>
          </div>
        </div>
      </div>
    </section>

    <!-- ì „íˆ¬ ë¡œê·¸ -->
    <section id="logSection" class="card" style="display:none;">
      <div class="section-title">ì „íˆ¬ ê¸°ë¡</div>
      <div id="battleLog" class="battle-log"></div>
    </section>

    <!-- ì±„íŒ… -->
    <section id="chatSection" class="card" style="display:none;">
      <div class="section-title">ê´€ì „ì ì±„íŒ…</div>
      <div id="chatMessages" class="chat-messages"></div>
      <div class="chat-input-container">
        <input type="text" id="chatInput" class="input" placeholder="ì‘ì› ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." />
        <button id="chatSendBtn" class="btn" style="min-width: 80px; padding: 12px 20px;">ì „ì†¡</button>
      </div>
    </section>
  </main>

  <!-- JS -->
  <script src="/assets/js/core/socket-manager.js"></script>
  <script src="/assets/js/core/ui-helpers.js"></script>
  <script>
    // ê´€ì „ì í˜ì´ì§€ ë¡œì§
    class PyxisSpectator {
      constructor() {
        this.currentBattleId = null;
        this.spectatorName = null;
        this.joined = false;
        this.socket = null;

        this.init();
      }

      init() {
        this.setupElements();
        this.setupEventListeners();
        this.initSocket();
        this.checkUrlParams();
      }

      setupElements() {
        // ì—°ê²° ìƒíƒœ
        this.connectionDot = document.getElementById('connectionDot');
        this.connectionText = document.getElementById('connectionText');

        // ì¸ì¦ í¼
        this.authSection = document.getElementById('authSection');
        this.authForm = document.getElementById('authForm');
        this.authBattleId = document.getElementById('authBattleId');
        this.authToken = document.getElementById('authToken');
        this.spectatorNameInput = document.getElementById('spectatorName');

        // ì „íˆ¬ì¥
        this.battlefieldSection = document.getElementById('battlefieldSection');
        this.teamAHeader = document.getElementById('teamAHeader');
        this.teamBHeader = document.getElementById('teamBHeader');
        this.teamAUnits = document.getElementById('teamAUnits');
        this.teamBUnits = document.getElementById('teamBUnits');

        // ë¡œê·¸ & ì±„íŒ…
        this.logSection = document.getElementById('logSection');
        this.battleLog = document.getElementById('battleLog');
        this.chatSection = document.getElementById('chatSection');
        this.chatMessages = document.getElementById('chatMessages');
        this.chatInput = document.getElementById('chatInput');
        this.chatSendBtn = document.getElementById('chatSendBtn');
      }

      setupEventListeners() {
        // ì¸ì¦ í¼
        this.authForm.addEventListener('submit', (e) => {
          e.preventDefault();
          this.authenticate();
        });

        // ì‘ì› ë²„íŠ¼ë“¤
        document.addEventListener('click', (e) => {
          if (e.target.classList.contains('cheer-btn')) {
            const message = e.target.dataset.cheer;
            this.sendCheer(message);
          }
        });

        // ì±„íŒ…
        this.chatSendBtn.addEventListener('click', () => this.sendChat());
        this.chatInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') this.sendChat();
        });

        // ì‘ì› ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', (e) => {
          if (!this.joined || this.chatInput === document.activeElement) return;
          
          const cheerMap = {
            '1': 'íŒŒì´íŒ…!',
            '2': 'ë©‹ì ¸ìš”!',
            '3': 'ëŒ€ë‹¨í•´!',
            '4': 'í™”ì´íŒ…!',
            '5': 'êµ¿êµ¿!',
            '6': 'ìµœê³ ë‹¤!',
            '7': 'ì˜í•œë‹¤!',
            '8': 'ëë‚´ì¤€ë‹¤!'
          };

          if (cheerMap[e.key]) {
            this.sendCheer(cheerMap[e.key]);
          }
        });
      }

      initSocket() {
        this.socket = io({
          path: '/socket.io/',
          transports: ['websocket', 'polling']
        });

        this.socket.on('connect', () => {
          console.log('[Spectator] Socket connected');
          this.updateConnectionStatus('connected');
        });

        this.socket.on('disconnect', () => {
          console.log('[Spectator] Socket disconnected');
          this.updateConnectionStatus('disconnected');
        });

        this.socket.on('spectator:authSuccess', (data) => {
          console.log('[Spectator] Auth success:', data);
          this.handleAuthSuccess(data);
        });

        this.socket.on('spectator:authError', (error) => {
          console.error('[Spectator] Auth error:', error);
          this.showError(error.message || 'ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        });

        this.socket.on('battle:stateSync', (data) => {
          console.log('[Spectator] Battle state sync:', data);
          this.updateBattleState(data);
        });

        this.socket.on('battle:actionResult', (data) => {
          console.log('[Spectator] Action result:', data);
          this.handleActionResult(data);
        });

        this.socket.on('log:new', (data) => {
          this.addLogEntry(data);
        });

        this.socket.on('chat:spectator', (data) => {
          this.addChatMessage(data);
        });

        this.socket.on('battle:ended', (data) => {
          console.log('[Spectator] Battle ended:', data);
          this.handleBattleEnd(data);
        });
      }

      checkUrlParams() {
        const urlParams = new URLSearchParams(window.location.search);
        const battleId = urlParams.get('battleId');
        const token = urlParams.get('token');

        if (battleId) {
          this.authBattleId.value = battleId;
        }
        if (token) {
          this.authToken.value = token;
        }

        // URLì— íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ ìë™ ì¸ì¦ ì‹œë„
        if (battleId && token) {
          setTimeout(() => {
            this.authenticate();
          }, 500);
        }
      }

      updateConnectionStatus(status) {
        this.connectionDot.className = `connection-dot ${status}`;
        
        const statusText = {
          'connected': 'ì—°ê²°ë¨',
          'disconnected': 'ì—°ê²° ëŠê¹€',
          'connecting': 'ì—°ê²° ì¤‘...'
        };

        this.connectionText.textContent = statusText[status] || 'ì•Œ ìˆ˜ ì—†ìŒ';
      }

      authenticate() {
        const battleId = this.authBattleId.value.trim();
        const token = this.authToken.value.trim();
        const name = this.spectatorNameInput.value.trim();

        if (!battleId || !token || !name) {
          this.showError('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        if (name.length > 15) {
          this.showError('ì´ë¦„ì€ 15ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        this.currentBattleId = battleId;
        this.spectatorName = name;

        console.log('[Spectator] Attempting to join:', { battleId, token, name });

        this.socket.emit('spectator:join', {
          battleId,
          token,
          name
        });
      }

      handleAuthSuccess(data) {
        console.log('[Spectator] Successfully joined battle');
        this.joined = true;

        // ì¸ì¦ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
        this.authSection.style.display = 'none';

        // ì „íˆ¬ ê´€ë ¨ ì„¹ì…˜ ë³´ì´ê¸°
        this.battlefieldSection.style.display = 'block';
        this.logSection.style.display = 'block';
        this.chatSection.style.display = 'block';

        // ì´ˆê¸° ìƒíƒœ ì—…ë°ì´íŠ¸
        if (data.battleState) {
          this.updateBattleState(data.battleState);
        }

        this.showSuccess('ê´€ì „ì„ ì‹œì‘í•©ë‹ˆë‹¤!');
      }

      updateBattleState(battleState) {
        if (!battleState || !battleState.teams) return;

        // íŒ€ ì •ë³´ ì—…ë°ì´íŠ¸
        const teamA = battleState.teams.A;
        const teamB = battleState.teams.B;

        if (teamA) {
          this.teamAHeader.textContent = teamA.name || 'ë¶ˆì‚¬ì¡° ê¸°ì‚¬ë‹¨';
          this.renderTeam(teamA, this.teamAUnits, battleState.currentTurn);
        }

        if (teamB) {
          this.teamBHeader.textContent = teamB.name || 'ì£½ìŒì„ ë¨¹ëŠ” ìë“¤';
          this.renderTeam(teamB, this.teamBUnits, battleState.currentTurn);
        }
      }

      renderTeam(team, container, currentTurn) {
        if (!team.players) return;

        container.innerHTML = '';

        team.players.forEach(player => {
          const isCurrentTurn = currentTurn && currentTurn.playerId === player.id;
          const isDefeated = player.stats.hp <= 0;

          const unitCard = document.createElement('div');
          unitCard.className = `unit-card ${isCurrentTurn ? 'current-turn' : ''} ${isDefeated ? 'defeated' : ''}`;

          const hpPercent = Math.max(0, (player.stats.hp / player.stats.maxHp) * 100);

          unitCard.innerHTML = `
            <div class="unit-name">${player.name}</div>
            <div class="unit-stats">
              <div class="stat-item">
                <span class="stat-label">ê³µê²©</span>
                <span class="stat-value">${player.stats.attack}</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">ë°©ì–´</span>
                <span class="stat-value">${player.stats.defense}</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">ë¯¼ì²©</span>
                <span class="stat-value">${player.stats.agility}</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">í–‰ìš´</span>
                <span class="stat-value">${player.stats.luck}</span>
              </div>
            </div>
            <div class="hp-bar">
              <div class="hp-fill" style="width: ${hpPercent}%;"></div>
            </div>
            <div class="hp-text">${player.stats.hp}/${player.stats.maxHp} HP</div>
          `;

          container.appendChild(unitCard);
        });
      }

      handleActionResult(data) {
        // ì•¡ì…˜ ê²°ê³¼ì— ë”°ë¥¸ ì‹œê°ì  í”¼ë“œë°±
        if (data.type === 'damage') {
          this.addLogEntry({
            text: `${data.attacker}ê°€ ${data.target}ì—ê²Œ ${data.damage} ë°ë¯¸ì§€!`,
            type: 'damage',
            timestamp: Date.now()
          });
        } else if (data.type === 'heal') {
          this.addLogEntry({
            text: `${data.player}ê°€ ${data.amount} íšŒë³µ!`,
            type: 'heal',
            timestamp: Date.now()
          });
        }
      }

      sendCheer(message) {
        if (!this.joined || !this.socket) return;

        this.socket.emit('spectator:cheer', {
          battleId: this.currentBattleId,
          message: message,
          spectatorName: this.spectatorName
        });

        // ë¡œì»¬ì— ì¦‰ì‹œ í‘œì‹œ
        this.addChatMessage({
          type: 'cheer',
          name: this.spectatorName,
          message: message,
          timestamp: Date.now()
        });
      }

      sendChat() {
        const message = this.chatInput.value.trim();
        if (!message || !this.joined) return;

        this.socket.emit('spectator:chat', {
          battleId: this.currentBattleId,
          message: message,
          spectatorName: this.spectatorName
        });

        this.chatInput.value = '';
      }

      addLogEntry(data) {
        if (!this.battleLog) return;

        const entry = document.createElement('div');
        entry.className = `log-entry ${data.type || 'info'}`;

        const time = new Date(data.timestamp || Date.now());
        const timeStr = time.toLocaleTimeString('ko-KR', {
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit'
        });

        entry.innerHTML = `
          <span class="log-time">${timeStr}</span>
          <span class="log-content">${data.text}</span>
        `;

        this.battleLog.appendChild(entry);
        this.battleLog.scrollTop = this.battleLog.scrollHeight;
      }

      addChatMessage(data) {
        if (!this.chatMessages) return;

        const message = document.createElement('div');
        message.className = `chat-message ${data.type || 'normal'}`;

        const time = new Date(data.timestamp || Date.now());
        const timeStr = time.toLocaleTimeString('ko-KR', {
          hour: '2-digit',
          minute: '2-digit'
        });

        message.innerHTML = `
          <span class="chat-time">${timeStr}</span>
          <span class="chat-content"><strong>${data.name}:</strong> ${data.message}</span>
        `;

        this.chatMessages.appendChild(message);
        this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
      }

      handleBattleEnd(data) {
        this.addLogEntry({
          text: `ì „íˆ¬ ì¢…ë£Œ! ìŠ¹ì: ${data.winner || 'ë¬´ìŠ¹ë¶€'}`,
          type: 'system',
          timestamp: Date.now()
        });

        // ëª¨ë“  ì‘ì› ë²„íŠ¼ ë¹„í™œì„±í™”
        document.querySelectorAll('.cheer-btn').forEach(btn => {
          btn.disabled = true;
          btn.style.opacity = '0.5';
        });

        this.showInfo('ì „íˆ¬ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
      }

      showError(message) {
        this.showToast(message, 'error');
      }

      showSuccess(message) {
        this.showToast(message, 'success');
      }

      showInfo(message) {
        this.showToast(message, 'info');
      }

      showToast(message, type = 'info') {
        // ê°„ë‹¨í•œ í† ìŠ¤íŠ¸ êµ¬í˜„
        const toast = document.createElement('div');
        toast.style.cssText = `
          position: fixed;
          top: 80px;
          right: 20px;
          background: ${type === 'error' ? '#e74c3c' : type === 'success' ? '#27ae60' : '#3498db'};
          color: white;
          padding: 12px 20px;
          border-radius: 8px;
          font-weight: 600;
          z-index: 2000;
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          animation: slideIn 0.3s ease;
        `;
        toast.textContent = message;

        // ìŠ¬ë¼ì´ë“œ ì¸ ì• ë‹ˆë©”ì´ì…˜
        const style = document.createElement('style');
        style.textContent = `
          @keyframes slideIn {
            from {
              transform: translateX(100%);
              opacity: 0;
            }
            to {
              transform: translateX(0);
              opacity: 1;
            }
          }
        `;
        document.head.appendChild(style);

        document.body.appendChild(toast);

        setTimeout(() => {
          toast.style.animation = 'slideIn 0.3s ease reverse';
          setTimeout(() => {
            if (toast.parentNode) {
              toast.parentNode.removeChild(toast);
            }
            if (style.parentNode) {
              style.parentNode.removeChild(style);
            }
          }, 300);
        }, 3000);
      }
    }

    // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
      window.pyxisSpectator = new PyxisSpectator();
    });
  </script>
</body>
</html>
