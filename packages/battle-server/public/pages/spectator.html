<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>PYXIS | 관전자</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/svg+xml" href="/assets/images/favicon.svg">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/pyxis-theme.css">
  <link rel="stylesheet" href="/assets/css/core.css">
  <link rel="stylesheet" href="/assets/css/components.css">
  <script src="/socket.io/socket.io.js"></script>
  <style>
    /* 관전자 페이지 전용 고급 스타일 */
    body {
      background: linear-gradient(135deg, 
        var(--deep-navy) 0%, 
        var(--midnight) 20%, 
        var(--navy-mist) 40%, 
        var(--navy-light) 60%,
        var(--midnight) 80%, 
        var(--deep-navy) 100%);
      background-attachment: fixed;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* 우주 관측소 배경 효과 */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: 
        radial-gradient(circle at 25% 25%, rgba(212,183,126,0.04) 0%, transparent 50%),
        radial-gradient(circle at 75% 25%, rgba(212,183,126,0.03) 0%, transparent 40%),
        radial-gradient(circle at 50% 75%, rgba(212,183,126,0.05) 0%, transparent 45%),
        radial-gradient(circle at 10% 60%, rgba(212,183,126,0.02) 0%, transparent 35%),
        radial-gradient(circle at 90% 40%, rgba(212,183,126,0.03) 0%, transparent 30%);
      animation: observatoryDrift 30s ease-in-out infinite;
      pointer-events: none;
      z-index: -1;
    }

    @keyframes observatoryDrift {
      0%, 100% { opacity: 0.4; transform: rotate(0deg) scale(1); }
      33% { opacity: 0.7; transform: rotate(1deg) scale(1.01); }
      66% { opacity: 0.5; transform: rotate(-0.5deg) scale(0.99); }
    }

    /* 연결 상태 */
    .connection-status {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      background: rgba(8,13,25,0.95);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(212,183,126,0.25);
      border-radius: var(--radius-large);
      padding: 12px 20px;
      font-weight: 600;
      z-index: 1000;
      box-shadow: var(--shadow-deep);
    }

    .connection-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--warning);
      animation: connectionPulse 2s ease-in-out infinite;
      box-shadow: 0 0 12px currentColor;
    }

    .connection-dot.connected {
      background: var(--success);
      color: var(--success);
    }

    @keyframes connectionPulse {
      0%, 100% { opacity: 0.6; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.2); }
    }

    /* 관전자 헤더 */
    .spectator-header {
      text-align: center;
      padding: 100px 20px 80px;
      position: relative;
      overflow: hidden;
      background: linear-gradient(135deg, 
        rgba(212,183,126,0.12) 0%, 
        rgba(10,15,26,0.95) 20%, 
        rgba(10,15,26,0.95) 80%, 
        rgba(212,183,126,0.12) 100%);
      border-bottom: 2px solid rgba(212,183,126,0.25);
    }

    .spectator-header::before {
      content: '';
      position: absolute;
      top: -150%;
      left: -75%;
      right: -75%;
      height: 400%;
      background: conic-gradient(from 30deg, 
        rgba(212,183,126,0.1) 0deg, 
        transparent 60deg,
        rgba(212,183,126,0.06) 120deg, 
        transparent 180deg,
        rgba(212,183,126,0.08) 240deg,
        transparent 300deg,
        rgba(212,183,126,0.1) 360deg);
      animation: spectatorOrbit 50s linear infinite;
      pointer-events: none;
      z-index: -1;
    }

    @keyframes spectatorOrbit {
      0% { transform: rotate(0deg) scale(1); }
      100% { transform: rotate(-360deg) scale(1); }
    }

    .spectator-brand {
      font-family: var(--serif);
      font-weight: 900;
      font-size: clamp(2.2rem, 5.5vw, 4rem);
      background: linear-gradient(135deg, 
        var(--gold-bright) 0%, 
        var(--gold-shimmer) 20%, 
        var(--gold) 40%, 
        var(--gold-light) 60%,
        var(--gold-shimmer) 80%,
        var(--gold-bright) 100%);
      background-size: 300% 300%;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: spectatorShimmer 5s ease-in-out infinite;
      letter-spacing: 0.06em;
      position: relative;
      text-shadow: 0 0 40px rgba(212,183,126,0.3);
    }

    @keyframes spectatorShimmer {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .spectator-brand::after {
      content: '관측소';
      position: absolute;
      bottom: -40px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1rem;
      font-weight: 700;
      color: var(--gold);
      background: linear-gradient(135deg, 
        rgba(212,183,126,0.18), 
        rgba(212,183,126,0.1));
      border: 1px solid rgba(212,183,126,0.4);
      border-radius: 30px;
      padding: 10px 24px;
      letter-spacing: 0.04em;
      white-space: nowrap;
      animation: observatoryGlow 4s ease-in-out infinite;
    }

    @keyframes observatoryGlow {
      0%, 100% { 
        opacity: 0.9; 
        transform: translateX(-50%) scale(1);
        box-shadow: 0 0 20px rgba(212,183,126,0.2);
      }
      50% { 
        opacity: 1; 
        transform: translateX(-50%) scale(1.05);
        box-shadow: 0 0 30px rgba(212,183,126,0.4);
      }
    }

    /* 메인 컨테이너 - 3열 그리드 */
    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 50px 24px;
      display: grid;
      grid-template-columns: 300px 1fr 350px;
      gap: 40px;
      align-items: start;
    }

    /* 카드 스타일 */
    .card {
      background: linear-gradient(145deg, 
        rgba(15,20,25,0.92) 0%, 
        rgba(25,31,42,0.85) 50%, 
        rgba(15,20,25,0.92) 100%);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(212,183,126,0.2);
      border-radius: var(--radius-xl);
      padding: 32px;
      margin-bottom: 32px;
      position: relative;
      overflow: hidden;
      transition: all var(--transition-normal);
      box-shadow: var(--shadow-medium), var(--shadow-inset);
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 20%;
      right: 20%;
      height: 2px;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(212,183,126,0.6), 
        transparent);
      border-radius: 1px;
    }

    .card:hover {
      transform: translateY(-6px);
      border-color: rgba(212,183,126,0.4);
      box-shadow: var(--shadow-deep), 
                  var(--shadow-inset), 
                  0 0 50px rgba(212,183,126,0.15);
    }

    /* 인증 섹션 */
    #authSection {
      grid-column: 1 / -1;
      max-width: 700px;
      justify-self: center;
    }

    /* 섹션 제목 */
    .section-title {
      font-family: var(--serif);
      font-size: 1.4rem;
      font-weight: 800;
      color: var(--gold-bright);
      margin-bottom: 24px;
      position: relative;
      padding-left: 24px;
      letter-spacing: 0.03em;
    }

    .section-title::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 8px;
      height: 70%;
      background: linear-gradient(to bottom, 
        var(--gold-bright), 
        var(--gold-dark));
      border-radius: 4px;
      box-shadow: 0 0 15px rgba(212,183,126,0.5);
    }

    /* 폼 스타일 */
    .field {
      margin-bottom: 28px;
    }

    .field label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: var(--text-dim);
      font-size: 15px;
      letter-spacing: 0.02em;
    }

    .input {
      width: 100%;
      padding: 18px 24px;
      background: rgba(8,13,25,0.85);
      border: 2px solid rgba(212,183,126,0.18);
      border-radius: var(--radius);
      color: var(--text);
      font-size: 16px;
      font-weight: 500;
      transition: all var(--transition-normal);
      backdrop-filter: blur(12px);
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.2);
    }

    .input::placeholder {
      color: var(--text-muted);
      opacity: 0.7;
    }

    .input:focus {
      outline: none;
      border-color: var(--gold);
      background: rgba(8,13,25,0.98);
      box-shadow: 0 0 0 4px rgba(212,183,126,0.18),
                  0 0 25px rgba(212,183,126,0.12),
                  inset 0 2px 8px rgba(0,0,0,0.2);
    }

    /* 버튼 스타일 */
    .btn {
      padding: 20px 32px;
      background: linear-gradient(145deg, 
        var(--gold-bright), 
        var(--gold-dark));
      border: 2px solid var(--gold);
      border-radius: var(--radius);
      color: var(--deep-navy);
      font-family: var(--sans);
      font-size: 16px;
      font-weight: 700;
      text-align: center;
      cursor: pointer;
      transition: all var(--transition-normal);
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow-soft);
      letter-spacing: 0.02em;
    }

    .btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, 
        rgba(255,255,255,0.2), 
        transparent 50%, 
        rgba(255,255,255,0.1));
      opacity: 0;
      transition: opacity var(--transition-normal);
    }

    .btn:hover:not(:disabled) {
      transform: translateY(-4px) scale(1.02);
      box-shadow: var(--shadow-medium), 
                  0 0 30px rgba(212,183,126,0.4);
      background: linear-gradient(145deg, 
        var(--gold-shimmer), 
        var(--gold));
    }

    .btn:hover:not(:disabled)::before {
      opacity: 1;
    }

    .btn:active {
      transform: translateY(-2px) scale(1.01);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* 인증 섹션 */
    #authSection {
      grid-column: 1 / -1;
      max-width: 700px;
      justify-self: center;
    }

    /* 3개 컬럼 섹션들 */
    .team-section,
    .battle-section {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* 로그&채팅 섹션 - 하단 전체 너비 */
    .log-chat-section {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
      margin-top: 20px;
    }

    /* 팀 정보 스타일 */
    .team-units {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    /* 전투 현황 카드 */
    .battle-status-card {
      min-height: 150px;
    }

    .battle-info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .battle-stat {
      display: flex;
      justify-content: space-between;
      padding: 8px 12px;
      background: rgba(0,0,0,0.2);
      border-radius: 6px;
      font-size: 13px;
    }

    .battle-stat .stat-label {
      color: var(--text-dim);
      font-weight: 600;
    }

    .battle-stat .stat-value {
      color: var(--gold);
      font-weight: 700;
    }

    .battle-status {
      color: var(--success) !important;
      font-weight: 700 !important;
      background: rgba(39,174,96,0.2) !important;
      padding: 2px 8px !important;
      border-radius: 8px !important;
    }

    .battle-status.ended {
      color: var(--danger) !important;
      background: rgba(231,76,60,0.2) !important;
    }

    /* 턴 표시 카드 */
    .turn-display-card {
      min-height: 120px;
    }

    .turn-display {
      text-align: center;
      padding: 20px;
      background: rgba(212,183,126,0.05);
      border: 1px solid rgba(212,183,126,0.15);
      border-radius: var(--radius);
    }

    .turn-player {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .player-name {
      font-size: 18px;
      font-weight: 800;
      color: var(--gold-bright);
    }

    .player-team {
      font-size: 14px;
      color: var(--text-dim);
    }

    .turn-action {
      font-size: 12px;
      font-weight: 600;
      padding: 6px 12px;
      background: var(--info);
      color: white;
      border-radius: 12px;
      display: inline-block;
      margin-top: 4px;
    }

    .turn-action.waiting {
      background: var(--warning);
    }

    .turn-action.active {
      background: var(--success);
      animation: turnPulse 2s ease-in-out infinite;
    }

    /* 응원 카드 */
    .cheer-card {
      flex: 1;
    }

    .cheer-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    .cheer-btn {
      padding: 12px 16px;
      background: linear-gradient(135deg, 
        rgba(52,152,219,0.8), 
        rgba(41,128,185,0.8));
      border: 1px solid var(--info);
      border-radius: var(--radius-small);
      color: white;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-fast);
      text-align: center;
      position: relative;
    }

    .cheer-btn:hover {
      transform: translateY(-2px);
      background: linear-gradient(135deg, 
        var(--info), 
        rgba(41,128,185,0.9));
      box-shadow: 0 4px 12px rgba(52,152,219,0.3);
    }

    .cheer-btn:active {
      transform: translateY(0);
    }

    .cheer-btn::after {
      content: attr(data-key);
      position: absolute;
      top: 4px;
      right: 6px;
      font-size: 10px;
      font-weight: 600;
      color: rgba(255,255,255,0.6);
      background: rgba(0,0,0,0.3);
      padding: 1px 4px;
      border-radius: 2px;
    }

    /* 채팅 & 로그 */
    .log-card {
      min-height: 350px;
    }

    .chat-card {
      min-height: 350px;
      display: flex;
      flex-direction: column;
    }

    .chat-messages {
      height: 250px;
      margin-bottom: 16px;
      flex: 1;
    }

    .chat-input-group {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .chat-input {
      flex: 1;
      font-size: 14px;
      padding: 12px 16px;
    }

    .chat-send {
      min-width: 80px;
      font-size: 13px;
      padding: 12px 20px;
    }

    .team-header {
      text-align: center;
      font-family: var(--serif);
      font-weight: 800;
      font-size: 20px;
      color: var(--gold-bright);
      padding: 16px;
      background: linear-gradient(135deg, 
        rgba(212,183,126,0.15), 
        rgba(212,183,126,0.08));
      border: 1px solid rgba(212,183,126,0.25);
      border-radius: var(--radius);
      margin-bottom: 20px;
      position: relative;
      text-shadow: 0 2px 10px rgba(212,183,126,0.4);
      letter-spacing: 0.02em;
    }

    .team-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 25%;
      right: 25%;
      height: 2px;
      background: linear-gradient(90deg, 
        transparent, 
        var(--gold-bright), 
        transparent);
      border-radius: 1px;
    }

    .team-header.phoenix {
      background: linear-gradient(135deg, 
        rgba(231,76,60,0.15), 
        rgba(231,76,60,0.08));
      border-color: rgba(231,76,60,0.4);
      color: #FF6B6B;
    }

    .team-header.death-eater {
      background: linear-gradient(135deg, 
        rgba(46,125,50,0.15), 
        rgba(46,125,50,0.08));
      border-color: rgba(46,125,50,0.4);
      color: #66BB6A;
    }

    .unit-card {
      background: linear-gradient(135deg, 
        rgba(8,13,25,0.9), 
        rgba(15,20,25,0.8));
      border: 1px solid rgba(212,183,126,0.15);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 16px;
      transition: all var(--transition-normal);
      position: relative;
    }

    .unit-card:hover {
      transform: translateY(-3px);
      border-color: rgba(212,183,126,0.35);
      box-shadow: var(--shadow-soft), 
                  0 0 20px rgba(212,183,126,0.1);
    }

    .unit-card.current-turn {
      border-color: var(--gold-bright);
      background: linear-gradient(135deg, 
        rgba(212,183,126,0.12), 
        rgba(8,13,25,0.95));
      box-shadow: 0 0 25px rgba(212,183,126,0.2);
      animation: currentTurnGlow 2s ease-in-out infinite;
    }

    @keyframes currentTurnGlow {
      0%, 100% { box-shadow: 0 0 25px rgba(212,183,126,0.2); }
      50% { box-shadow: 0 0 35px rgba(212,183,126,0.4); }
    }

    .unit-card.defeated {
      opacity: 0.4;
      filter: grayscale(0.8);
      transform: none;
    }

    .unit-name {
      font-size: 18px;
      font-weight: 700;
      color: var(--gold-bright);
      margin-bottom: 12px;
      text-align: center;
    }

    .unit-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      font-size: 13px;
      color: var(--text-dim);
      margin-bottom: 12px;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      padding: 4px 8px;
      background: rgba(0,0,0,0.2);
      border-radius: 4px;
    }

    .stat-label {
      font-weight: 600;
    }

    .stat-value {
      color: var(--gold);
      font-weight: 700;
    }

    /* HP 바 개선 */
    .hp-bar {
      width: 100%;
      height: 12px;
      background: linear-gradient(135deg, 
        rgba(0,0,0,0.4), 
        rgba(0,0,0,0.2));
      border-radius: 6px;
      overflow: hidden;
      border: 1px solid rgba(212,183,126,0.2);
      position: relative;
      margin-top: 8px;
    }

    .hp-fill {
      height: 100%;
      background: linear-gradient(90deg, 
        var(--success) 0%, 
        var(--warning) 50%, 
        var(--danger) 100%);
      transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      border-radius: 5px;
    }

    .hp-fill::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(255,255,255,0.4) 50%, 
        transparent 100%);
      animation: hpShimmer 3s ease-in-out infinite;
    }

    @keyframes hpShimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .hp-text {
      text-align: center;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* 응원 버튼들 */
    .cheer-section {
      margin-top: 24px;
    }

    .cheer-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 12px;
    }

    .cheer-btn {
      padding: 12px 16px;
      background: linear-gradient(135deg, 
        rgba(52,152,219,0.8), 
        rgba(41,128,185,0.8));
      border: 1px solid var(--info);
      border-radius: var(--radius-small);
      color: white;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-fast);
      text-align: center;
    }

    .cheer-btn:hover {
      transform: translateY(-2px);
      background: linear-gradient(135deg, 
        var(--info), 
        rgba(41,128,185,0.9));
      box-shadow: 0 4px 12px rgba(52,152,219,0.3);
    }

    .cheer-btn:active {
      transform: translateY(0);
    }

    /* 로그 및 채팅 */
    .battle-log, .chat-messages {
      height: 400px;
      background: linear-gradient(145deg, 
        rgba(5,15,28,0.98), 
        rgba(8,20,35,0.95));
      border: 1px solid rgba(212,183,126,0.25);
      border-radius: var(--radius-large);
      padding: 24px;
      overflow-y: auto;
      backdrop-filter: blur(16px);
      box-shadow: inset 0 4px 20px rgba(0,0,0,0.5),
                  inset 0 1px 0 rgba(255,255,255,0.05);
      font-size: 14px;
      line-height: 1.6;
    }

    .log-entry, .chat-message {
      display: flex;
      gap: 12px;
      align-items: baseline;
      margin-bottom: 12px;
      padding: 10px 14px;
      border-radius: var(--radius-small);
      transition: background var(--transition-fast);
      border-left: 3px solid transparent;
    }

    .log-entry:hover, .chat-message:hover {
      background: rgba(212,183,126,0.05);
    }

    .log-entry.system {
      border-left-color: var(--gold);
    }

    .log-entry.action {
      border-left-color: var(--info);
    }

    .log-entry.damage {
      border-left-color: var(--danger);
    }

    .log-time, .chat-time {
      font-size: 11px;
      color: var(--text-muted);
      min-width: 65px;
      font-weight: 600;
      opacity: 0.8;
    }

    .log-content, .chat-content {
      flex: 1;
      color: var(--text-dim);
      word-wrap: break-word;
    }

    .log-entry.system .log-content {
      color: var(--gold-bright);
      font-weight: 600;
    }

    .log-entry.action .log-content {
      color: var(--text);
      font-weight: 600;
    }

    .chat-message.cheer .chat-content {
      color: var(--success);
      font-weight: 600;
      font-style: italic;
    }

    /* 채팅 입력 */
    .chat-input-container {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 20px;
      padding: 16px;
      background: rgba(8,13,25,0.8);
      border: 1px solid rgba(212,183,126,0.15);
      border-radius: var(--radius);
      backdrop-filter: blur(12px);
    }

    .chat-input-container .input {
      flex: 1;
      margin-bottom: 0;
      padding: 12px 16px;
    }

    /* 반응형 디자인 */
    @media (max-width: 1200px) {
      .container {
        grid-template-columns: 1fr 1fr;
        gap: 32px;
        padding: 40px 20px;
      }

      .battle-section {
        grid-column: 1 / -1;
      }
    }

    @media (max-width: 800px) {
      .container {
        grid-template-columns: 1fr;
        gap: 24px;
        padding: 32px 16px;
      }
    }

    @media (max-width: 768px) {
      .spectator-header {
        padding: 80px 16px 60px;
      }

      .spectator-brand {
        font-size: 2.5rem;
      }

      .spectator-brand::after {
        bottom: -35px;
        font-size: 0.9rem;
        padding: 8px 20px;
      }

      .container {
        padding: 32px 16px;
        gap: 24px;
      }

      .card {
        padding: 24px;
        margin-bottom: 24px;
      }

      .cheer-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
      }

      .cheer-btn {
        padding: 10px 12px;
        font-size: 12px;
      }

      .battle-info {
        grid-template-columns: 1fr;
        gap: 8px;
      }

      .log-chat-section {
        grid-template-columns: 1fr;
        gap: 20px;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 24px 12px;
      }

      .card {
        padding: 20px;
      }

      .cheer-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
      }

      .cheer-btn {
        padding: 8px 10px;
        font-size: 11px;
      }

      .connection-status {
        position: static;
        margin: 16px;
        justify-self: center;
      }

      .chat-input-group {
        flex-direction: column;
        gap: 10px;
      }

      .chat-input,
      .chat-send {
        width: 100%;
      }
    }

    /* 스크롤바 커스터마이징 */
    .battle-log::-webkit-scrollbar,
    .chat-messages::-webkit-scrollbar {
      width: 10px;
    }

    .battle-log::-webkit-scrollbar-track,
    .chat-messages::-webkit-scrollbar-track {
      background: rgba(5,15,28,0.9);
      border-radius: 5px;
    }

    .battle-log::-webkit-scrollbar-thumb,
    .chat-messages::-webkit-scrollbar-thumb {
      background: linear-gradient(to bottom, 
        var(--gold-bright), 
        var(--gold-dark));
      border-radius: 5px;
      border: 1px solid rgba(0,0,0,0.3);
    }

    .battle-log::-webkit-scrollbar-thumb:hover,
    .chat-messages::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(to bottom, 
        var(--gold-shimmer), 
        var(--gold));
    }
  </style>
</head>
<body>
  <!-- 연결 상태 -->
  <div class="connection-status" id="connectionStatus">
    <div class="connection-dot" id="connectionDot"></div>
    <span id="connectionText">연결 중...</span>
  </div>

  <!-- 헤더 -->
  <header class="spectator-header">
    <div class="spectator-brand">PYXIS</div>
  </header>

  <main class="container">
    <!-- 인증 섹션 -->
    <section id="authSection" class="card">
      <div class="section-header">
        <h2 class="section-title">관전자 입장</h2>
      </div>
      <form id="authForm">
        <div class="field">
          <label for="authBattleId">전투 ID</label>
          <input type="text" id="authBattleId" name="authBattleId" class="input" placeholder="전투 ID 입력" required />
        </div>
        <div class="field">
          <label for="authToken">관전자 OTP</label>
          <input type="text" id="authToken" name="authToken" class="input" placeholder="발급된 OTP 입력" required />
        </div>
        <div class="field">
          <label for="spectatorName">관전자 이름</label>
          <input type="text" id="spectatorName" name="spectatorName" class="input" placeholder="원하는 이름 입력" required maxlength="15" />
        </div>
        <button type="submit" class="btn">관전 시작</button>
      </form>
    </section>

    <!-- 좌측: 팀 A 정보 -->
    <section id="teamASection" class="team-section" style="display:none;">
      <div class="card">
        <div class="section-title">불사조 기사단</div>
        <div class="team-header phoenix" id="teamAHeader">불사조 기사단</div>
        <div id="teamAUnits" class="team-units"></div>
      </div>
    </section>

    <!-- 중앙: 전투 현황 & 응원 -->
    <section id="battleSection" class="battle-section" style="display:none;">
      <!-- 전투 상태 정보 -->
      <div class="card battle-status-card">
        <div class="section-title">전투 현황</div>
        <div class="battle-info">
          <div class="battle-stat">
            <span class="stat-label">전투 모드</span>
            <span class="stat-value" id="battleMode">-</span>
          </div>
          <div class="battle-stat">
            <span class="stat-label">현재 턴</span>
            <span class="stat-value" id="currentTurnInfo">-</span>
          </div>
          <div class="battle-stat">
            <span class="stat-label">전투 시간</span>
            <span class="stat-value" id="battleTime">-</span>
          </div>
          <div class="battle-stat">
            <span class="stat-label">전투 상태</span>
            <span class="battle-status" id="battleStatus">진행중</span>
          </div>
        </div>
      </div>

      <!-- 턴 정보 -->
      <div class="card turn-display-card">
        <div class="section-title">현재 턴</div>
        <div class="turn-display">
          <div class="turn-player" id="currentPlayer">
            <div class="player-name" id="currentPlayerName">-</div>
            <div class="player-team" id="currentPlayerTeam">-</div>
            <div class="turn-action" id="currentAction">행동 대기중</div>
          </div>
        </div>
      </div>

      <!-- 응원 버튼들 -->
      <div class="card cheer-card">
        <div class="section-title">응원하기</div>
        <div class="cheer-grid">
          <button class="cheer-btn" data-cheer="파이팅!" data-key="1">파이팅!</button>
          <button class="cheer-btn" data-cheer="멋져요!" data-key="2">멋져요!</button>
          <button class="cheer-btn" data-cheer="대단해!" data-key="3">대단해!</button>
          <button class="cheer-btn" data-cheer="화이팅!" data-key="4">화이팅!</button>
          <button class="cheer-btn" data-cheer="굿굿!" data-key="5">굿굿!</button>
          <button class="cheer-btn" data-cheer="최고다!" data-key="6">최고다!</button>
          <button class="cheer-btn" data-cheer="잘한다!" data-key="7">잘한다!</button>
          <button class="cheer-btn" data-cheer="끝내준다!" data-key="8">끝내준다!</button>
        </div>
      </div>
    </section>

    <!-- 우측: 팀 B 정보 -->
    <section id="teamBSection" class="team-section" style="display:none;">
      <div class="card">
        <div class="section-title">죽음을 먹는 자들</div>
        <div class="team-header death-eater" id="teamBHeader">죽음을 먹는 자들</div>
        <div id="teamBUnits" class="team-units"></div>
      </div>
    </section>

    <!-- 하단: 로그 & 채팅 -->
    <section id="logChatSection" class="log-chat-section" style="display:none;">
      <!-- 전투 로그 -->
      <div class="card log-card">
        <div class="section-title">전투 기록</div>
        <div id="battleLog" class="battle-log"></div>
      </div>

      <!-- 채팅 -->
      <div class="card chat-card">
        <div class="section-title">관전자 채팅</div>
        <div id="chatMessages" class="chat-messages"></div>
        <div class="chat-input-group">
          <input type="text" id="chatInput" class="input chat-input" placeholder="응원 메시지를 입력하세요..." />
          <button id="chatSendBtn" class="btn chat-send">전송</button>
        </div>
      </div>
    </section>
  </main>

  <!-- JS -->
  <script src="/assets/js/core/socket-manager.js"></script>
  <script src="/assets/js/core/ui-helpers.js"></script>
  <script>
    // 관전자 페이지 로직
    class PyxisSpectator {
      constructor() {
        this.currentBattleId = null;
        this.spectatorName = null;
        this.joined = false;
        this.socket = null;

        this.init();
      }

      init() {
        this.setupElements();
        this.setupEventListeners();
        this.initSocket();
        this.checkUrlParams();
      }

      setupElements() {
        // 연결 상태
        this.connectionDot = document.getElementById('connectionDot');
        this.connectionText = document.getElementById('connectionText');

        // 인증 폼
        this.authSection = document.getElementById('authSection');
        this.authForm = document.getElementById('authForm');
        this.authBattleId = document.getElementById('authBattleId');
        this.authToken = document.getElementById('authToken');
        this.spectatorNameInput = document.getElementById('spectatorName');

        // 팀 섹션들
        this.teamASection = document.getElementById('teamASection');
        this.teamBSection = document.getElementById('teamBSection');
        this.battleSection = document.getElementById('battleSection');
        this.logChatSection = document.getElementById('logChatSection');

        // 전투장 요소들
        this.teamAHeader = document.getElementById('teamAHeader');
        this.teamBHeader = document.getElementById('teamBHeader');
        this.teamAUnits = document.getElementById('teamAUnits');
        this.teamBUnits = document.getElementById('teamBUnits');

        // 전투 상태
        this.battleMode = document.getElementById('battleMode');
        this.currentTurnInfo = document.getElementById('currentTurnInfo');
        this.battleTime = document.getElementById('battleTime');
        this.battleStatus = document.getElementById('battleStatus');
        
        // 현재 턴 정보
        this.currentPlayerName = document.getElementById('currentPlayerName');
        this.currentPlayerTeam = document.getElementById('currentPlayerTeam');
        this.currentAction = document.getElementById('currentAction');

        // 로그 & 채팅
        this.battleLog = document.getElementById('battleLog');
        this.chatMessages = document.getElementById('chatMessages');
        this.chatInput = document.getElementById('chatInput');
        this.chatSendBtn = document.getElementById('chatSendBtn');
      }

      setupEventListeners() {
        // 인증 폼
        this.authForm.addEventListener('submit', (e) => {
          e.preventDefault();
          this.authenticate();
        });

        // 응원 버튼들
        document.addEventListener('click', (e) => {
          if (e.target.classList.contains('cheer-btn')) {
            const message = e.target.dataset.cheer;
            this.sendCheer(message);
          }
        });

        // 채팅
        this.chatSendBtn.addEventListener('click', () => this.sendChat());
        this.chatInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') this.sendChat();
        });

        // 응원 단축키
        document.addEventListener('keydown', (e) => {
          if (!this.joined || this.chatInput === document.activeElement) return;
          
          const cheerMap = {
            '1': '파이팅!',
            '2': '멋져요!',
            '3': '대단해!',
            '4': '화이팅!',
            '5': '굿굿!',
            '6': '최고다!',
            '7': '잘한다!',
            '8': '끝내준다!'
          };

          if (cheerMap[e.key]) {
            this.sendCheer(cheerMap[e.key]);
          }
        });
      }

      initSocket() {
        this.socket = io({
          path: '/socket.io/',
          transports: ['websocket', 'polling']
        });

        this.socket.on('connect', () => {
          console.log('[Spectator] Socket connected');
          this.updateConnectionStatus('connected');
        });

        this.socket.on('disconnect', () => {
          console.log('[Spectator] Socket disconnected');
          this.updateConnectionStatus('disconnected');
        });

        this.socket.on('spectator:authSuccess', (data) => {
          console.log('[Spectator] Auth success:', data);
          this.handleAuthSuccess(data);
        });

        this.socket.on('spectator:authError', (error) => {
          console.error('[Spectator] Auth error:', error);
          this.showError(error.message || '인증에 실패했습니다.');
        });

        this.socket.on('battle:stateSync', (data) => {
          console.log('[Spectator] Battle state sync:', data);
          this.updateBattleState(data);
        });

        this.socket.on('battle:actionResult', (data) => {
          console.log('[Spectator] Action result:', data);
          this.handleActionResult(data);
        });

        this.socket.on('log:new', (data) => {
          this.addLogEntry(data);
        });

        this.socket.on('chat:spectator', (data) => {
          this.addChatMessage(data);
        });

        this.socket.on('battle:ended', (data) => {
          console.log('[Spectator] Battle ended:', data);
          this.handleBattleEnd(data);
        });
      }

      checkUrlParams() {
        const urlParams = new URLSearchParams(window.location.search);
        const battleId = urlParams.get('battleId');
        const token = urlParams.get('token');

        if (battleId) {
          this.authBattleId.value = battleId;
        }
        if (token) {
          this.authToken.value = token;
        }

        // URL에 파라미터가 있으면 자동 인증 시도
        if (battleId && token) {
          setTimeout(() => {
            this.authenticate();
          }, 500);
        }
      }

      updateConnectionStatus(status) {
        this.connectionDot.className = `connection-dot ${status}`;
        
        const statusText = {
          'connected': '연결됨',
          'disconnected': '연결 끊김',
          'connecting': '연결 중...'
        };

        this.connectionText.textContent = statusText[status] || '알 수 없음';
      }

      authenticate() {
        const battleId = this.authBattleId.value.trim();
        const token = this.authToken.value.trim();
        const name = this.spectatorNameInput.value.trim();

        if (!battleId || !token || !name) {
          this.showError('모든 필드를 입력해주세요.');
          return;
        }

        if (name.length > 15) {
          this.showError('이름은 15자 이하로 입력해주세요.');
          return;
        }

        this.currentBattleId = battleId;
        this.spectatorName = name;

        console.log('[Spectator] Attempting to join:', { battleId, token, name });

        this.socket.emit('spectator:join', {
          battleId,
          token,
          name
        });
      }

      handleAuthSuccess(data) {
        console.log('[Spectator] Successfully joined battle');
        this.joined = true;

        // 인증 섹션 숨기기
        this.authSection.style.display = 'none';

        // 전투 관련 섹션 보이기
        this.teamASection.style.display = 'block';
        this.teamBSection.style.display = 'block';
        this.battleSection.style.display = 'block';
        this.logChatSection.style.display = 'block';

        // 초기 상태 업데이트
        if (data.battleState) {
          this.updateBattleState(data.battleState);
        }

        this.showSuccess('관전을 시작합니다!');
      }

      updateBattleState(battleState) {
        if (!battleState || !battleState.teams) return;

        // 전투 정보 업데이트
        if (this.battleMode) {
          this.battleMode.textContent = battleState.mode || '알 수 없음';
        }
        
        if (this.battleStatus) {
          this.battleStatus.textContent = battleState.status === 'ended' ? '종료' : '진행중';
          this.battleStatus.className = `battle-status ${battleState.status === 'ended' ? 'ended' : ''}`;
        }

        // 현재 턴 정보 업데이트
        if (battleState.currentTurn && this.currentPlayerName) {
          this.currentPlayerName.textContent = battleState.currentTurn.playerName || '알 수 없음';
          this.currentPlayerTeam.textContent = battleState.currentTurn.team === 'A' ? '불사조 기사단' : '죽음을 먹는 자들';
          this.currentAction.textContent = battleState.currentTurn.action || '행동 대기중';
          this.currentAction.className = `turn-action ${battleState.currentTurn.isActive ? 'active' : 'waiting'}`;
        }

        // 팀 정보 업데이트
        const teamA = battleState.teams.A;
        const teamB = battleState.teams.B;

        if (teamA) {
          this.teamAHeader.textContent = teamA.name || '불사조 기사단';
          this.renderTeam(teamA, this.teamAUnits, battleState.currentTurn);
        }

        if (teamB) {
          this.teamBHeader.textContent = teamB.name || '죽음을 먹는 자들';
          this.renderTeam(teamB, this.teamBUnits, battleState.currentTurn);
        }
      }

      renderTeam(team, container, currentTurn) {
        if (!team.players) return;

        container.innerHTML = '';

        team.players.forEach(player => {
          const isCurrentTurn = currentTurn && currentTurn.playerId === player.id;
          const isDefeated = player.stats.hp <= 0;

          const unitCard = document.createElement('div');
          unitCard.className = `team-unit ${isCurrentTurn ? 'current-turn' : ''} ${isDefeated ? 'defeated' : ''}`;

          const hpPercent = Math.max(0, (player.stats.hp / player.stats.maxHp) * 100);

          unitCard.innerHTML = `
            <div class="unit-name">${player.name}</div>
            <div class="unit-mini-stats">
              <div class="mini-stat">
                <span>공격</span>
                <span>${player.stats.attack}</span>
              </div>
              <div class="mini-stat">
                <span>방어</span>
                <span>${player.stats.defense}</span>
              </div>
              <div class="mini-stat">
                <span>민첩</span>
                <span>${player.stats.agility}</span>
              </div>
              <div class="mini-stat">
                <span>행운</span>
                <span>${player.stats.luck}</span>
              </div>
            </div>
            <div class="hp-bar">
              <div class="hp-fill" style="width: ${hpPercent}%;"></div>
            </div>
            <div class="hp-text">${player.stats.hp}/${player.stats.maxHp} HP</div>
          `;

          container.appendChild(unitCard);
        });
      }      renderTeam(team, container, currentTurn) {
        if (!team.players) return;

        container.innerHTML = '';

        team.players.forEach(player => {
          const isCurrentTurn = currentTurn && currentTurn.playerId === player.id;
          const isDefeated = player.stats.hp <= 0;

          const unitCard = document.createElement('div');
          unitCard.className = `team-unit ${isCurrentTurn ? 'current-turn' : ''} ${isDefeated ? 'defeated' : ''}`;

          const hpPercent = Math.max(0, (player.stats.hp / player.stats.maxHp) * 100);

          unitCard.innerHTML = `
            <div class="unit-name">${player.name}</div>
            <div class="unit-mini-stats">
              <div class="mini-stat">
                <span>공격</span>
                <span>${player.stats.attack}</span>
              </div>
              <div class="mini-stat">
                <span>방어</span>
                <span>${player.stats.defense}</span>
              </div>
              <div class="mini-stat">
                <span>민첩</span>
                <span>${player.stats.agility}</span>
              </div>
              <div class="mini-stat">
                <span>행운</span>
                <span>${player.stats.luck}</span>
              </div>
            </div>
            <div class="hp-bar">
              <div class="hp-fill" style="width: ${hpPercent}%;"></div>
            </div>
            <div class="hp-text">${player.stats.hp}/${player.stats.maxHp} HP</div>
          `;

          container.appendChild(unitCard);
        });
      }

      handleActionResult(data) {
        // 액션 결과에 따른 시각적 피드백
        if (data.type === 'damage') {
          this.addLogEntry({
            text: `${data.attacker}가 ${data.target}에게 ${data.damage} 데미지!`,
            type: 'damage',
            timestamp: Date.now()
          });
        } else if (data.type === 'heal') {
          this.addLogEntry({
            text: `${data.player}가 ${data.amount} 회복!`,
            type: 'heal',
            timestamp: Date.now()
          });
        }
      }

      sendCheer(message) {
        if (!this.joined || !this.socket) return;

        this.socket.emit('spectator:cheer', {
          battleId: this.currentBattleId,
          message: message,
          spectatorName: this.spectatorName
        });

        // 로컬에 즉시 표시
        this.addChatMessage({
          type: 'cheer',
          name: this.spectatorName,
          message: message,
          timestamp: Date.now()
        });
      }

      sendChat() {
        const message = this.chatInput.value.trim();
        if (!message || !this.joined) return;

        this.socket.emit('spectator:chat', {
          battleId: this.currentBattleId,
          message: message,
          spectatorName: this.spectatorName
        });

        this.chatInput.value = '';
      }

      addLogEntry(data) {
        if (!this.battleLog) return;

        const entry = document.createElement('div');
        entry.className = `log-entry ${data.type || 'info'}`;

        const time = new Date(data.timestamp || Date.now());
        const timeStr = time.toLocaleTimeString('ko-KR', {
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit'
        });

        entry.innerHTML = `
          <span class="log-time">${timeStr}</span>
          <span class="log-content">${data.text}</span>
        `;

        this.battleLog.appendChild(entry);
        this.battleLog.scrollTop = this.battleLog.scrollHeight;
      }

      addChatMessage(data) {
        if (!this.chatMessages) return;

        const message = document.createElement('div');
        message.className = `chat-message ${data.type || 'normal'}`;

        const time = new Date(data.timestamp || Date.now());
        const timeStr = time.toLocaleTimeString('ko-KR', {
          hour: '2-digit',
          minute: '2-digit'
        });

        message.innerHTML = `
          <span class="chat-time">${timeStr}</span>
          <span class="chat-content"><strong>${data.name}:</strong> ${data.message}</span>
        `;

        this.chatMessages.appendChild(message);
        this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
      }

      handleBattleEnd(data) {
        this.addLogEntry({
          text: `전투 종료! 승자: ${data.winner || '무승부'}`,
          type: 'system',
          timestamp: Date.now()
        });

        // 모든 응원 버튼 비활성화
        document.querySelectorAll('.cheer-btn').forEach(btn => {
          btn.disabled = true;
          btn.style.opacity = '0.5';
        });

        // 전투 상태 업데이트
        if (this.battleStatus) {
          this.battleStatus.textContent = '종료';
          this.battleStatus.className = 'battle-status ended';
        }

        this.showInfo('전투가 종료되었습니다.');
      }

      showError(message) {
        this.showToast(message, 'error');
      }

      showSuccess(message) {
        this.showToast(message, 'success');
      }

      showInfo(message) {
        this.showToast(message, 'info');
      }

      showToast(message, type = 'info') {
        // 간단한 토스트 구현
        const toast = document.createElement('div');
        toast.style.cssText = `
          position: fixed;
          top: 80px;
          right: 20px;
          background: ${type === 'error' ? '#e74c3c' : type === 'success' ? '#27ae60' : '#3498db'};
          color: white;
          padding: 12px 20px;
          border-radius: 8px;
          font-weight: 600;
          z-index: 2000;
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          animation: slideIn 0.3s ease;
        `;
        toast.textContent = message;

        // 슬라이드 인 애니메이션
        const style = document.createElement('style');
        style.textContent = `
          @keyframes slideIn {
            from {
              transform: translateX(100%);
              opacity: 0;
            }
            to {
              transform: translateX(0);
              opacity: 1;
            }
          }
        `;
        document.head.appendChild(style);

        document.body.appendChild(toast);

        setTimeout(() => {
          toast.style.animation = 'slideIn 0.3s ease reverse';
          setTimeout(() => {
            if (toast.parentNode) {
              toast.parentNode.removeChild(toast);
            }
            if (style.parentNode) {
              style.parentNode.removeChild(style);
            }
          }, 300);
        }, 3000);
      }
    }

    // 페이지 로드시 초기화
    document.addEventListener('DOMContentLoaded', () => {
      window.pyxisSpectator = new PyxisSpectator();
    });
  </script>
</body>
</html>
