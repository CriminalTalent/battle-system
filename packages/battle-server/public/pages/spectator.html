<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PYXIS 관전자</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700;800&family=Cinzel:wght@700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- CSS: public/assets/css 경로 사용 -->
  <link rel="stylesheet" href="/assets/css/pyxis-unified.css">
  <link rel="stylesheet" href="/assets/css/core.css">
  <link rel="stylesheet" href="/assets/css/components.css">
  <link rel="stylesheet" href="/assets/css/effects.css">
  <link rel="stylesheet" href="/assets/css/spectator.css">

  <style>
    :root {
      --gold1: #DCC7A2;
      --gold2: #D4BA8D;
      --ink: #0f141c;
      --panel: rgba(15,20,28,0.55);
      --panel-strong: rgba(15,20,28,0.75);
      --border: rgba(220,199,162,.25);
    }
    body { background:#0b0f15; color:#EEE6D6; }

    .pyx-header{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 16px; border-bottom:1px solid var(--border);
      background:linear-gradient(180deg, rgba(212,186,141,.08), rgba(212,186,141,.02) 60%, transparent);
      position:sticky; top:0; z-index:30;
    }
    .brand{
      font-family:"Cinzel", serif; font-weight:800; letter-spacing:.06em;
      background:linear-gradient(90deg, #ffe9c4, #c9a97b 40%, #ffe9c4);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      font-size:20px;
    }
    .container{
      display:grid; gap:12px; padding:12px;
      grid-template-columns: 320px 1fr 420px;   /* 타임라인 폭 줄이고, 한 페이지 균형 */
    }
    @media (max-width: 1180px){ .container{ grid-template-columns: 1fr; } }

    .card{
      background:var(--panel); border:1px solid var(--border);
      border-radius:12px; backdrop-filter: blur(8px);
      box-shadow: 0 10px 28px rgba(0,0,0,.35);
    }
    .card .card-hd{
      padding:10px 12px; border-bottom:1px solid var(--border);
      font-weight:700; color:#EEDFC6; display:flex; align-items:center; justify-content:space-between;
    }
    .card .card-bd{ padding:10px 12px; }

    .btn{
      border:1px solid var(--border); background:var(--panel-strong); color:#EEE6D6;
      border-radius:12px; padding:10px 12px; font-weight:700; cursor:pointer;
      transition: transform .12s ease, background .2s ease, box-shadow .2s ease;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(220,199,162,.10); box-shadow: 0 10px 28px rgba(0,0,0,.35); }
    .btn[disabled]{ opacity:.55; cursor:not-allowed; }

    /* 좌: 전투 정보 / 입장 */
    .auth-grid{ display:grid; gap:8px; grid-template-columns: 1fr; }
    .auth-grid input{
      border:1px solid var(--border); border-radius:10px; padding:10px 12px;
      background: rgba(15,20,28,.35); color:#EEE6D6;
    }

    /* 중: 응원 버튼 영역 - 버튼 길이 과도 방지, 2~3열 래핑 */
    .cheer-grid{
      display:grid; gap:8px;
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
    @media (max-width: 880px){ .cheer-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (max-width: 560px){ .cheer-grid{ grid-template-columns: 1fr; } }

    .cheer-btn{
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      text-align:center;
      padding:12px;
    }

    /* 우: 타임라인(로그+채팅 통합) */
    .timeline{ display:flex; flex-direction:column; gap:8px; max-height: calc(100vh - 160px); }
    .feed{
      flex:1 1 auto; overflow:auto; border:1px solid var(--border); border-radius:12px;
      padding:10px 12px; background: rgba(220,199,162,.03);
    }
    .feed .line{ padding:6px 0; border-bottom:1px dashed rgba(220,199,162,.10); font-size:13px; line-height:1.45; }
    .feed .line:last-child{ border-bottom:0; }
    .line .ts{ color:#a89778; margin-right:6px; font-variant-numeric: tabular-nums; }
    .line .tag{ font-weight:700; margin-right:6px; color:#d8c19e; }
    .line.chat .tag{ color:#a9d4ff; }
    .line.cheer .tag{ color:#8be29e; }
    .line.action .tag{ color:#ffd27a; }

    .chatbox{ display:flex; gap:8px; }
    .chatbox input{
      flex:1 1 auto; border:1px solid var(--border); border-radius:10px;
      background: rgba(15,20,28,.35); color:#EEE6D6; padding:10px 12px;
    }

    /* 팀 요약/상태 */
    .status-pill{
      padding:2px 8px; border:1px solid var(--border); border-radius:999px;
      background: rgba(220,199,162,.06); font-weight:700; font-size:12px;
    }
    .summary{ font-size:12px; opacity:.9; }
  </style>
</head>
<body>
  <!-- 헤더 -->
  <header class="pyx-header">
    <div class="brand">PYXIS</div>
    <div class="summary">
      관전자 페이지
      <span class="status-pill" id="battleStatus">대기</span>
    </div>
  </header>

  <!-- 본문 3열 -->
  <main class="container">
    <!-- 좌: 입장/전투 정보 -->
    <aside class="card">
      <div class="card-hd">
        <div>입장</div>
        <div id="authState" style="font-size:12px; opacity:.9;">미인증</div>
      </div>
      <div class="card-bd">
        <div class="auth-grid">
          <input id="battleId" placeholder="전투 ID (예: battle_xxxxxxx)" />
          <input id="viewerName" placeholder="이름 (예: 관전하는 사람)" />
          <input id="otp" placeholder="비밀번호 (관리자 발급)" />
        </div>
        <div style="display:flex; gap:8px; margin-top:10px;">
          <button id="btnJoin" class="btn">입장하기</button>
        </div>

        <hr style="border:none; border-top:1px solid var(--border); margin:12px 0;" />

        <div class="summary">
          <div>전투 ID: <span id="summaryBattleId">-</span></div>
          <div>모드: <span id="summaryMode">-</span></div>
          <div>선공 팀: <span id="summaryFirst">-</span></div>
        </div>
      </div>
    </aside>

    <!-- 중: 응원 패널 -->
    <section class="card">
      <div class="card-hd">
        <div>응원</div>
        <div style="font-size:12px; opacity:.9;">버튼을 눌러 메시지를 보낼 수 있습니다</div>
      </div>
      <div class="card-bd">
        <!-- 기존 프로젝트의 "응원 버튼" 문구를 spectator.js에서 그대로 주입합니다. -->
        <!-- 아래 컨테이너는 spectator.js에서 버튼을 data-msg로 생성/바인딩합니다. -->
        <div id="cheerButtons" class="cheer-grid">
          <!-- 예시(스펙상 spectator.js가 실제 문구/개수를 주입):
          <button class="btn cheer-btn" data-msg="불사조 기사단 화이팅!">불사조 기사단 화이팅!</button>
          <button class="btn cheer-btn" data-msg="죽음을 먹는 자들 질주하라!">죽음을 먹는 자들 질주하라!</button>
          ... -->
        </div>

        <!-- 직접 입력 응원 -->
        <div style="display:flex; gap:8px; margin-top:10px;">
          <input id="cheerInput" placeholder="직접 응원 메시지 입력" />
          <button id="btnSendCheer" class="btn">보내기</button>
        </div>
      </div>
    </section>

    <!-- 우: 타임라인(로그+채팅 통합) -->
    <aside class="card">
      <div class="card-hd">
        <div>타임라인</div>
        <div style="display:flex; gap:8px;">
          <button id="btnTimelineClear" class="btn" style="padding:6px 10px;">지우기</button>
        </div>
      </div>
      <div class="card-bd timeline">
        <div id="timelineFeed" class="feed">
          <!-- battle:log / battle:chat 모두 line으로 렌더링 -->
        </div>
        <div class="chatbox">
          <input id="chatInput" placeholder="채팅 메시지 입력" />
          <button id="btnSendChat" class="btn">보내기</button>
        </div>
      </div>
    </aside>
  </main>

  <!-- Socket.IO client -->
  <script src="/socket.io/socket.io.js"></script>

  <!-- 공용/페이지 스크립트 -->
  <script src="/assets/js/ui-helpers.js"></script>
  <script src="/assets/js/notifications.js"></script>
  <script src="/assets/js/socket-manager.js"></script>

  <!-- 페이지 로직: spectator.js (응원 버튼 문구/바인딩 포함) -->
  <script src="/assets/js/spectator.js"></script>
</body>
</html>
