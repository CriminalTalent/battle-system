<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>PYXIS - ì „íˆ¬ ê´€ë¦¬ì</title>
  <style>
    :root{
      --deep-navy:#000813;
      --gold:#DCC7A2;
      --gold-bright:#D4BA8D;
      --glass-1:rgba(0,8,19,.7);
      --glass-2:rgba(0,8,19,.5);
      --border-light:rgba(220,199,162,.3);
      --text:#fff;
      --text-muted:rgba(255,255,255,.7);
      --radius:6px;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Cinzel',serif;
      background:linear-gradient(135deg,var(--deep-navy) 0%, #001122 100%);
      color:var(--text); min-height:100vh; line-height:1.6;
    }
    .header{ text-align:center; padding:20px 0; background:var(--glass-1);
      border-bottom:1px solid var(--border-light); backdrop-filter:blur(10px) }
    .title{ color:var(--gold); font-size:2.5rem; font-weight:700; letter-spacing:.15em;
      text-shadow:0 0 20px rgba(220,199,162,.5) }

    .admin-container{ max-width:1400px; margin:0 auto; padding:20px }
    .admin-grid{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:24px; align-items:start }
    @media (max-width:1200px){ .admin-grid{ grid-template-columns:1fr 1fr } }
    @media (max-width:768px){ .admin-grid{ grid-template-columns:1fr } }

    .section h2{ color:var(--gold); margin-bottom:16px; font-size:1.2rem; font-weight:600 }
    .card{
      background:var(--glass-1); border:1px solid var(--border-light);
      border-radius:var(--radius); padding:20px; margin-bottom:16px; backdrop-filter:blur(10px)
    }
    .field{ margin-bottom:12px }
    .field label{ display:block; color:var(--gold); font-weight:600; margin-bottom:4px; font-size:.9rem }
    .field input,.field select{
      width:100%; padding:8px 12px; background:var(--deep-navy); color:var(--text);
      border:1px solid var(--border-light); border-radius:var(--radius); font-size:.9rem
    }
    .field input:focus,.field select:focus{
      outline:none; border-color:var(--gold); box-shadow:0 0 0 2px rgba(220,199,162,.2)
    }
    .grid{ display:grid; gap:12px }
    .grid-2{ grid-template-columns:1fr 1fr }
    .grid-3{ grid-template-columns:1fr 1fr 1fr }
    .grid-4{ grid-template-columns:1fr 1fr 1fr 1fr }
    .compact{ gap:8px }

    .btn{ background:linear-gradient(135deg,var(--gold) 0%, var(--gold-bright) 100%);
      border:none; color:#0b0f14; padding:10px 12px; border-radius:8px; font-weight:700; cursor:pointer }
    .btn.ghost{ background:transparent; border:1px solid var(--gold); color:var(--gold) }
    .btn.danger{ background:#3b0c0c; border:1px solid #8a5; color:var(--gold) }
    .btn.block{ width:100% }
    .btn.small{ padding:4px 8px; font-size:.75rem }

    .hint{ color:var(--text-muted); font-size:.8rem; margin-top:6px }

    .team-rosters{ display:grid; grid-template-columns:1fr 1fr; gap:16px }
    @media (max-width:768px){ .team-rosters{ grid-template-columns:1fr } }

    .team h4{ color:var(--gold); margin-bottom:8px; font-size:1rem }
    .team-list{ display:grid; gap:8px }
    .player-card{ background:var(--glass-2); border:1px solid var(--border-light); border-radius:var(--radius); padding:12px }
    .player-info{ display:flex; align-items:center; gap:12px }
    .player-info img{ width:40px; height:40px; border-radius:50%; border:2px solid var(--gold); object-fit:cover; background:#0b1420 }
    .player-details{ flex:1 }
    .player-details .name{ font-weight:600; color:var(--gold); font-size:.9rem }
    .hp-bar{ background:#0b1420; border-radius:10px; height:8px; margin:4px 0; position:relative; border:1px solid var(--border-light) }
    .hp-fill{ background:linear-gradient(90deg,#4ade80 0%, #22c55e 100%); height:100%; border-radius:9px; transition:width .3s ease }
    .hp-text{ font-size:.7rem; color:var(--text-muted) }
    .stats{ font-size:.7rem; color:var(--text-muted); font-family:'JetBrains Mono',monospace }

    /* ë¡œê·¸/ì±„íŒ… íŒ¨ë„ */
    .logs,.chat{ max-height:340px; overflow:auto; display:grid; gap:6px }
    .log{ font-size:.92rem; line-height:1.45; background:rgba(255,255,255,.02);
      border:1px solid rgba(220,199,162,.12); border-radius:8px; padding:6px 8px; color:var(--text) }
    .log.rule{ background:var(--gold); color:#000; font-weight:700 }
    .log.error{ color:#ff6b6b }
    .chat-entry{ font-size:.92rem; line-height:1.45; background:rgba(255,255,255,.02);
      border:1px solid rgba(220,199,162,.12); border-radius:8px; padding:6px 8px; color:var(--text) }
    .tmark{ font-family:'JetBrains Mono',monospace; color:#000; background:var(--gold); border-radius:6px; padding:0 6px; margin-right:6px }

    .avatar-preview{
      width:60px; height:60px; border-radius:50%; border:2px solid var(--gold);
      margin-top:8px; display:block; object-fit:cover; background:#0b1420
    }
    .row{ display:flex; align-items:center }
    .row.between{ justify-content:space-between }
    .pill{ background:var(--gold); color:var(--deep-navy); padding:2px 8px; border-radius:12px; font-size:.7rem; font-weight:600 }
  </style>

  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet"/>
</head>
<body>
  <header class="header"><h1 class="title">PYXIS</h1></header>

  <div class="admin-container">
    <div class="admin-grid">
      <!-- ì „íˆ¬ ì œì–´ -->
      <div class="section">
        <h2>ì „íˆ¬ ì œì–´</h2>
        <div class="card">
          <div class="field">
            <label>ì „íˆ¬ ëª¨ë“œ</label>
            <select id="battleMode">
              <option value="1v1">1v1</option>
              <option value="2v2" selected>2v2</option>
              <option value="3v3">3v3</option>
              <option value="4v4">4v4</option>
            </select>
          </div>
          <button id="btnCreate" class="btn block">ì „íˆ¬ ìƒì„±</button>
          <div class="hint">ì „íˆ¬ ìƒì„± í›„ URL íŒŒë¼ë¯¸í„°ê°€ ìë™ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤.</div>
        </div>

        <div class="card">
          <div class="field">
            <label>ì „íˆ¬ ID</label>
            <input id="currentBattleId" type="text" readonly placeholder="ì „íˆ¬ ìƒì„± í›„ í‘œì‹œ"/>
          </div>
          <div class="grid grid-4 compact">
            <button id="btnStart" class="btn">ì‹œì‘</button>
            <button id="btnPause" class="btn ghost">ì¼ì‹œì •ì§€</button>
            <button id="btnResume" class="btn ghost">ì¬ê°œ</button>
            <button id="btnEnd" class="btn danger">ì¢…ë£Œ</button>
          </div>
        </div>

        <!-- ë§í¬ / ë¹„ë°€ë²ˆí˜¸ -->
        <div class="card">
          <h3>ë§í¬ / ë¹„ë°€ë²ˆí˜¸</h3>
          <button id="btnGenLinks" class="btn block">ì°¸ê°€ì ë§í¬ / ê´€ì „ì ë¹„ë²ˆ ìƒì„±</button>
          <div class="field">
            <label>ê´€ì „ì ë¹„ë°€ë²ˆí˜¸</label>
            <input id="spectatorOtp" type="text" readonly/>
          </div>
          <div class="field">
            <label>ê´€ì „ì URL</label>
            <input id="spectatorUrl" type="text" readonly/>
          </div>
          <!-- ğŸ‘‡ ì¶”ê°€ëœ ê´€ì „ì ë§í¬ ë³µì‚¬ ë²„íŠ¼ -->
          <button id="copySpectatorLinkBtn" class="btn ghost block">ê´€ì „ì í˜ì´ì§€ ë§í¬ ë³µì‚¬</button>
          <div class="hint">ì°¸ê°€ì ê°œë³„ ë§í¬(ì´ë¦„/íŒ€/OTP í¬í•¨)ëŠ” ì•„ë˜ ëª©ë¡ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
          <div id="playerLinks" class="field"></div>
        </div>
      </div>

      <!-- ì „íˆ¬ ì°¸ê°€ì ê´€ë¦¬ -->
      <!-- ... (ì´ì „ê³¼ ë™ì¼, ìƒëµ) ... -->
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
  (function(){
    const socket = io({ path: "/socket.io" });
    let battleId = new URL(location.href).searchParams.get('battle') || '';
    const esc = (t)=> String(t||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));

    function addLog(msg,type='info'){
      const logs=document.getElementById('logs'); if(!logs) return;
      const t=new Date().toLocaleTimeString();
      const el=document.createElement('div');
      el.className='log'+(type==='battle'?' rule': type==='error'?' error':'');
      el.innerHTML = `<span class="tmark">${esc(t)}</span>${esc(msg)}`;
      logs.appendChild(el); logs.scrollTop=logs.scrollHeight;
    }

    function updateBattleId(id){
      battleId=id; window.battleId=id;
      document.getElementById('currentBattleId').value=id;
      const url=new URL(location.href); url.searchParams.set('battle', id); history.replaceState(null,'',url.toString());
      socket.emit('join',{ battleId:id });
      addLog(`ì „íˆ¬ ë°©ì— ì°¸ì—¬: ${id}`);
    }

    // ê´€ì „ì ë§í¬ ë³µì‚¬ ê¸°ëŠ¥
    document.getElementById('copySpectatorLinkBtn').onclick = ()=>{
      if(!battleId){ alert('ì „íˆ¬ IDê°€ ì—†ìŠµë‹ˆë‹¤'); return; }
      const url = `${location.origin}/spectator.html?battle=${battleId}`;
      navigator.clipboard.writeText(url)
        .then(()=> addLog('ê´€ì „ì í˜ì´ì§€ ë§í¬ ë³µì‚¬ ì™„ë£Œ'))
        .catch(()=> addLog('ê´€ì „ì í˜ì´ì§€ ë§í¬ ë³µì‚¬ ì‹¤íŒ¨','error'));
    };

    addLog('ê´€ë¦¬ì í˜ì´ì§€ ì‹œì‘');
  })();
  </script>
</body>
</html>
