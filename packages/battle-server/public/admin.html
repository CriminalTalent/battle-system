<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>PYXIS - 전투 관리자</title>
  <style>
    :root{
      --deep-navy:#000813;
      --gold:#DCC7A2;
      --gold-bright:#D4BA8D;
      --glass-1:rgba(0,8,19,.7);
      --glass-2:rgba(0,8,19,.5);
      --border-light:rgba(220,199,162,.3);
      --text:#fff;
      --text-muted:rgba(255,255,255,.7);
      --radius:6px;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Cinzel',serif;
      background:linear-gradient(135deg,var(--deep-navy) 0%, #001122 100%);
      color:var(--text); min-height:100vh; line-height:1.6;
    }
    .header{ text-align:center; padding:20px 0; background:var(--glass-1);
      border-bottom:1px solid var(--border-light); backdrop-filter:blur(10px) }
    .title{ color:var(--gold); font-size:2.5rem; font-weight:700; letter-spacing:.15em;
      text-shadow:0 0 20px rgba(220,199,162,.5) }

    .admin-container{ max-width:1400px; margin:0 auto; padding:20px }
    .admin-grid{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:24px; align-items:start }
    @media (max-width:1200px){ .admin-grid{ grid-template-columns:1fr 1fr } }
    @media (max-width:768px){ .admin-grid{ grid-template-columns:1fr } }

    .section h2{ color:var(--gold); margin-bottom:16px; font-size:1.2rem; font-weight:600 }
    .card{
      background:var(--glass-1); border:1px solid var(--border-light);
      border-radius:var(--radius); padding:20px; margin-bottom:16px; backdrop-filter:blur(10px)
    }
    .field{ margin-bottom:12px }
    .field label{ display:block; color:var(--gold); font-weight:600; margin-bottom:4px; font-size:.9rem }
    .field input,.field select{
      width:100%; padding:8px 12px; background:var(--deep-navy); color:var(--text);
      border:1px solid var(--border-light); border-radius:var(--radius); font-size:.9rem
    }
    .btn{ background:linear-gradient(135deg,var(--gold) 0%, var(--gold-bright) 100%);
      border:none; color:#0b0f14; padding:10px 12px; border-radius:8px; font-weight:700; cursor:pointer }
    .btn.ghost{ background:transparent; border:1px solid var(--gold); color:var(--gold) }
    .btn.block{ width:100% }
    .btn.small{ padding:4px 8px; font-size:.75rem; border-radius:6px; margin-left:6px }
    .team-rosters{ display:grid; grid-template-columns:1fr 1fr; gap:16px }
    .player-card{ background:var(--glass-2); border:1px solid var(--border-light); border-radius:var(--radius); padding:12px }
    .player-info{ display:flex; align-items:center; gap:12px }
    .player-info img{ width:40px; height:40px; border-radius:50%; border:2px solid var(--gold); object-fit:cover; background:#0b1420 }
    .player-details .name{ font-weight:600; color:var(--gold); font-size:.9rem }
    .logs,.chat{ max-height:340px; overflow:auto; display:grid; gap:6px }
    .log{ font-size:.92rem; line-height:1.45; background:rgba(255,255,255,.02);
      border:1px solid rgba(220,199,162,.12); border-radius:8px; padding:6px 8px; color:var(--text) }
    .tmark{ font-family:'JetBrains Mono',monospace; color:#000; background:var(--gold); border-radius:6px; padding:0 6px; margin-right:6px }
  </style>
</head>
<body>
  <header class="header"><h1 class="title">PYXIS</h1></header>

  <div class="admin-container">
    <div class="admin-grid">
      <!-- 전투 제어 -->
      <div class="section">
        <h2>전투 제어</h2>
        <div class="card">
          <div class="field">
            <label>전투 모드</label>
            <select id="battleMode">
              <option value="1v1">1v1</option>
              <option value="2v2" selected>2v2</option>
            </select>
          </div>
          <button id="btnCreate" class="btn block">전투 생성</button>
        </div>
        <div class="card">
          <div class="field">
            <label>전투 ID</label>
            <input id="currentBattleId" type="text" readonly/>
          </div>
          <div class="grid grid-4 compact">
            <button id="btnStart" class="btn">시작</button>
            <button id="btnPause" class="btn ghost">일시정지</button>
            <button id="btnResume" class="btn ghost">재개</button>
            <button id="btnEnd" class="btn danger">종료</button>
          </div>
        </div>
        <div class="card">
          <h3>링크 / 비밀번호</h3>
          <button id="btnGenLinks" class="btn block">참가자 링크 / 관전자 비번 생성</button>
          <div class="field">
            <label>관전자 비밀번호</label>
            <input id="spectatorOtp" type="text" readonly/>
          </div>
          <div class="field" style="display:flex; align-items:center; gap:6px">
            <div style="flex:1">
              <label>관전자 URL</label>
              <input id="spectatorUrl" type="text" readonly/>
            </div>
            <!-- ⬇ 작은 버튼 추가 -->
            <button id="copySpectatorLinkBtn" class="btn ghost small">복사</button>
          </div>
          <div id="playerLinks" class="field"></div>
        </div>
      </div>

      <!-- 참가자 관리 -->
      <div class="section">
        <h2>전투 참가자 관리</h2>
        <div class="card">
          <div class="field"><label>이름</label><input id="playerName" type="text"/></div>
          <button id="btnAddPlayer" class="btn block">전투 참가자 추가</button>
        </div>
        <div class="card">
          <h3>팀 목록</h3>
          <div class="team-rosters">
            <div class="team"><h4>A</h4><div id="teamA"></div></div>
            <div class="team"><h4>B</h4><div id="teamB"></div></div>
          </div>
        </div>
      </div>

      <!-- 로그 & 채팅 -->
      <div class="section">
        <h2>실시간 로그</h2>
        <div class="card"><div id="logs" class="logs"></div></div>
        <h2>채팅</h2>
        <div class="card">
          <div id="chat" class="chat"></div>
          <input id="chatMsg" type="text" placeholder="메시지 입력...">
          <button id="btnSend" class="btn">전송</button>
        </div>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
  (function(){
    const socket = io({ path: "/socket.io" });
    let battleId = new URL(location.href).searchParams.get('battle') || '';
    function addLog(msg){const logs=document.getElementById('logs');const t=new Date().toLocaleTimeString();const el=document.createElement('div');el.className='log';el.innerHTML=`<span class="tmark">${t}</span>${msg}`;logs.appendChild(el);logs.scrollTop=logs.scrollHeight;}
    // 복사 기능
    document.getElementById('copySpectatorLinkBtn').onclick = ()=>{
      const url = document.getElementById('spectatorUrl').value.trim();
      if(!url){ alert('관전자 URL이 없습니다'); return; }
      navigator.clipboard.writeText(url)
        .then(()=> addLog('관전자 페이지 링크 복사 완료'))
        .catch(()=> addLog('관전자 페이지 링크 복사 실패'));
    };
    addLog('관리자 페이지 시작');
  })();
  </script>
</body>
</html>
