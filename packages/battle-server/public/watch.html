<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PYXIS 전투 아레나 - 관전</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    :root {
      --deep-navy: #0a0f1a;
      --navy: #0f1419;
      --navy-light: #1a1f26;
      --gold: #E5C88A;
      --gold-light: #F5E6B8;
      --gold-dark: #C8A882;
      --accent: #2a3441;
      --text-primary: #F5E6B8;
      --text-secondary: #D4C39A;
      --border: rgba(229, 200, 138, 0.3);
      --border-light: rgba(229, 200, 138, 0.15);
      --glass: rgba(15, 20, 25, 0.85);
      --glass-dark: rgba(10, 15, 26, 0.9);
      --success: #27ae60;
      --warning: #f39c12;
      --danger: #e74c3c;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: linear-gradient(135deg, var(--deep-navy), var(--navy) 50%, var(--navy-light));
      font-family: 'Playfair Display', serif;
      color: var(--text-primary);
      min-height: 100vh;
    }

    .arena-container { max-width: 1400px; margin: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; }

    /* 헤더 */
    .arena-header {
      background: var(--glass-dark);
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      backdrop-filter: blur(20px);
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      text-align: center;
    }
    .arena-title { font-size: 2rem; color: var(--gold); text-shadow: 0 0 15px rgba(229,200,138,0.4); grid-column: span 5; }
    .arena-cell { font-size: 1rem; color: var(--text-secondary); }
    .arena-cell strong { display: block; color: var(--gold); margin-bottom: 5px; }

    /* 상태/패널 */
    .battle-arena { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .team-panel {
      background: var(--glass);
      border: 2px solid var(--border-light);
      border-radius: 12px;
      padding: 20px;
      backdrop-filter: blur(15px);
    }
    .team-title {
      color: var(--gold); font-size: 1.3rem; text-align: center; margin-bottom: 15px;
      border-bottom: 1px solid var(--border-light); padding-bottom: 5px;
    }
    .player-card {
      background: var(--navy-light);
      border: 1px solid var(--border-light);
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 10px;
      display: flex; gap: 15px; align-items: center;
    }
    .player-card.dead { opacity: 0.4; filter: grayscale(1); }
    .player-avatar { width: 50px; height: 50px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; color: var(--gold); font-weight: bold; }

    .hp-bar { height: 6px; background: var(--navy); border-radius: 8px; overflow: hidden; margin: 5px 0; }
    .hp-fill { height: 100%; background: linear-gradient(90deg, var(--success), var(--danger)); }

    .player-stats { display: grid; grid-template-columns: repeat(4,1fr); gap: 4px; font-size: 11px; color: var(--text-secondary); }
    .stat-item { background: var(--navy); border-radius: 4px; text-align: center; padding: 2px; }

    /* 로그/채팅 */
    .logs-section { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
    .log-panel, .cheer-section {
      background: var(--glass);
      border: 2px solid var(--border-light);
      border-radius: 12px;
      padding: 20px;
    }
    .log-title { color: var(--gold); font-size: 1.3rem; text-align: center; margin-bottom: 10px; }
    .log-area, .chat-area {
      background: var(--navy); border: 1px solid var(--border-light); border-radius: 8px;
      height: 250px; overflow-y: auto; padding: 10px; font-family: monospace; font-size: 13px; color: var(--text-secondary);
    }
    .cheer-buttons { display: grid; grid-template-columns: repeat(2,1fr); gap: 10px; margin-bottom: 10px; }
    .cheer-btn { background: var(--accent); border: 1px solid var(--border-light); border-radius: 6px; padding: 8px; cursor: pointer; color: var(--text-primary); font-weight: bold; }
    .cheer-btn:hover { background: var(--gold-dark); color: var(--navy); }
  </style>
</head>
<body>
  <div class="arena-container">
    <!-- 헤더 -->
    <div class="arena-header">
      <h1 class="arena-title">PYXIS 전투 아레나 (관전)</h1>
      <div class="arena-cell"><strong>단계</strong><span id="battleStage">대기실</span></div>
      <div class="arena-cell"><strong>현재 턴</strong><span id="currentTurn">-</span></div>
      <div class="arena-cell"><strong>팀 타이머</strong><span id="turnTimer">-</span></div>
      <div class="arena-cell"><strong>승자</strong><span id="winner">미정</span></div>
      <div class="arena-cell"><strong>연결</strong><span id="connectionStatus">끊김</span></div>
    </div>

    <!-- 아레나 -->
    <div class="battle-arena">
      <div class="team-panel">
        <h3 class="team-title">불사조 기사단</h3>
        <div id="team1Players"></div>
      </div>
      <div class="team-panel">
        <h3 class="team-title">죽음을 먹는자들</h3>
        <div id="team2Players"></div>
      </div>
    </div>

    <!-- 로그 -->
    <div class="logs-section">
      <div class="log-panel">
        <h3 class="log-title">전투 로그</h3>
        <div id="battleLog" class="log-area"></div>
      </div>
      <div class="cheer-section">
        <h3 class="log-title">응원</h3>
        <div class="cheer-buttons">
          <button class="cheer-btn" onclick="sendCheer('힘내!')">힘내!</button>
          <button class="cheer-btn" onclick="sendCheer('지지마!')">지지마!</button>
          <button class="cheer-btn" onclick="sendCheer('화이팅!')">화이팅!</button>
          <button class="cheer-btn" onclick="sendCheer('이길 수 있어!')">이길 수 있어!</button>
        </div>
        <div class="log-title" style="font-size:1rem;">채팅</div>
        <div id="chatLog" class="chat-area"></div>
      </div>
    </div>
  </div>

  <script>
    let socket=null,currentBattle=null;
    window.onload=()=>{initializeSocket();};
    function initializeSocket(){
      socket=io({transports:['websocket','polling']});
      socket.on('connect',()=>{document.getElementById('connectionStatus').textContent='연결됨';});
      socket.on('disconnect',()=>{document.getElementById('connectionStatus').textContent='끊김';});
      socket.on('battleUpdate',(battle)=>{currentBattle=battle;updateDisplay();});
      socket.on('chatMessage',(data)=>{addChat(data);});
    }
    function updateDisplay(){
      if(!currentBattle)return;
      document.getElementById('battleStage').textContent=currentBattle.status;
      document.getElementById('currentTurn').textContent=currentBattle.currentTeam||'-';
      updateTeam('team1Players',currentBattle.teams.team1);
      updateTeam('team2Players',currentBattle.teams.team2);
      updateLog();
    }
    function updateTeam(containerId,team){
      const c=document.getElementById(containerId);c.innerHTML='';
      if(!team)return;
      team.players.forEach(p=>{
        const hp=(p.hp/p.maxHp*100).toFixed(0);
        c.innerHTML+=`
          <div class="player-card ${!p.alive?'dead':''}">
            <div class="player-avatar">${p.name[0]}</div>
            <div>
              <div>${p.name}</div>
              <div class="hp-bar"><div class="hp-fill" style="width:${hp}%"></div></div>
              <div class="player-stats">
                <div class="stat-item">공 ${p.stats.attack}</div>
                <div class="stat-item">방 ${p.stats.defense}</div>
                <div class="stat-item">민 ${p.stats.agility}</div>
                <div class="stat-item">운 ${p.stats.luck}</div>
              </div>
            </div>
          </div>`;
      });
    }
    function updateLog(){
      const log=document.getElementById('battleLog');log.innerHTML='';
      currentBattle.battleLog?.slice(-30).forEach(e=>{
        log.innerHTML+=`<div>[${new Date(e.timestamp).toLocaleTimeString()}] ${e.message}</div>`;
      });
      log.scrollTop=log.scrollHeight;
    }
    function addChat(d){
      const chat=document.getElementById('chatLog');
      chat.innerHTML+=`<div>[${new Date(d.timestamp).toLocaleTimeString()}] ${d.sender}: ${d.message}</div>`;
      chat.scrollTop=chat.scrollHeight;
    }
    function sendCheer(m){
      if(socket)socket.emit('cheerMessage',{message:m});
    }
  </script>
</body>
</html>
