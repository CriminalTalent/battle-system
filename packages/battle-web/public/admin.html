<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PYXIS 전투 시스템 - 관리자 콘솔</title>
<style>
:root {
  --deep-navy: #0a0f1a;
  --navy: #0f1419;
  --navy-light: #1a1f26;
  --gold: #E5C88A;
  --gold-light: #F5E6B8;
  --gold-dark: #C8A882;
  --accent: #2a3441;
  --text-primary: #F5E6B8;
  --text-secondary: #D4C39A;
  --border: rgba(229, 200, 138, 0.3);
  --border-light: rgba(229, 200, 138, 0.15);
  --shadow: rgba(229, 200, 138, 0.2);
  --glass: rgba(15, 20, 25, 0.85);
  --glass-dark: rgba(10, 15, 26, 0.9);
  --timer-warning: #e74c3c;
  --timer-critical: #c0392b;
  --success: #27ae60;
  --warning: #f39c12;
  --danger: #e74c3c;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  -webkit-tap-highlight-color: transparent;
}

body {
  background: linear-gradient(135deg, var(--deep-navy) 0%, var(--navy) 50%, var(--navy-light) 100%);
  color: var(--text-primary);
  font-family: 'Cinzel', 'Times New Roman', serif;
  min-height: 100vh;
  overflow-x: hidden;
  position: relative;
  font-size: 16px;
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(circle at 20% 20%, rgba(229, 200, 138, 0.05) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(229, 200, 138, 0.05) 0%, transparent 50%),
    radial-gradient(circle at 40% 60%, rgba(229, 200, 138, 0.03) 0%, transparent 50%);
  pointer-events: none;
  z-index: -1;
}

.main-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 15px;
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.header {
  background: var(--glass-dark);
  border: 2px solid var(--border);
  border-radius: 16px;
  padding: 20px 25px;
  text-align: center;
  backdrop-filter: blur(20px);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(229, 200, 138, 0.1);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header h1 {
  font-size: clamp(1.8rem, 4vw, 2.5rem);
  color: var(--gold);
  text-shadow: 0 0 20px rgba(229, 200, 138, 0.5);
  letter-spacing: 2px;
  margin-bottom: 8px;
  font-weight: 700;
}

.header .subtitle {
  font-size: 1.1rem;
  color: var(--text-secondary);
  font-style: italic;
}

.logo-container {
  display: flex;
  align-items: center;
  gap: 15px;
}

.logo-image {
  width: 80px;
  height: 80px;
  border-radius: 12px;
  object-fit: cover;
  border: 2px solid var(--border);
  box-shadow: 0 4px 15px rgba(229, 200, 138, 0.2);
}

.card {
  background: var(--glass);
  border: 1px solid var(--border-light);
  border-radius: 12px;
  padding: 20px;
  backdrop-filter: blur(10px);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
}

.card:hover {
  border-color: var(--border);
  box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3);
}

.card-title {
  font-size: 1.4rem;
  color: var(--gold);
  margin-bottom: 16px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border-light);
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
}

.form-grid {
  display: grid;
  gap: 15px;
}

.cols-2 { grid-template-columns: repeat(2, 1fr); }
.cols-3 { grid-template-columns: repeat(3, 1fr); }
.cols-4 { grid-template-columns: repeat(4, 1fr); }

@media (max-width: 768px) {
  .cols-2, .cols-3, .cols-4 { grid-template-columns: 1fr; }
  .header { flex-direction: column; gap: 15px; }
}

.form-field {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.form-label {
  font-size: 0.9rem;
  color: var(--text-secondary);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.form-input, .form-select {
  background: rgba(42, 52, 65, 0.7);
  border: 1px solid var(--border-light);
  border-radius: 8px;
  padding: 12px 16px;
  color: var(--text-primary);
  font-size: 1rem;
  font-family: inherit;
  transition: all 0.3s ease;
}

.form-input:focus, .form-select:focus {
  outline: none;
  border-color: var(--gold);
  box-shadow: 0 0 0 3px rgba(229, 200, 138, 0.1);
  background: rgba(42, 52, 65, 0.9);
}

.form-input::placeholder {
  color: var(--text-secondary);
  opacity: 0.7;
}

.btn {
  background: linear-gradient(135deg, var(--gold), var(--gold-dark));
  color: var(--deep-navy);
  padding: 12px 24px;
  border-radius: 8px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-size: 0.9rem;
  font-family: inherit;
  border: none;
}

.btn:hover:not(:disabled) {
  background: linear-gradient(135deg, var(--gold), var(--gold-light));
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(229, 200, 138, 0.3);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
  background: var(--accent);
  color: var(--text-secondary);
}

.btn-secondary {
  background: linear-gradient(135deg, var(--accent), var(--navy-light));
  border-color: var(--accent);
  color: var(--text-primary);
}

.btn-secondary:hover:not(:disabled) {
  background: linear-gradient(135deg, var(--navy-light), var(--accent));
}

.btn-danger {
  background: linear-gradient(135deg, var(--danger), #c0392b);
  color: white;
}

.btn-danger:hover:not(:disabled) {
  background: linear-gradient(135deg, #c0392b, var(--danger));
}

.url-display {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 16px;
}

.url-item {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}

.url-label {
  font-size: 0.9rem;
  color: var(--text-secondary);
  font-weight: 600;
  min-width: 120px;
}

.code-display {
  background: rgba(42, 52, 65, 0.8);
  border: 1px solid var(--border-light);
  border-radius: 6px;
  padding: 8px 12px;
  font-family: 'Courier New', monospace;
  font-size: 0.8rem;
  color: var(--gold);
  flex: 1;
  word-break: break-all;
}

.pill {
  display: inline-block;
  background: rgba(42, 52, 65, 0.7);
  border: 1px solid var(--border-light);
  border-radius: 16px;
  padding: 6px 12px;
  font-size: 0.8rem;
  color: var(--text-secondary);
  font-weight: 600;
  text-align: center;
}

.success-state {
  background: rgba(39, 174, 96, 0.2);
  border-color: rgba(39, 174, 96, 0.5);
  color: var(--success);
}

.battle-controls {
  display: flex;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
}

.team-builder {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

@media (max-width: 768px) {
  .team-builder { grid-template-columns: 1fr; }
}

.team-panel {
  background: rgba(42, 52, 65, 0.5);
  border: 1px solid var(--border-light);
  border-radius: 12px;
  padding: 20px;
}

.team-header {
  font-size: 1.3rem;
  font-weight: 700;
  text-align: center;
  margin-bottom: 20px;
  padding: 12px;
  border-radius: 8px;
}

.team-phoenix .team-header {
  background: linear-gradient(135deg, rgba(231, 76, 60, 0.2), rgba(192, 57, 43, 0.2));
  color: #e74c3c;
  border: 1px solid rgba(231, 76, 60, 0.3);
}

.team-deatheater .team-header {
  background: linear-gradient(135deg, rgba(52, 152, 219, 0.2), rgba(41, 128, 185, 0.2));
  color: #3498db;
  border: 1px solid rgba(52, 152, 219, 0.3);
}

.player-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.player-card {
  background: rgba(15, 20, 25, 0.7);
  border: 1px solid var(--border-light);
  border-radius: 8px;
  padding: 15px;
  transition: all 0.3s ease;
}

.player-card:hover {
  border-color: var(--border);
  background: rgba(15, 20, 25, 0.9);
}

.player-info {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.player-avatar {
  width: 50px;
  height: 50px;
  border-radius: 8px;
  background: var(--accent);
  border: 2px solid var(--border-light);
  object-fit: cover;
}

.player-name {
  font-weight: 600;
  color: var(--gold);
}

.player-status {
  font-size: 0.8rem;
  color: var(--text-secondary);
  margin-top: 4px;
}

.player-stats {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
  margin-bottom: 12px;
}

.stat-item {
  text-align: center;
  background: rgba(42, 52, 65, 0.5);
  border-radius: 6px;
  padding: 8px 4px;
}

.stat-label {
  font-size: 0.7rem;
  color: var(--text-secondary);
  display: block;
}

.stat-value {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--gold);
  display: block;
  margin-top: 2px;
}

.player-items {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.item-tag {
  background: rgba(229, 200, 138, 0.15);
  color: var(--gold);
  border: 1px solid var(--border-light);
  border-radius: 12px;
  padding: 4px 8px;
  font-size: 0.7rem;
  font-weight: 600;
}

.add-player-form {
  display: grid;
  gap: 12px;
  margin-top: 20px;
  padding-top: 20px;
  border-top: 1px solid var(--border-light);
}

.add-player-controls {
  display: flex;
  gap: 8px;
  align-items: end;
}

.file-upload {
  position: relative;
  overflow: hidden;
  display: inline-block;
}

.file-upload input[type=file] {
  position: absolute;
  left: -9999px;
}

.file-upload-label {
  background: var(--accent);
  color: var(--text-primary);
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.8rem;
  border: 1px solid var(--border-light);
  transition: all 0.3s ease;
}

.file-upload-label:hover {
  background: var(--navy-light);
  border-color: var(--border);
}

.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  padding: 16px 20px;
  border-radius: 8px;
  font-weight: 600;
  color: white;
  z-index: 1000;
  max-width: 400px;
  word-wrap: break-word;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.notification.success {
  background: linear-gradient(135deg, var(--success), #27ae60);
}

.notification.error {
  background: linear-gradient(135deg, var(--danger), #c0392b);
}

.notification.warning {
  background: linear-gradient(135deg, var(--warning), #e67e22);
}

.battle-status {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}

.status-card {
  background: rgba(42, 52, 65, 0.7);
  border: 1px solid var(--border-light);
  border-radius: 8px;
  padding: 16px;
  text-align: center;
}

.status-label {
  font-size: 0.8rem;
  color: var(--text-secondary);
  margin-bottom: 8px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-value {
  font-size: 1.4rem;
  font-weight: 700;
  color: var(--gold);
}

.otp-section {
  margin-bottom: 20px;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.card {
  animation: fadeIn 0.5s ease-out;
}
</style>
</head>

<body>
<div class="main-container">
  <!-- 헤더 -->
  <header class="header">
    <div class="logo-container">
      <img src="https://i.ibb.co/tw2NgtHH/Kakao-Talk-20250819-000243427.png" alt="PYXIS 로고" class="logo-image">
      <div>
        <h1>PYXIS 전투 시스템</h1>
        <div class="subtitle">관리자 제어판</div>
      </div>
    </div>
  </header>

  <!-- 전투 생성 및 관리 -->
  <section class="card">
    <div class="card-title">전투 생성 및 설정</div>
    <div class="form-grid cols-2">
      <div class="form-field">
        <div class="form-label">전투 모드</div>
        <select id="mode" class="form-select">
          <option value="1v1">1대1 결투</option>
          <option value="2v2">2대2 팀전</option>
          <option value="3v3">3대3 팀전</option>
          <option value="4v4">4대4 팀전</option>
        </select>
      </div>
      <div class="form-field">
        <div class="form-label">전투 ID</div>
        <input id="battleId" class="form-input" placeholder="자동 생성됨" readonly>
      </div>
    </div>
    <div class="battle-controls">
      <button class="btn" id="btnCreate">전투 생성</button>
      <button class="btn btn-secondary" id="btnLinks">링크 생성</button>
      <button class="btn btn-secondary" id="btnFetch">상태 갱신</button>
    </div>
    
    <div class="url-display">
      <div class="url-item">
        <span class="url-label">관리자 URL:</span>
        <code id="adminUrl" class="code-display">-</code>
      </div>
      <div class="url-item">
        <span class="url-label">플레이어 URL:</span>
        <code id="playerUrl" class="code-display">-</code>
      </div>
      <div class="url-item">
        <span class="url-label">관전자 URL:</span>
        <code id="spectUrl" class="code-display">-</code>
      </div>
    </div>
  </section>

  <!-- 인증 및 접근 제어 -->
  <section class="card otp-section">
    <div class="card-title">인증 및 접근 제어</div>
    <div class="form-grid cols-2">
      <div>
        <div class="form-grid cols-4" style="margin-bottom: 16px;">
          <button id="btnIssueAdmin" class="btn btn-secondary">관리자 OTP</button>
          <span class="pill" id="adminOtp">-</span>
          <input id="adminOtpInput" class="form-input" placeholder="관리자 OTP 입력">
          <button class="btn" id="btnAdminLogin">관리자 로그인</button>
        </div>
        <div class="pill" id="adminLoginState">인증되지 않음</div>
      </div>
      <div>
        <div class="form-grid cols-3" style="margin-bottom: 16px;">
          <input id="playerNameForOtp" class="form-input" placeholder="플레이어 이름">
          <button id="btnIssuePlayer" class="btn btn-secondary">플레이어 OTP</button>
          <span class="pill" id="playerOtp">-</span>
        </div>
        <div class="form-grid cols-2">
          <button id="btnIssueSpect" class="btn btn-secondary">관전자 OTP</button>
          <span class="pill" id="spectOtp">-</span>
        </div>
      </div>
    </div>
  </section>

  <!-- 전투 관리 -->
  <section class="card">
    <div class="card-title">전투 관리</div>
    <div class="battle-controls">
      <button class="btn" id="btnStart">전투 시작</button>
      <select id="winnerSel" class="form-select" style="min-width: 200px;">
        <option value="">승자: 자동 (HP 합계)</option>
        <option value="team1">불사조 기사단 승리</option>
        <option value="team2">죽음을 먹는 자들 승리</option>
        <option value="draw">무승부</option>
      </select>
      <button id="btnForceEnd" class="btn btn-danger">강제 종료</button>
      <button id="btnDelete" class="btn btn-danger">전투 삭제</button>
    </div>
  </section>

  <!-- 전투 상태 -->
  <section class="card">
    <div class="card-title">전투 상태</div>
    <div class="battle-status" id="battleStatus">
      <div class="status-card">
        <div class="status-label">단계</div>
        <div class="status-value" id="phaseStatus">-</div>
      </div>
      <div class="status-card">
        <div class="status-label">모드</div>
        <div class="status-value" id="modeStatus">-</div>
      </div>
      <div class="status-card">
        <div class="status-label">현재 턴</div>
        <div class="status-value" id="turnStatus">-</div>
      </div>
      <div class="status-card">
        <div class="status-label">승자</div>
        <div class="status-value" id="winnerStatus">-</div>
      </div>
    </div>
  </section>

  <!-- 팀 구성 -->
  <section class="card">
    <div class="card-title">팀 구성</div>
    <div class="team-builder">
      <!-- 불사조 기사단 -->
      <div class="team-panel team-phoenix">
        <div class="team-header">불사조 기사단</div>
        <div class="player-list" id="team1Players"></div>
        
        <div class="add-player-form">
          <div class="form-field">
            <div class="form-label">캐릭터 이름</div>
            <input id="team1Name" class="form-input" placeholder="예: 해리 포터">
          </div>
          <div class="form-grid cols-4">
            <div class="form-field">
              <div class="form-label">공격력 (1-5)</div>
              <input id="team1Attack" class="form-input" type="number" min="1" max="5" value="3">
            </div>
            <div class="form-field">
              <div class="form-label">방어력 (1-5)</div>
              <input id="team1Defense" class="form-input" type="number" min="1" max="5" value="3">
            </div>
            <div class="form-field">
              <div class="form-label">민첩성 (1-5)</div>
              <input id="team1Agility" class="form-input" type="number" min="1" max="5" value="3">
            </div>
            <div class="form-field">
              <div class="form-label">행운 (1-5)</div>
              <input id="team1Luck" class="form-input" type="number" min="1" max="5" value="3">
            </div>
          </div>
          <div class="form-grid cols-3">
            <div class="form-field">
              <div class="form-label">공격 보정기</div>
              <input id="team1AttackBoost" class="form-input" type="number" min="0" max="3" value="0">
            </div>
            <div class="form-field">
              <div class="form-label">방어 보정기</div>
              <input id="team1DefenseBoost" class="form-input" type="number" min="0" max="3" value="0">
            </div>
            <div class="form-field">
              <div class="form-label">디터니</div>
              <input id="team1Ditany" class="form-input" type="number" min="0" max="3" value="0">
            </div>
          </div>
          <div class="form-field">
            <div class="form-label">체력 (기본: 100)</div>
            <input id="team1Hp" class="form-input" type="number" min="1" max="100" value="100">
          </div>
          <div class="add-player-controls">
            <div class="file-upload">
              <input type="file" id="team1Image" accept="image/*">
              <label for="team1Image" class="file-upload-label">이미지 선택</label>
            </div>
            <button class="btn" id="btnAddTeam1">캐릭터 추가</button>
          </div>
        </div>
      </div>

      <!-- 죽음을 먹는 자들 -->
      <div class="team-panel team-deatheater">
        <div class="team-header">죽음을 먹는 자들</div>
        <div class="player-list" id="team2Players"></div>
        
        <div class="add-player-form">
          <div class="form-field">
            <div class="form-label">캐릭터 이름</div>
            <input id="team2Name" class="form-input" placeholder="예: 볼드모트">
          </div>
          <div class="form-grid cols-4">
            <div class="form-field">
              <div class="form-label">공격력 (1-5)</div>
              <input id="team2Attack" class="form-input" type="number" min="1" max="5" value="3">
            </div>
            <div class="form-field">
              <div class="form-label">방어력 (1-5)</div>
              <input id="team2Defense" class="form-input" type="number" min="1" max="5" value="3">
            </div>
            <div class="form-field">
              <div class="form-label">민첩성 (1-5)</div>
              <input id="team2Agility" class="form-input" type="number" min="1" max="5" value="3">
            </div>
            <div class="form-field">
              <div class="form-label">행운 (1-5)</div>
              <input id="team2Luck" class="form-input" type="number" min="1" max="5" value="3">
            </div>
          </div>
          <div class="form-grid cols-3">
            <div class="form-field">
              <div class="form-label">공격 보정기</div>
              <input id="team2AttackBoost" class="form-input" type="number" min="0" max="3" value="0">
            </div>
            <div class="form-field">
              <div class="form-label">방어 보정기</div>
              <input id="team2DefenseBoost" class="form-input" type="number" min="0" max="3" value="0">
            </div>
            <div class="form-field">
              <div class="form-label">디터니</div>
              <input id="team2Ditany" class="form-input" type="number" min="0" max="3" value="0">
            </div>
          </div>
          <div class="form-field">
            <div class="form-label">체력 (기본: 100)</div>
            <input id="team2Hp" class="form-input" type="number" min="1" max="100" value="100">
          </div>
          <div class="add-player-controls">
            <div class="file-upload">
              <input type="file" id="team2Image" accept="image/*">
              <label for="team2Image" class="file-upload-label">이미지 선택</label>
            </div>
